# Architecture & UX Proposals

Generated by project-finalizer on 2026-02-24.
These proposals were identified during the quality sweep and require user decision to implement.

## High Priority

| # | Issue | Current | Proposed | Scope | Effort |
|---|-------|---------|----------|-------|--------|
| 1 | Tenant isolation risk | Named scope (`scopeForTenant()`) applied manually per query | Global Eloquent scope on all tenant-scoped models (auto-applied) | All tenant models | High |
| 2 | Cook wallet negative on refund | Refund deducts from cook wallet regardless of balance | Define policy: cap at 0, create debt entry, or limit refund window | RefundService, WalletService | High |

## Medium Priority

| # | Issue | Current | Proposed | Scope | Effort |
|---|-------|---------|----------|-------|--------|
| 3 | Commission basis ambiguous | Uses `grand_total` (includes delivery fee) | Clarify: should be subtotal only (not delivery fee) | CommissionService | Medium |
| 4 | x-sync racing modals | x-sync may overwrite confirmation input state | Use x-component or server-side confirmation validation | Destructive modals | Medium |
| 5 | Stat cards stale on tab switch | Fragment cache may serve stale analytics | Add cache-busting on tab switch, polling intervals | Analytics controllers | Medium |
| 6 | selling_unit column naming | `meal_components.selling_unit` stores FK as string | Rename to `selling_unit_id` (proper FK integer) | DB schema, Model | Medium |

## Low Priority

| # | Issue | Current | Proposed | Scope | Effort |
|---|-------|---------|----------|-------|--------|
| 7 | Activity log noise | 51+ `manager_section_accessed` entries per session | Filter navigation events from business event log | ActivityLog config | Low |
| 8 | Discovery page meal counts | Shows 0 meals for all cooks | Query `meals` table for live meal count per tenant | DiscoveryService | Low |
| 9 | Push notification prompt timing | Shows on every page load after 2s | Show after first order or contextually | Push notification component | Low |

## Safe Improvements Already Implemented (on sweep branch)

| # | Description | Category |
|---|-------------|----------|
| 1 | Fixed gale()->redirect()->back() anti-pattern in 15 controllers (30+ instances) | Reactivity |
| 2 | Added My Kitchen nav link for cooks/managers on main domain | Navigation |
| 3 | Added Public Page and DancyMeals links in cook dashboard sidebar footer | Navigation |
| 4 | Fixed profile dropdown broken on tenant public page (x-navigate on container) | UX |
| 5 | Fixed admin tenant detail showing 0 for orders/revenue/active meals | Data accuracy |
