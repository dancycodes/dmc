# F-032 — Profile Basic Info Edit

> Module: Auth
> Type: functional
> Priority: Must-have
> Precedence: F-030

---

## What It Does

Allows authenticated users to edit their basic profile information: name, phone number,
and preferred language. Email is displayed as read-only (a separate change flow may be added
later). Validates phone format for Cameroon (+237). Saves via Gale without page reload.
Shows a toast notification on success. Activity is logged.

---

## Who Uses It

- **All authenticated users** editing their own profile information.

---

## User Scenarios

### Happy Path
1. User navigates to the profile edit page from their profile (F-030).
2. The form is pre-populated with current values: name, phone, preferred language.
3. Email is displayed but not editable (read-only field with a note: "Contact support to change your email").
4. User updates their name and clicks "Save."
5. The update is saved via Gale without a full page reload.
6. A toast notification confirms: "Profile updated successfully."
7. The change is logged in the activity log.

### Alternate Path — Change Phone Number
1. User updates their phone number to a different valid Cameroon number.
2. Validation passes. The phone is updated.
3. Toast confirms success.

### Alternate Path — Change Preferred Language
1. User changes preferred language from English to French.
2. The preference is saved. The page content does not immediately switch language (that happens on next page load or via F-042).

### Error Path — Invalid Phone Number
1. User enters a phone number that does not match Cameroon format.
2. Validation error: "Please enter a valid Cameroon phone number (+237 followed by 9 digits)."
3. The form stays open with the error displayed inline.

### Error Path — Empty Name
1. User clears the name field and tries to save.
2. Validation error: "Name is required."

---

## Business Rules

| Code | Rule |
|------|------|
| BR-112 | Name is required and must be between 2 and 255 characters. |
| BR-113 | Phone number must match Cameroon format (BR-029): +237 followed by 9 digits. |
| BR-114 | Email is read-only on this form. It cannot be changed here. |
| BR-115 | Preferred language must be one of: "en" (English) or "fr" (French). |
| BR-116 | Form submission and response must happen via Gale without a full page reload. |
| BR-117 | Successful updates are logged via Spatie Activitylog with the old and new values. |
| BR-118 | All validation error messages must be localized via `__()`. |

---

## Data Involved

### User Model (updated)
| Field | Editable | Validation |
|-------|----------|------------|
| name | Yes | Required, 2-255 characters |
| phone | Yes | Required, Cameroon format (+237XXXXXXXXX) |
| preferred_language | Yes | Required, in: en, fr |
| email | No (read-only) | Displayed but not editable |

### Activity Log
| Field | Value |
|-------|-------|
| Event | "updated" |
| Subject | The user model |
| Causer | The user themselves |
| Properties | Old and new values of changed fields |

---

## Acceptance Criteria

```
Given I am on the profile edit page
When the form loads
Then my current name, phone, and preferred language are pre-populated

Given I am on the profile edit page
When I look at the email field
Then it is displayed as read-only with a note about contacting support

Given I update my name to a valid value and click save
When the server processes the update
Then my name is updated, a toast confirms, and no page reload occurs

Given I update my phone to an invalid format
When I click save
Then I see a validation error inline next to the phone field

Given I change my preferred language and save
When the update completes
Then my preferred_language is updated in the database

Given I successfully update my profile
When I check the activity log
Then the update event is recorded with old and new values
```

---

## Verification Steps

1. Navigate to profile edit — confirm all fields are pre-populated with current values.
2. Confirm email is read-only and cannot be edited.
3. Update name — confirm save via Gale, toast, and no page reload.
4. Update phone to invalid format — confirm validation error.
5. Update preferred language — confirm database update.
6. Check activity log for the update event with correct details.

---

## Edge Cases

- User submits the form without changing anything — should succeed silently (no-op) or show "No changes detected."
- User enters phone with spaces or dashes — normalize before validation.
- User enters name with special characters (accents, hyphens) — allow, as Cameroonian names often include them.
- Concurrent edits from multiple tabs — last save wins.

---

## UI/UX Notes

- Form is inline on the profile page or in a dedicated edit section (not a separate page if possible).
- Gale handles the form submission — no page reload.
- The email field is visually distinct (grayed out or with a lock icon).
- Preferred language is a dropdown/select with two options: English, French.
- Phone input shows a +237 prefix indicator.
- Save button shows a loading state during submission.
- Light/dark mode support.

---

## Related Features

- **F-030** — Profile View (links to this page)
- **F-042** — Language Preference Setting (also allows changing language, may share UI)
- **F-017** — Activity Logging Setup (logs profile changes)
