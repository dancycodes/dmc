# F-119 — Meal Component Edit

> Module: Meal Component
> Priority: Must-have
> Precedence: F-118
> Type: functional

---

## What It Does
Allows a cook to edit a meal component's name (English and French), price, selling unit, and quantity settings (minimum, maximum, available). Price changes apply only to new orders — existing pending orders retain the original price. Changes are saved via Gale with a success toast. All edits are logged via Spatie Activitylog for audit purposes.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Edits meal component details |
| Manager | Edits components if granted `manage-meals` permission |

---

## User Scenarios
### Scenario 1: Edit component name
The cook changes "Ndole + Plantain" to "Ndole + Ripe Plantain" (EN) and updates the French translation. The change saves and reflects in the component list and on the tenant landing page.

### Scenario 2: Update price
The cook increases the price of a component from 1000 XAF to 1200 XAF. New orders use 1200 XAF. A pending order with this component still shows 1000 XAF.

### Scenario 3: Change selling unit
The cook changes the unit from "plate" to "bowl." The unit updates on all client-facing displays.

### Scenario 4: Adjust quantity limits
The cook sets a max quantity from unlimited to 5 per order. New orders enforce this limit.

### Scenario 5: Invalid edit — min greater than max
The cook sets min quantity to 10 and max quantity to 5. Validation fails: "Minimum quantity cannot exceed maximum quantity."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-292 | All validation rules from F-118 apply to edits |
| BR-293 | Price changes apply to new orders only; pending orders retain original price |
| BR-294 | Name, selling unit, and quantity changes take effect immediately |
| BR-295 | Component edits are logged via Spatie Activitylog with old and new values |
| BR-296 | Only users with `manage-meals` permission can edit components |
| BR-297 | If available quantity is edited to 0, the component auto-toggles to unavailable |

---

## Data Involved
**Creates:**
- Nothing

**Reads:**
- MealComponent record to populate the edit form
- Available selling units

**Updates:**
- MealComponent record with new values

**Relationships:**
- MealComponent belongsTo Meal
- MealComponent belongsTo SellingUnit

---

## Acceptance Criteria
- **Given** a component, **when** the cook edits the name and saves, **then** the new name is stored
- **Given** a price change, **when** a new order is placed, **then** it uses the new price
- **Given** a price change, **when** checking a pending order, **then** it still shows the old price
- **Given** min quantity set higher than max, **when** submitted, **then** validation fails
- **Given** available quantity set to 0, **when** saved, **then** the component becomes unavailable
- **Given** a successful edit, **when** checking the activity log, **then** old and new values are recorded

---

## Verification Steps
1. Edit a component name — confirm it updates everywhere
2. Edit a component price — confirm new orders use new price
3. Verify pending orders retain original price after price change
4. Change selling unit — confirm update on client pages
5. Set invalid min/max — confirm validation error
6. Set available quantity to 0 — confirm auto-unavailable
7. Check activity log for the edit entry

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Edit to same values (no actual change) | Save succeeds (no-op) |
| Component part of a pending order | Name/unit changes reflect; price locked at order time |
| Concurrent edits | Last save wins; activity log records both |
| Selling unit deleted after assignment | Component retains the unit reference; unit deletion checks prevent this |

---

## UI/UX Notes
- Edit form in a modal or expandable section within the component list
- Pre-populated with existing values
- Same field layout as creation (F-118)
- Note near price field: "Price changes apply to new orders only"
- Save and Cancel buttons
- Gale-powered form submission
- Toast on success
- Mobile-friendly layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-118 | Meal Component Creation | Creates the components edited here |
| F-120 | Meal Component Delete | Alternative to editing |
| F-124 | Meal Component Quantity Settings | Quantity fields are part of this edit |
| F-125 | Meal Component List View | Lists components that can be edited |
