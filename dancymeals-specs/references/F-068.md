# F-068 — Discovery Search

> Module: Discovery
> Priority: Must-have
> Precedence: F-066
> Type: functional

---

## What It Does

Provides a search bar on the discovery page header that allows visitors to search for cooks by cook name, meal name, town name, or tags. Search is live with debounced input, updating the cook card grid via Gale without page reload. Supports both English and French search terms. Shows an empty state when no results match the query.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Types a search query to find specific cooks, meals, or food types |

---

## User Scenarios

### Scenario 1: Search by cook name
A visitor types "Latifa" in the search bar. After a brief debounce (300ms), the grid updates to show only cooks whose name matches "Latifa" (partial match). Results update without page reload.

### Scenario 2: Search by meal name
A visitor types "Ndole" in the search bar. The grid updates to show cooks who have a meal named or tagged "Ndole" in their active menu.

### Scenario 3: Search by town
A visitor types "Douala" in the search bar. The grid updates to show cooks who deliver to Douala.

### Scenario 4: Search by tag
A visitor types "vegetarian" in the search bar. The grid updates to show cooks who have meals tagged with "vegetarian."

### Scenario 5: No results
A visitor types "xyz12345" in the search bar. The grid clears and shows an empty state: "No cooks found matching your search. Try different keywords." with a clear search button.

### Scenario 6: Clear search
After performing a search, the visitor clicks the clear (X) button on the search bar. The grid resets to show all cooks with default sort and any active filters.

### Scenario 7: Search combined with filters
A visitor has active filters (e.g., town: Douala). They type "chicken" in the search bar. Results show cooks in Douala who have meals related to "chicken." Both search and filters apply simultaneously.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-082 | Search queries are debounced at 300ms to avoid excessive server requests |
| BR-083 | Search matches against: cook name (en/fr), meal name (en/fr), town name (en/fr), and meal tags |
| BR-084 | Search is case-insensitive and accent-insensitive |
| BR-085 | Search performs partial matching (contains, not exact match) |
| BR-086 | Search results respect any active filters (search AND filters are combined) |
| BR-087 | An empty search query resets the grid to the default (unfiltered) view |
| BR-088 | Search updates the grid via Gale without page reload |
| BR-089 | Minimum search query length is 2 characters before triggering a server request |

---

## Data Involved

**Reads:**
- Cook profiles (name_en, name_fr)
- Meals (name_en, name_fr, tags)
- Towns (name_en, name_fr)
- Active filters and sort state

**Creates:**
- Nothing

**Updates:**
- Cook card grid content (via Gale fragment update)

---

## Acceptance Criteria

- **Given** the search bar on the discovery page, **when** a visitor types a query of 2+ characters, **then** the grid updates after 300ms debounce
- **Given** a search for a cook name, **when** a matching cook exists, **then** their card appears in the results
- **Given** a search for a meal name, **when** a cook has that meal, **then** the cook's card appears in the results
- **Given** a search for a town name, **when** cooks deliver to that town, **then** those cooks' cards appear
- **Given** no matching results, **when** the debounce fires, **then** an empty state message is displayed
- **Given** a search query, **when** the visitor clears the search bar, **then** the grid resets to default results
- **Given** active filters, **when** a search is performed, **then** results match both the search query AND the active filters

---

## Verification Steps

1. Type a known cook name in the search bar and confirm matching cards appear
2. Type a known meal name and confirm relevant cook cards appear
3. Type a town name and confirm cooks delivering to that town appear
4. Type a nonsensical string and confirm the empty state appears
5. Clear the search bar and confirm the grid resets
6. Apply a filter, then search, and confirm both are combined
7. Type 1 character and confirm no request is sent (minimum 2 characters)
8. Switch language to French and search using a French term

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Very fast typing (under 300ms between keystrokes) | Only the final query after debounce triggers a request |
| Search term matches multiple categories (cook name AND meal name) | All matching cooks shown (union of matches) |
| Special characters in search (é, ô, ü) | Accent-insensitive matching handles these |
| Network error during search | Previous results remain; toast error suggests retrying |
| Search while previous request is in-flight | Previous request is cancelled; latest query takes priority |

---

## UI/UX Notes

- Search bar is prominent in the header with a magnifying glass icon and placeholder text "Search cooks, meals, towns..."
- Clear (X) button appears when text is entered
- Loading indicator (subtle spinner in the search bar) during server request
- Results transition smoothly (fade or slide) when grid updates
- On mobile, the search bar may collapse to an icon that expands to full-width input on tap
- Search bar retains its value on filter or sort changes

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-066 | Discovery Page Layout | Parent page containing the search bar |
| F-067 | Cook Card Component | Cards rendered in search results |
| F-069 | Discovery Filters | Filters combine with search |
| F-070 | Discovery Sort Options | Sort applies to search results |
