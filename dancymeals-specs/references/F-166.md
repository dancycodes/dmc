# F-166 â€” Client Wallet Dashboard

> Module: Wallet
> Priority: Must-have
> Precedence: F-024
> Type: functional

---

## What It Does
Displays the client's wallet page showing their current balance, recent transactions (last 10), and an explanatory note about wallet usage. The wallet holds refund credits that can be used for future orders (when enabled by admin via F-063). Clients cannot withdraw wallet balance to mobile money. The balance is displayed in XAF format. A link to the full transaction history (F-164) is provided.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Views wallet balance and recent transactions |

---

## User Scenarios
### Scenario 1: View wallet with balance
The client navigates to "My Wallet." The page shows: current balance (e.g., "5,000 XAF"), a note: "Your wallet balance comes from refunds and can be used for future orders," and the last 10 transactions. A link reads "View full transaction history."

### Scenario 2: Wallet with zero balance
The client has never received a refund. The wallet shows "0 XAF" with a note: "Your wallet balance will appear here when you receive a refund."

### Scenario 3: Recent transactions
The client sees 10 recent wallet transactions listed below the balance. Each shows: date, description, amount (+ or -), and type. Older transactions are accessible via the full history link.

### Scenario 4: Wallet usage disabled
The admin has disabled wallet payments (F-063). The wallet page still shows the balance but includes a note: "Wallet payments are currently not available for orders."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-280 | Each client has one wallet with a single balance |
| BR-281 | Wallet balance is displayed in XAF format |
| BR-282 | Wallet balance cannot be negative |
| BR-283 | Clients cannot withdraw wallet balance to mobile money or any external method |
| BR-284 | Recent transactions section shows the last 10 wallet-related transactions |
| BR-285 | A link to full transaction history (F-164) is provided |
| BR-286 | Explanatory note describes the wallet's purpose (refunds, reuse for orders) |
| BR-287 | If wallet payment is disabled by admin, a note indicates this |
| BR-288 | Authentication is required |
| BR-289 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `client_wallets` table for balance
- `wallet_transactions` or `transactions` table for recent entries (limit 10)
- Platform settings for wallet payment enabled/disabled status

**Creates:**
- Client wallet record if none exists (lazy creation on first visit)

**Updates:**
- Nothing

**Relationships:**
- Wallet belongsTo User (client)
- Wallet hasMany WalletTransactions

---

## Acceptance Criteria
- **Given** a client with wallet balance, **when** they visit the wallet page, **then** the balance is displayed in XAF format
- **Given** a client with transactions, **when** viewing the wallet, **then** the last 10 transactions are shown
- **Given** a zero-balance wallet, **when** viewing the wallet, **then** "0 XAF" is displayed with an appropriate note
- **Given** wallet payments are disabled by admin, **when** viewing the wallet, **then** a note indicates payments are unavailable
- **Given** the client clicks "View full transaction history," **when** navigating, **then** they reach the transaction history page (F-164)

---

## Verification Steps
1. Navigate to the wallet page and verify balance is displayed
2. Verify recent transactions list shows up to 10 entries
3. Click "View full transaction history" and verify navigation
4. Test with zero balance and verify appropriate messaging
5. Disable wallet payments in admin settings and verify the note appears
6. Test first-time access (no wallet record yet) and verify lazy creation

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client has no wallet record yet | Wallet is created with 0 balance on first visit |
| Client has exactly 10 transactions | All 10 shown; full history link still available |
| Client has fewer than 10 transactions | All transactions shown; no empty slots |
| Currency display | Always XAF with proper formatting (e.g., "5,000 XAF") |

---

## UI/UX Notes
- Accessible from account menu under "My Wallet"
- Large balance display at top (prominent, centered)
- Explanatory note in a subtle info card below the balance
- Recent transactions as a compact list below the note
- Each transaction row: date, description, amount with +/- indicator
- "View full transaction history" link at the bottom of the list
- No withdrawal button or option (not applicable for client wallets)
- Mobile-first layout
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-024 | User Login | Authentication required |
| F-164 | Client Transaction History | Full history linked from this page |
| F-167 | Client Wallet Refund Credit | Credits refunds to this wallet |
| F-168 | Client Wallet Payment for Orders | Uses wallet balance at checkout |
| F-063 | Platform Settings Management | Controls whether wallet payments are enabled |
