# F-089 â€” Delete Quarter

> Module: Location
> Priority: Must-have
> Precedence: F-087
> Type: functional

---

## What It Does

Allows the cook to delete a quarter from a town. Deletion is blocked if the quarter has active (non-completed, non-cancelled) orders referencing it. If the quarter belongs to a quarter group, it is removed from the group upon deletion. A confirmation dialog is shown before deletion. The quarter list updates via Gale on success.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Removes a quarter they no longer deliver to |
| Manager | Deletes quarters if granted location management permission |

---

## User Scenarios

### Scenario 1: Delete a quarter
A cook clicks "Delete" on "Bonaberi" which has no active orders. Confirmation dialog: "Delete Bonaberi? Clients will no longer be able to order to this quarter." Cook confirms. Quarter is removed from the list.

### Scenario 2: Deletion blocked
A cook tries to delete "Akwa" which has 2 active orders. A message appears: "Cannot delete Akwa because it has 2 active orders."

### Scenario 3: Delete grouped quarter
A cook deletes "Deido" which belongs to the "Central Douala" group. The quarter is removed from the group and deleted. The group continues to exist with its other quarters.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-258 | Cannot delete a quarter with active (non-completed, non-cancelled) orders |
| BR-259 | Deleting a quarter removes it from any quarter group it belongs to |
| BR-260 | Confirmation dialog must show the quarter name |
| BR-261 | On success, toast notification: "Quarter deleted successfully" |
| BR-262 | Delete action requires location management permission |
| BR-263 | Quarter list updates via Gale without page reload |

---

## Data Involved

**Reads:**
- Active orders referencing this quarter
- Quarter group membership

**Deletes:**
- Quarter record
- Quarter-to-group relationship (if grouped)

**Updates:**
- Quarter list UI (via Gale)

---

## Acceptance Criteria

- **Given** a quarter with no active orders, **when** the cook confirms deletion, **then** the quarter is removed
- **Given** a quarter with active orders, **when** the cook clicks delete, **then** deletion is blocked with a message
- **Given** a grouped quarter, **when** deleted, **then** it is removed from the group and the group remains
- **Given** the confirmation dialog, **when** "Cancel" is clicked, **then** nothing is deleted

---

## Verification Steps

1. Delete a quarter with no active orders and confirm removal
2. Attempt to delete a quarter with active orders and confirm block message
3. Delete a grouped quarter and verify the group still exists
4. Cancel a deletion and confirm the quarter remains
5. Check database to confirm quarter record is deleted

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Quarter is the only one in its town | Allowed; town will have 0 quarters |
| Quarter is the last one in a group | Group becomes empty (0 members); still exists |
| Completed orders reference this quarter | Deletion allowed; completed orders are historical |
| Quarter deleted while another user is ordering to it | Order in progress may fail at submission; graceful error |

---

## UI/UX Notes

- Delete button (trash icon) on each quarter row
- Confirmation dialog with quarter name and warning text
- "Delete" (red) and "Cancel" buttons in dialog
- Quarter row fades out after successful deletion
- Block message appears as toast or inline warning

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-087 | Quarter List View | Delete initiated from the quarter list |
| F-088 | Edit Quarter | Alternative action |
| F-085 | Delete Town | Cascade-deletes quarters (different flow) |
| F-090 | Quarter Group Creation | Group membership affected by deletion |
