# F-201 â€” Cook Order Analytics

> Module: Analytics
> Priority: Should-have
> Precedence: F-076, F-151
> Type: functional

---

## What It Does
Provides order-focused analytics for the cook within the cook dashboard. Displays charts for order count over time, orders by status distribution, popular meals by order count, and peak ordering times (heatmap by hour and day of week). Summary cards show total orders, average order value, and most popular meal. A date range selector allows filtering. This helps cooks understand demand patterns and optimize their operations.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Views order analytics in the cook dashboard |
| Manager | Views order analytics if granted `view-analytics` permission |

---

## User Scenarios
### Scenario 1: View order summary
The cook navigates to Order Analytics. Summary cards show: "Total Orders: 847," "Average Order Value: 4,200 XAF," "Most Popular Meal: Ndole."

### Scenario 2: Orders over time
A line/bar chart shows order count per day for the current month. The cook notices Fridays and Saturdays have the highest order counts.

### Scenario 3: Orders by status
A donut chart shows the distribution: "Completed: 780, Cancelled: 42, Refunded: 25." This helps the cook understand their cancellation rate.

### Scenario 4: Popular meals
A horizontal bar chart ranks meals by order count. Ndole leads with 312 orders, followed by Jollof Rice with 245.

### Scenario 5: Peak ordering times heatmap
A heatmap shows hour-of-day (rows) vs day-of-week (columns). The darkest cells are Saturday 11 AM - 1 PM, indicating peak demand. This helps the cook plan their schedule.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-379 | Order data is tenant-scoped |
| BR-380 | All order statuses are included in the count (not just completed) |
| BR-381 | Default view shows the current month |
| BR-382 | Date range options mirror F-200 (Today, This Week, This Month, etc.) |
| BR-383 | Popular meals chart shows top 10 by order count |
| BR-384 | Average order value calculated from completed orders only |
| BR-385 | Peak times heatmap uses order placement time (when paid) |
| BR-386 | Heatmap uses the Africa/Douala timezone for hour-of-day |
| BR-387 | Charts update via Gale when date range changes |
| BR-388 | All amounts in XAF format |
| BR-389 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table filtered by `tenant_id` and date range
- `order_items` table for popular meals
- `meals` table for meal names

**Creates:**
- Nothing

**Updates:**
- Nothing

---

## Acceptance Criteria
- **Given** a cook with orders, **when** viewing order analytics, **then** summary cards show correct figures
- **Given** the order count chart, **when** loaded, **then** it shows daily order counts for the current month
- **Given** the orders by status chart, **when** viewed, **then** it shows correct status distribution
- **Given** the popular meals chart, **when** viewed, **then** top 10 meals are ranked by order count
- **Given** the peak times heatmap, **when** viewed, **then** it shows order density by hour and day
- **Given** a date range change, **when** applied, **then** all charts and summary cards update

---

## Verification Steps
1. Verify summary cards show correct total orders and average order value
2. Verify order count chart displays correctly for the current month
3. Verify orders-by-status donut chart shows accurate distribution
4. Verify popular meals chart ranks meals correctly
5. Verify peak times heatmap shows reasonable patterns
6. Change date range and verify all charts update
7. Test with a manager with `view-analytics` permission

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No orders in selected period | Charts show empty state; summary cards show zeros |
| Only one meal ever ordered | Popular meals chart shows one bar |
| All orders cancelled | Average order value shows 0 XAF (no completed orders) |
| Orders spanning timezone changes | Consistently use Africa/Douala timezone |
| Cook with 10,000+ orders | Aggregation queries are optimized; heatmap pre-aggregated |

---

## UI/UX Notes
- Summary cards at top in a 3-column grid
- Order count chart as a bar or area chart
- Status distribution as a donut/pie chart with status-colored segments
- Popular meals as a horizontal bar chart
- Peak times as a colored grid heatmap (light = low, dark = high)
- All charts have tooltips on hover showing exact values
- Responsive: charts stack vertically on mobile
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Dashboard shell |
| F-151 | Payment Webhook Handling | Creates order data |
| F-200 | Cook Revenue Analytics | Sibling analytics feature |
| F-208 | Analytics CSV/PDF Export | Export this data |
