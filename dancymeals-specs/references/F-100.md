# F-100 — Delivery/Pickup Time Interval Configuration

> Module: Schedule
> Priority: Must-have
> Precedence: F-098
> Type: functional

---

## What It Does
For a given cook schedule entry, configures the delivery and pickup time windows. Both windows must be on the open day (the day the schedule entry is for). Both must start at or after the order interval ends. Delivery and pickup are configured independently — a cook can offer delivery only, pickup only, or both. For example, "Delivery from 11:00 AM to 2:00 PM" and "Pickup from 10:30 AM to 3:00 PM." Configuration is done via Gale within the schedule management interface.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Configures delivery and pickup windows on schedule entries |
| Manager | Configures windows if granted `manage-schedules` permission |

---

## User Scenarios
### Scenario 1: Configure both delivery and pickup
The cook sets delivery from 11:00 AM to 2:00 PM and pickup from 10:30 AM to 3:00 PM for a Monday schedule entry. Both windows are saved and displayed in the schedule summary.

### Scenario 2: Delivery only
The cook enables delivery (11:00 AM to 2:00 PM) but leaves pickup disabled. Clients ordering from this schedule can only choose delivery.

### Scenario 3: Pickup only
The cook enables pickup (10:00 AM to 1:00 PM) but leaves delivery disabled. Clients ordering from this schedule can only choose pickup.

### Scenario 4: Invalid — delivery starts before order interval ends
The cook's order interval ends at 10:00 AM same day. They try to set delivery start at 9:00 AM. Validation fails because delivery must start at or after the order interval end.

### Scenario 5: Edit existing windows
The cook modifies the delivery end time from 2:00 PM to 3:00 PM. The change saves via Gale with a success toast.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-116 | Delivery and pickup time intervals must be on the open day (day offset is always 0 / same day) |
| BR-117 | Delivery start time must be at or after the order interval end time (on the same day) |
| BR-118 | Pickup start time must be at or after the order interval end time (on the same day) |
| BR-119 | Delivery end time must be after delivery start time |
| BR-120 | Pickup end time must be after pickup start time |
| BR-121 | At least one of delivery or pickup must be enabled if the schedule entry is available |
| BR-122 | Time format is 24-hour (HH:MM) |
| BR-123 | Delivery and pickup windows are independent — they can overlap, differ, or only one may be enabled |
| BR-124 | The order interval (F-099) must be configured before delivery/pickup intervals can be set |
| BR-125 | Changes do not affect already-placed orders |
| BR-126 | Interval configuration is logged via Spatie Activitylog |

---

## Data Involved
**Creates:**
- Delivery interval fields: `delivery_start_time` (time), `delivery_end_time` (time), `delivery_enabled` (boolean)
- Pickup interval fields: `pickup_start_time` (time), `pickup_end_time` (time), `pickup_enabled` (boolean)
- Fields on `CookSchedule` or a related model

**Reads:**
- CookSchedule entry and its order interval to validate start times
- Existing delivery/pickup data for edit

**Updates:**
- CookSchedule or related record with delivery/pickup configuration

**Relationships:**
- Delivery/Pickup intervals belong to CookSchedule

---

## Acceptance Criteria
- **Given** an order interval ending at 10:00 AM, **when** the cook sets delivery from 11:00 AM to 2:00 PM, **then** it saves successfully
- **Given** an order interval ending at 10:00 AM, **when** the cook sets delivery start at 9:00 AM, **then** validation fails
- **Given** delivery enabled and pickup disabled, **when** viewing the schedule, **then** only delivery window shows
- **Given** no order interval configured, **when** the cook tries to set delivery/pickup, **then** a message indicates the order interval must be set first
- **Given** delivery start at 11:00 AM and end at 10:00 AM, **when** submitted, **then** validation fails (end before start)
- **Given** both delivery and pickup configured, **when** viewing the schedule summary, **then** both windows display correctly

---

## Verification Steps
1. Configure delivery window after order interval and verify it saves
2. Configure pickup window after order interval and verify it saves
3. Attempt to set delivery start before order interval end — confirm validation error
4. Attempt to set pickup start before order interval end — confirm validation error
5. Enable only delivery, save, and verify pickup shows as disabled
6. Enable only pickup, save, and verify delivery shows as disabled
7. Try to configure delivery/pickup without order interval — confirm blocked
8. Check activity log for configuration changes

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Order interval end is 11:59 PM (near midnight) | Delivery/pickup still must be same day — very narrow window or validation error if impossible |
| Both delivery and pickup disabled | Validation error — at least one must be enabled for available entries |
| Order interval changed after delivery/pickup set | System re-validates; if delivery/pickup now starts before new order end, warning shown |
| Schedule entry toggled to unavailable | Delivery/pickup data retained but hidden |

---

## UI/UX Notes
- Appears as two collapsible sections below the order interval in the schedule entry view
- Each section has an enable/disable toggle
- When enabled, shows start time and end time pickers
- Validation messages appear inline below the relevant field
- Human-readable summary (e.g., "Delivery: 11:00 AM - 2:00 PM | Pickup: 10:30 AM - 3:00 PM")
- Greyed out if order interval is not yet configured, with helper text
- Mobile-friendly stacked layout
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-098 | Cook Day Schedule Creation | Provides the schedule entry |
| F-099 | Order Time Interval Configuration | Must be configured first; delivery/pickup start after it ends |
| F-101 | Create Schedule Template | Templates include delivery/pickup intervals |
| F-107 | Schedule Validation Rules | Cross-validates all intervals together |
| F-132 | Schedule & Availability Display | Shows delivery/pickup windows to clients |
