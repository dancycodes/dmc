# F-205 â€” Admin Platform Revenue Analytics

> Module: Analytics
> Priority: Should-have
> Precedence: F-057
> Type: functional

---

## What It Does
Provides a platform-wide revenue dashboard in the admin panel. Displays total revenue over time, commission earned over time, revenue breakdown by cook (top 10), and revenue by region/town. Summary cards show total platform revenue, total commission earned, active cook count, and transaction count. Date range selectors and comparison mode allow admins to analyze trends and performance across the entire marketplace.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Admin | Views platform revenue analytics in the admin panel |
| Super Admin | Full access to platform analytics |

---

## User Scenarios
### Scenario 1: View platform revenue overview
The admin navigates to the Analytics section in the admin panel. Summary cards show: "Platform Revenue: 45,000,000 XAF," "Commission Earned: 4,500,000 XAF," "Active Cooks: 87," "Transactions: 12,340."

### Scenario 2: Revenue over time
A line chart shows total revenue per month for the current year. The admin sees a steady upward trend with a spike during December holidays.

### Scenario 3: Commission over time
A line chart shows commission earned (platform's cut) per month. The admin uses this to track platform profitability.

### Scenario 4: Revenue by cook (top performers)
A horizontal bar chart shows the top 10 cooks by revenue generated. "Chef Latifa: 3,200,000 XAF," "Chef Amara: 2,800,000 XAF," etc.

### Scenario 5: Revenue by region
A bar chart or map shows revenue grouped by town/region: "Douala: 28,000,000 XAF," "Yaounde: 12,000,000 XAF," "Bafoussam: 3,500,000 XAF."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-417 | Only admin and super-admin roles can access platform analytics |
| BR-418 | Platform revenue = sum of all completed order totals across all tenants |
| BR-419 | Commission earned = platform's commission portion from all completed orders |
| BR-420 | Active cooks = tenants with at least one completed order in the selected period |
| BR-421 | Transaction count = number of completed payments in the selected period |
| BR-422 | Revenue by cook shows top 10; rest grouped as "Others" |
| BR-423 | Revenue by region derived from tenant's primary location |
| BR-424 | Date range options: This Month, Last 3 Months, Last 6 Months, This Year, Last Year, Custom |
| BR-425 | Comparison mode shows current period vs previous equivalent period |
| BR-426 | All amounts in XAF format |
| BR-427 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table (all tenants) filtered by status and date
- `payments` or transactions table for commission calculations
- `tenants` table for cook names and locations
- `users` table for cook info

**Creates:**
- Nothing

**Updates:**
- Nothing

---

## Acceptance Criteria
- **Given** an admin, **when** viewing platform analytics, **then** summary cards show correct figures
- **Given** revenue over time chart, **when** loaded, **then** it shows monthly totals for the current year
- **Given** revenue by cook, **when** viewed, **then** top 10 cooks are ranked correctly
- **Given** revenue by region, **when** viewed, **then** regions are grouped with correct totals
- **Given** a non-admin user, **when** accessing this page, **then** they receive a 403 response

---

## Verification Steps
1. Verify summary cards match actual platform totals
2. Verify revenue over time chart is accurate
3. Verify commission chart matches expected platform cut
4. Verify top 10 cooks ranking is correct
5. Verify revenue by region grouping is correct
6. Change date range and verify all charts update
7. Enable comparison mode and verify overlay works
8. Test access with a non-admin user; verify 403

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No orders on the platform | Empty state: "No revenue data yet" |
| Only one cook on the platform | Top cooks chart shows one bar |
| Cook with no location data | Grouped under "Unknown Region" |
| Very large datasets (100k+ orders) | Queries optimized with aggregation; cached results |
| Commission rate changed mid-period | Historical commission calculated at the rate in effect at the time |

---

## UI/UX Notes
- Analytics section in admin panel sidebar
- Summary cards in a 4-column grid at the top
- Line charts for revenue and commission over time
- Horizontal bar chart for top cooks
- Bar chart or regional breakdown for revenue by region
- Date range selector and comparison toggle in a toolbar
- Admin panel uses the default DancyMeals theme (no tenant theme)
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-057 | Admin Dashboard | Admin panel shell |
| F-206 | Admin Cook Performance Metrics | Sibling admin analytics |
| F-207 | Admin Growth Metrics | Sibling admin analytics |
| F-208 | Analytics CSV/PDF Export | Export this data |
