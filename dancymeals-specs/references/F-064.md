# F-064 — Activity Log Viewer

> Module: Admin
> Priority: Should-have
> Precedence: F-043, F-017
> Type: functional

---

## What It Does
Provides a searchable, filterable view of all activity logs recorded by Spatie Activitylog within the admin panel. Displays who performed what action, on which model, what changed, and when. Supports filtering by user, action type, model type, and date range. Rows are expandable to reveal before/after values for model attribute changes. Paginated for performance.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Views all activity logs for auditing and investigation |
| Admin | Views activity logs (may be scoped by permission) |

---

## User Scenarios
### Scenario 1: Browsing recent activity
An admin navigates to Activity Logs in the sidebar. A paginated table shows recent log entries, newest first: "Admin John updated Tenant 'Chef Amara's Kitchen' status to inactive — 2 hours ago", "System created User 'Marie Dupont' — 3 hours ago".

### Scenario 2: Filtering by user
The admin selects "Admin John" from the user filter. Only actions performed by Admin John are displayed.

### Scenario 3: Filtering by model type
The admin selects "Tenant" from the model type filter. Only activity related to tenant models is shown: creations, updates, status changes, commission changes.

### Scenario 4: Searching by description
The admin types "commission" in the search bar. Only activity entries mentioning commission changes are displayed.

### Scenario 5: Expanding a row for details
The admin clicks an expandable row for "Admin John updated Tenant 'Chef Amara's Kitchen'". The expanded section shows: Before: `{status: "active", commission_rate: 10}`, After: `{status: "inactive", commission_rate: 8}`. This provides a full audit trail.

### Scenario 6: Filtering by date range
The admin selects a date range of "Feb 1 - Feb 7, 2026". Only activities within that week are displayed.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-192 | Activity logs are read-only; they cannot be edited or deleted from the admin panel |
| BR-193 | All Spatie Activitylog entries are displayed (system and user actions) |
| BR-194 | "System" is shown as the causer for automated actions (auto-escalation, scheduled tasks) |
| BR-195 | Before/after values are stored for model attribute changes |
| BR-196 | Pagination: 25 entries per page |
| BR-197 | Default sort: newest first (created_at descending) |
| BR-198 | Search covers: activity description, causer name, subject type |

---

## Data Involved
**Reads:**
- Spatie activity_log table: description, subject_type, subject_id, causer_type, causer_id, properties (old/new values), created_at
- Users: names for causer display
- Model names for subject display

**Creates:**
- Nothing (read-only view)

**Updates:**
- Nothing

**Relationships:**
- F-043: Displayed within admin panel
- F-017: Spatie Activitylog setup provides the data this feature displays
- All features that log activity contribute entries to this view

---

## Acceptance Criteria
- **Given** activity logs exist, **when** navigating to the activity log viewer, **then** entries are displayed newest first
- **Given** the user filter set to "Admin John", **when** applied, **then** only Admin John's actions are shown
- **Given** the model type filter set to "Tenant", **when** applied, **then** only tenant-related activities are shown
- **Given** a search term "commission", **when** typed, **then** only matching activities are displayed
- **Given** an expandable row, **when** clicked, **then** before/after attribute values are revealed
- **Given** a date range filter, **when** applied, **then** only activities within that range are shown

---

## Verification Steps
1. Navigate to activity log viewer — confirm recent entries are displayed
2. Filter by a specific user — confirm only their actions shown
3. Filter by model type "Tenant" — confirm only tenant activities shown
4. Search for "commission" — confirm relevant entries appear
5. Expand a row — confirm before/after values are displayed correctly
6. Apply a date range — confirm entries are scoped to the period
7. Verify pagination with 30+ entries — confirm 25 per page with navigation

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No activity logs exist | Empty state: "No activity has been recorded yet." |
| Activity with no causer (system action) | Causer shows "System" with a system icon |
| Activity with a deleted causer (user was hard-deleted) | Causer shows "Deleted User (ID: 42)" |
| Model subject was deleted | Subject shows type and ID with "(Deleted)" note |
| Very large properties payload (JSON) | Expandable section scrollable with max height |
| Activity without before/after data (create/delete) | Shows "Created" or "Deleted" with the final/initial state only |

---

## UI/UX Notes
- Table columns: Timestamp (relative + exact on hover), User (avatar + name), Action (description), Model, Details (expand icon)
- Filter bar above table: User dropdown (searchable), Model Type dropdown, Action Type dropdown, Date Range picker, Search input
- Expandable rows use accordion pattern: clicking shows a detailed diff view
- Before/after values displayed as a side-by-side comparison or inline diff
- Changed values highlighted: old value in red, new value in green
- "System" causer shown with a robot/gear icon
- Mobile: simplified card layout, tap to expand details
- Timestamp shows relative time ("2 hours ago") with exact datetime on hover/tap
- Breadcrumb: Admin > Activity Logs

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-043 | Admin Panel Layout | Parent layout |
| F-017 | Activity Logging Setup | Provides the Spatie Activitylog data |
| F-047 | Tenant Detail View | Tenant activity history is a scoped subset of this |
| F-051 | User Detail View | User activity history is a scoped subset of this |
