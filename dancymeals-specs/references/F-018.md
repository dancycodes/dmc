# F-018 â€” Honeypot Protection Setup

> Module: Foundation
> Priority: Must-have
> Precedence: F-003
> Type: foundation

---

## What It Does
Installs and configures Spatie Laravel Honeypot to protect all public-facing forms from automated bot submissions. Adds invisible honeypot fields to registration, login, contact, and other public forms. Configures a minimum form submission time threshold to reject submissions that happen faster than a human could fill out the form. Bot submissions are silently rejected without giving feedback to the attacker.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Submits forms normally; honeypot is invisible to legitimate users |
| Guest | Protected when submitting registration, login, or contact forms |
| Bot/Attacker | Submission is silently rejected if honeypot field is filled or submission is too fast |
| Developer | Adds honeypot directive to Blade forms |

---

## User Scenarios
### Scenario 1: Legitimate user submits a form
A real user fills out the registration form over 5 seconds, leaves the honeypot field empty (they never see it), and submits. The form processes normally.

### Scenario 2: Bot fills hidden field
An automated bot crawls the registration page, fills all fields including the hidden honeypot field, and submits. The server detects the filled honeypot and silently rejects the submission (returns a 200 or redirect to avoid bot detection, but does not process the form).

### Scenario 3: Bot submits too quickly
A bot loads the form and submits it within 1 second (below the configured threshold). The server rejects the submission based on the time check, regardless of whether the honeypot field was filled.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-143 | Honeypot fields must be added to ALL public forms: registration, login, password reset, contact |
| BR-144 | The honeypot field must be invisible to users (hidden via CSS, not `type="hidden"`) |
| BR-145 | Submissions with a filled honeypot field are silently rejected |
| BR-146 | A minimum submission time threshold (default: 2 seconds) is enforced |
| BR-147 | Submissions faster than the threshold are silently rejected |
| BR-148 | Rejected submissions must not return error messages that reveal the protection mechanism |
| BR-149 | Honeypot protection must not interfere with legitimate form submissions |
| BR-150 | The honeypot field name should be randomized or use a non-obvious name |

---

## Data Involved
**Creates:**
- Published `honeypot.php` config with DancyMeals settings
- Honeypot Blade directive usage in form templates

**Reads:**
- Form submission data (checks for honeypot field value)
- Submission timestamp (compares against form render timestamp)

**Updates:**
- `config/honeypot.php` with custom field name and time threshold
- Public form Blade templates to include `@honeypot` directive
- `bootstrap/app.php` or middleware configuration if needed

**Relationships:**
- Applied to all public forms throughout the application
- Works alongside F-019 (Rate Limiting) for layered protection

---

## Acceptance Criteria
- **Given** a public form with honeypot, **when** a legitimate user submits normally, **then** the form processes successfully
- **Given** a form submission with the honeypot field filled, **when** submitted, **then** the submission is silently rejected
- **Given** a form submitted within 1 second of loading, **when** the threshold is 2 seconds, **then** the submission is silently rejected
- **Given** a rejected submission, **when** inspecting the response, **then** no error message reveals the honeypot mechanism
- **Given** the registration form, **when** viewing the HTML source, **then** the honeypot field is present but visually hidden
- **Given** any public form in the application, **when** inspecting its Blade template, **then** the `@honeypot` directive is present

---

## Verification Steps
1. Submit the registration form normally and confirm it processes successfully
2. Manually fill the honeypot field via browser DevTools and submit -- confirm silent rejection
3. Submit a form within 1 second using DevTools and confirm rejection
4. Inspect the registration form HTML and confirm the honeypot field is present but hidden
5. Verify the `honeypot.php` config has appropriate field name and time threshold
6. Confirm honeypot is present on login, registration, and password reset forms

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| User with autofill that fills honeypot | Unlikely with CSS hiding; if it happens, the field name is non-standard enough to avoid autofill |
| Screen reader reads honeypot field | Use `aria-hidden="true"` and `tabindex="-1"` to prevent screen reader and keyboard access |
| User submits form very quickly (power user) | 2-second threshold is generous enough for fast typists; configurable if needed |
| JavaScript disabled | Honeypot still works (it is server-side validation) |
| AJAX/Gale form submissions | Honeypot data included in the request payload just like regular form submissions |

---

## UI/UX Notes
- The honeypot field must be truly invisible: visually hidden via CSS (`position: absolute; left: -9999px`) or similar technique.
- Do not use `display: none` as some bots detect that.
- The field must be inaccessible to screen readers (`aria-hidden="true"`) and keyboard navigation (`tabindex="-1"`).
- No visual impact on the form layout for legitimate users.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-003 | Core Package Installation | Prerequisite; spatie/laravel-honeypot must be installed |
| F-005 | Authentication Scaffolding | Auth forms include honeypot protection |
| F-019 | Rate Limiting Setup | Complementary protection layer |
| F-021 | User Registration Form | Registration form includes honeypot |
| F-024 | User Login | Login form includes honeypot |
