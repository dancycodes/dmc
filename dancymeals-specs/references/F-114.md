# F-114 — Meal Tag Assignment

> Module: Meal
> Priority: Must-have
> Precedence: F-108, F-115
> Type: functional

---

## What It Does
Allows a cook to assign tags to a meal from their existing tag list (created in F-115). Tags are assigned via multi-select on the meal edit page. Tags help organize meals and enable filtering on the tenant landing page and discovery page. Tags can be assigned and removed without page reload via Gale. A maximum of 10 tags can be assigned per meal.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Assigns and removes tags on their meals |
| Manager | Assigns tags if granted `manage-meals` permission |
| Client | Uses tags to filter meals on the tenant landing page |

---

## User Scenarios
### Scenario 1: Assign tags to a meal
The cook opens the "Jollof Rice" edit page, navigates to the Tags section, and selects "Spicy," "Popular," and "Lunch" from the multi-select dropdown. The tags are assigned immediately via Gale. Toast: "Tags updated."

### Scenario 2: Remove a tag
The cook clicks the "X" on the "Popular" tag chip on "Jollof Rice." The tag is unassigned. The meal now has 2 tags.

### Scenario 3: Maximum tags reached
The cook tries to add an 11th tag to a meal. The selection is blocked with a message: "Maximum 10 tags per meal."

### Scenario 4: No tags available
A new cook has not created any tags yet. The tag section shows: "No tags created yet. Create tags first." with a link to the tag management page (F-115).

### Scenario 5: Tag used for filtering
A client on the tenant landing page clicks the "Breakfast" filter tag. Only meals tagged with "Breakfast" are displayed.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-244 | Maximum 10 tags per meal |
| BR-245 | Tags are assigned from the cook's existing tag list (tenant-scoped) |
| BR-246 | Tag assignment is a many-to-many relationship |
| BR-247 | Tags can be assigned and removed without page reload |
| BR-248 | Removing a tag from a meal does not delete the tag itself |
| BR-249 | Only users with `manage-meals` permission can assign/remove tags |
| BR-250 | Tag assignment changes are logged via Spatie Activitylog |
| BR-251 | Tags are used for filtering on the tenant landing page and discovery page |

---

## Data Involved
**Creates:**
- Pivot table `meal_tag` with fields: `meal_id`, `tag_id`, `created_at`
- Migration for the pivot table

**Reads:**
- Available tags for the tenant (from F-115)
- Currently assigned tags for the meal

**Updates:**
- Pivot table records (attach/detach)

**Relationships:**
- Meal belongsToMany Tags
- Tag belongsToMany Meals

---

## Acceptance Criteria
- **Given** a meal with no tags, **when** the cook selects 3 tags, **then** all 3 are assigned
- **Given** a meal with 10 tags, **when** the cook tries to add another, **then** the action is blocked
- **Given** a meal with a tag, **when** the cook removes it, **then** the tag is unassigned but still exists in the tag list
- **Given** no tags created for the tenant, **when** viewing the tag section, **then** a prompt to create tags is shown
- **Given** a meal with tags, **when** a client filters by one of those tags, **then** the meal appears in the filtered results

---

## Verification Steps
1. Assign tags to a meal — confirm they appear as chips/badges
2. Remove a tag — confirm it is unassigned
3. Try to exceed 10 tags — confirm the limit is enforced
4. View the tenant landing page — confirm tags are displayed on meal cards
5. Filter by tag on the landing page — confirm correct meals are shown
6. Check activity log for tag assignment changes

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Tag deleted (F-115) while assigned to meals | Cannot delete tag while assigned (enforced in F-115) |
| Same tag assigned twice | Prevented by unique constraint on pivot table |
| Meal deleted with tags | Pivot records cleaned up via cascade or model events |
| Cook creates a new tag while on the meal edit page | Tag list refreshes to include the new tag |

---

## UI/UX Notes
- Tag section on the meal edit page
- Multi-select dropdown or searchable tag selector
- Assigned tags displayed as chips/badges with X button to remove
- Counter showing "3/10 tags used"
- Link to tag management page if no tags exist
- Real-time update via Gale
- Mobile-friendly tag chips

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-108 | Meal Creation Form | Creates meals that receive tags |
| F-110 | Meal Edit | Tag section is part of the meal edit page |
| F-115 | Cook Tag Management | Creates the tags available for assignment |
| F-128 | Available Meals Grid Display | Displays tags on meal cards |
| F-136 | Meal Filters | Tags used as filter options |
