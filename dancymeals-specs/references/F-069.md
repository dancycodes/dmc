# F-069 â€” Discovery Filters

> Module: Discovery
> Priority: Must-have
> Precedence: F-066
> Type: functional

---

## What It Does

Provides filter controls on the discovery page that allow visitors to narrow down cooks by town, availability, meal tags, and rating range. Filters are displayed in a sidebar on desktop and a bottom sheet on mobile. Multiple filters can be combined. A count badge shows the number of active filters. A "Clear all" button resets all filters. All filter changes update the cook grid via Gale without page reload.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Applies filters to narrow discovery results to relevant cooks |

---

## User Scenarios

### Scenario 1: Filter by town
A visitor selects "Douala" from the town dropdown filter. The grid immediately updates to show only cooks who deliver to Douala. The filter badge shows "1".

### Scenario 2: Filter by availability
A visitor toggles "Available now" to see cooks whose schedule indicates they are currently accepting orders. The grid updates in real-time.

### Scenario 3: Filter by meal tags
A visitor selects "Grilled" and "Traditional" tags. The grid shows cooks who have meals tagged with either (OR logic within tag filter). The filter badge shows "2".

### Scenario 4: Combine multiple filters
A visitor selects town "Yaounde", availability "Available today", and tag "Vegetarian". The grid shows cooks who match ALL three criteria (AND logic between filter categories). The filter badge shows "3".

### Scenario 5: Clear all filters
A visitor has 3 active filters. They click "Clear all filters." All filters reset and the grid returns to showing all cooks. The filter badge disappears.

### Scenario 6: Mobile bottom sheet
On mobile, the visitor taps the filter button (floating action button or toolbar button). A bottom sheet slides up showing all filter options. The visitor selects filters and taps "Apply." The sheet closes and the grid updates.

### Scenario 7: Filter with no results
A visitor applies filters that match no cooks. The grid shows an empty state: "No cooks match your filters. Try adjusting your criteria." with a "Clear filters" button.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-090 | Filter categories: town (single-select), availability (radio: all/available now/available today), meal tags (multi-select), rating range (min rating slider) |
| BR-091 | Filters between categories combine with AND logic (town AND availability AND tags AND rating) |
| BR-092 | Tags within the tag filter combine with OR logic (matches any selected tag) |
| BR-093 | The active filter count badge shows the total number of individual filter values applied |
| BR-094 | "Clear all" resets every filter to its default (unfiltered) state |
| BR-095 | Filter changes update the grid via Gale without page reload |
| BR-096 | Filters combine with any active search query (F-068) |
| BR-097 | Available towns in the filter dropdown are populated from towns that active cooks deliver to (not all towns in the system) |
| BR-098 | "Available now" checks the cook's schedule against the current time in Africa/Douala timezone |
| BR-099 | "Available today" checks the cook's schedule for any remaining availability today |

---

## Data Involved

**Reads:**
- Towns that active cooks deliver to (for filter options)
- Meal tags used by active cooks (for filter options)
- Cook schedules (for availability filtering)
- Cook ratings (for rating range filtering)

**Creates:**
- Nothing

**Updates:**
- Cook card grid content (via Gale fragment update)

---

## Acceptance Criteria

- **Given** the filter sidebar/bottom sheet, **when** a visitor selects a town, **then** the grid shows only cooks delivering to that town
- **Given** "Available now" is selected, **when** filtering applies, **then** only cooks currently accepting orders appear
- **Given** multiple tags selected, **when** filtering applies, **then** cooks with meals matching any selected tag appear
- **Given** a minimum rating of 4, **when** filtering applies, **then** only cooks with average rating >= 4 appear
- **Given** multiple filter categories applied, **when** filtering applies, **then** results match ALL categories simultaneously
- **Given** active filters, **when** the visitor clicks "Clear all", **then** all filters reset and the grid shows all cooks
- **Given** filters produce no results, **when** the grid updates, **then** an empty state with "Clear filters" button is shown
- **Given** a mobile viewport, **when** the visitor taps the filter button, **then** a bottom sheet with filter options slides up

---

## Verification Steps

1. Select a town filter and confirm only relevant cooks appear
2. Select "Available now" and confirm only currently available cooks appear
3. Select multiple tags and confirm cooks with any matching tag appear
4. Set a minimum rating and confirm low-rated cooks are excluded
5. Combine town + availability + tag filters and verify AND logic
6. Click "Clear all" and confirm the grid resets
7. Apply filters that match no cooks and confirm the empty state
8. Test the bottom sheet on mobile viewport

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Only one town exists in the system | Town filter shows single option; still functional |
| No tags exist in the system | Tag filter section is hidden |
| Cook's schedule changes while visitor is filtering | Next filter action re-evaluates with current data |
| Rapid filter toggling | Debounced; only final state triggers a server request |
| Filter options exceed screen height (many tags) | Scrollable within the sidebar/bottom sheet |

---

## UI/UX Notes

- Desktop: sidebar on the left (~280px), always visible alongside the grid
- Mobile: hidden behind a floating filter button; opens as a bottom sheet with drag-to-dismiss
- Filter badge (circle with count) on the filter button and next to "Filters" heading
- Each filter section has a label and collapsible accordion on mobile
- Rating range uses a simple star-row selector (tap 3 stars = minimum 3)
- Town filter uses a searchable dropdown for quick selection
- Tag filter uses pills/chips that can be tapped to toggle
- "Clear all" button only visible when at least one filter is active

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-066 | Discovery Page Layout | Parent page containing the filter UI |
| F-067 | Cook Card Component | Cards filtered by these controls |
| F-068 | Discovery Search | Search combines with filters |
| F-070 | Discovery Sort Options | Sort applies to filtered results |
