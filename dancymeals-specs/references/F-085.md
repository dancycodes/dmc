# F-085 â€” Delete Town

> Module: Location
> Priority: Must-have
> Precedence: F-083
> Type: functional

---

## What It Does

Allows the cook to delete a town from their delivery areas. Deletion is blocked if the town has active orders referencing it. Deleting a town cascade-deletes all quarters within it and their associated delivery fees. A confirmation dialog is shown before deletion. On success, a toast notification confirms the action and the town list updates via Gale.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Removes a town they no longer deliver to |
| Manager | Deletes towns if granted location management permission |

---

## User Scenarios

### Scenario 1: Delete a town with no active orders
A cook clicks "Delete" on "Bafoussam" which has 2 quarters and no active orders. A confirmation dialog appears: "Delete Bafoussam and its 2 quarters? This cannot be undone." The cook confirms. The town and its quarters are deleted. The list updates.

### Scenario 2: Delete blocked by active orders
A cook clicks "Delete" on "Douala" which has active (non-completed) orders. The delete is blocked with a message: "Cannot delete Douala because it has active orders. Complete or cancel the orders first."

### Scenario 3: Cancel deletion
A cook clicks "Delete" on a town. The confirmation dialog appears. They click "Cancel." Nothing is deleted.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-225 | Cannot delete a town that has active (non-completed, non-cancelled) orders referencing it |
| BR-226 | Deleting a town cascade-deletes all its quarters and their delivery fees |
| BR-227 | Deleting a town cascade-removes quarters from any quarter groups they belonged to |
| BR-228 | A confirmation dialog must be shown before deletion with the town name and quarter count |
| BR-229 | On success, toast notification confirms: "Town deleted successfully" |
| BR-230 | Delete action requires location management permission |
| BR-231 | Town list updates via Gale without page reload after deletion |

---

## Data Involved

**Reads:**
- Active orders referencing this town (to check if deletion is allowed)
- Quarter count for this town (for confirmation message)

**Deletes:**
- Town record
- All quarter records within this town
- Quarter group memberships for deleted quarters

**Updates:**
- Town list UI (via Gale)

---

## Acceptance Criteria

- **Given** a town with no active orders, **when** the cook confirms deletion, **then** the town and its quarters are deleted
- **Given** a town with active orders, **when** the cook clicks delete, **then** deletion is blocked with an explanation
- **Given** a town with 3 quarters, **when** deleted, **then** all 3 quarters are also deleted
- **Given** the confirmation dialog, **when** the cook clicks "Cancel", **then** nothing is deleted
- **Given** a successful deletion, **when** the list renders, **then** the town no longer appears

---

## Verification Steps

1. Delete a town with no active orders and confirm it is removed from the list
2. Verify quarters within the deleted town are also deleted from the database
3. Attempt to delete a town with active orders and confirm the block message
4. Cancel a deletion and confirm the town remains
5. Check that the deletion does not cause page reload

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Town is the cook's only town | Allowed to delete; cook will have 0 towns (may need to add new ones for orders) |
| Town with completed orders but no active ones | Deletion allowed; completed orders are historical |
| Network error during deletion | Error toast; town remains intact |
| Deleting town that was just added (no quarters) | Allowed; straightforward deletion |

---

## UI/UX Notes

- Delete button (trash icon) on each town row in the list
- Confirmation dialog: clear warning text, town name, quarter count
- Two buttons in dialog: "Delete" (danger/red) and "Cancel" (neutral)
- Block message appears as a toast or inline warning if active orders exist
- After deletion, the town row fades out of the list

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-083 | Town List View | Delete initiated from the town list |
| F-084 | Edit Town | Alternative action on the town |
| F-086 | Add Quarter | Quarters deleted as part of cascade |
| F-089 | Delete Quarter | Individual quarter deletion (vs cascade) |
