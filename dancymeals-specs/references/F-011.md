# F-011 â€” Tenant Theme Customization Infrastructure

> Module: Foundation
> Priority: Must-have
> Precedence: F-009
> Type: foundation

---

## What It Does
Builds the infrastructure that allows each cook's tenant site to have a unique visual identity. Defines a catalog of preset themes (Arctic, High Contrast, Minimal, Modern, Neo Brutalism, etc.), font families (Inter, Roboto, Poppins, etc.), and border radius options. The cook selects their preferences (via F-214), and the system stores those choices in the tenant settings. When a visitor arrives on a tenant domain, the system dynamically injects CSS custom properties that override the default DancyMeals theme with the cook's selections.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Selects a preset theme, font, and border radius for their site (via F-214) |
| Client | Sees the cook's customized visual identity when visiting the tenant domain |
| Developer | Defines preset themes and the CSS variable override mechanism |

---

## User Scenarios
### Scenario 1: Tenant site with custom theme
A client visits `latifa.dm.test`. Latifa has selected the "Neo Brutalism" theme with "Poppins" font and "sharp" border radius. The site renders with bold colors, thick borders, Poppins typeface, and no rounded corners -- all different from the default DancyMeals look.

### Scenario 2: Tenant with default theme
A new cook has not yet customized their theme. Visitors see the default DancyMeals theme (the "Modern" preset with "Inter" font and medium border radius).

### Scenario 3: Theme preview during selection
While selecting a theme in the cook dashboard (F-214), the cook sees a live preview of how their site will look with each preset, font, and radius combination before saving.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-078 | Preset themes define a complete set of CSS custom properties (colors for light and dark modes) |
| BR-079 | Available preset themes: Arctic, High Contrast, Minimal, Modern (default), Neo Brutalism, and additional presets as defined |
| BR-080 | Available fonts: Inter (default), Roboto, Poppins, Nunito, Open Sans, Montserrat, and additional fonts as defined |
| BR-081 | Border radius options: none (0px), small (4px), medium (8px, default), large (12px), full (16px+) |
| BR-082 | Theme settings are stored in the tenant's `settings` JSON column |
| BR-083 | CSS custom properties are injected dynamically via middleware or Blade component when on a tenant domain |
| BR-084 | Theme customization applies to the tenant's public-facing site only, not the cook dashboard |
| BR-085 | Each preset theme must support both light and dark modes |
| BR-086 | If a tenant has no custom theme, the default "Modern" preset is applied |
| BR-087 | Fonts are loaded via Google Fonts or self-hosted for performance |

---

## Data Involved
**Creates:**
- Theme preset definitions (PHP config or class with CSS variable maps per preset)
- Font catalog with font-family declarations
- Border radius catalog
- Middleware or Blade component that injects tenant CSS variables
- CSS variable override mechanism (inline `<style>` block in `<head>`)

**Reads:**
- Tenant `settings` JSON column for theme, font, and radius selections
- Resolved tenant from request context (F-004)

**Updates:**
- Tenant `settings` JSON structure to include `theme`, `font`, and `border_radius` keys
- Base layout to include the dynamic CSS injection point

**Relationships:**
- Depends on F-009 for the base CSS variable system
- F-214 (Cook Theme Selection) provides the cook-facing UI
- F-126 (Tenant Landing Page) renders with these customizations applied

---

## Acceptance Criteria
- **Given** a tenant with "Arctic" theme selected, **when** visiting their domain, **then** Arctic color scheme CSS variables are applied
- **Given** a tenant with "Poppins" font selected, **when** visiting their domain, **then** all text renders in Poppins
- **Given** a tenant with "none" border radius, **when** visiting their domain, **then** all elements have sharp corners
- **Given** a tenant with no theme customization, **when** visiting their domain, **then** the default "Modern" theme applies
- **Given** a tenant domain in dark mode, **when** the tenant has a custom theme, **then** the dark variant of the custom theme is shown
- **Given** the main DancyMeals domain, **when** visiting, **then** no tenant theme overrides are applied

---

## Verification Steps
1. Create a tenant with "Neo Brutalism" theme and visit their domain -- confirm distinct visual style
2. Create a tenant with "Poppins" font and verify text renders in Poppins
3. Create a tenant with no customization and verify the default theme applies
4. Toggle dark mode on a customized tenant domain and verify dark variant of the custom theme
5. Visit the main domain and confirm no tenant theme overrides are present
6. Change a tenant's theme and revisit the domain to confirm the new theme applies

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Invalid theme name in tenant settings | Falls back to "Modern" default |
| Google Fonts fails to load | System font stack fallback (sans-serif) used gracefully |
| Tenant settings JSON is malformed | Ignored; defaults applied for missing keys |
| Custom theme on admin panel routes | Never applied; admin always uses DancyMeals default theme |
| Very long tenant name affecting header layout | Truncated with ellipsis in themed header |

---

## UI/UX Notes
- No cook-facing UI in this feature (that is F-214). This feature builds the CSS infrastructure.
- Each preset theme should have a meaningful and distinct personality:
  - **Arctic**: Cool blues and whites, clean and calming
  - **High Contrast**: Maximum readability, bold black/white with accent pops
  - **Minimal**: Subtle, neutral tones, ample whitespace
  - **Modern**: Balanced, contemporary palette (the default)
  - **Neo Brutalism**: Bold colors, thick borders, playful and striking
- Font loading should not block page render (use `font-display: swap`).
- Theme CSS injection must happen before the page paints to avoid flash of default theme.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-009 | Theme System (Light/Dark Mode) | Prerequisite; provides the base CSS variable system |
| F-004 | Multi-Tenant Domain Resolution | Required to know which tenant's theme to apply |
| F-126 | Tenant Landing Page Layout | Renders with tenant theme applied |
| F-214 | Cook Theme Selection | Cook-facing UI to select theme, font, and radius |
