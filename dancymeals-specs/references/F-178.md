# F-178 — Rating & Review Display on Meal

> Module: Rating
> Priority: Must-have
> Precedence: F-176
> Type: functional

---

## What It Does
Displays ratings and reviews on the meal detail view (F-129). Shows the meal's average rating (as stars), total review count, and a list of recent reviews. Each review entry shows the client's name (first name + last initial), star rating, review text (if provided), and the date. Reviews are sorted by newest first and paginated if there are many. This allows potential customers to see feedback from previous buyers before ordering.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Reads ratings and reviews on a meal page |
| Cook | Sees how their meals are rated by visiting their own tenant |

---

## User Scenarios
### Scenario 1: View ratings summary on meal
A visitor opens a meal detail page. At the top of the reviews section, they see: "4.3/5 (27 reviews)" with filled stars representing the average. Below, the most recent reviews are listed.

### Scenario 2: Read individual reviews
The visitor scrolls through reviews. Each shows: "Amara N. — 5 stars — Amazing ndole! Perfectly seasoned. — Feb 10, 2026." Some entries have text reviews; others show only the star rating.

### Scenario 3: Meal with no reviews
A new meal has zero reviews. The section shows: "No reviews yet. Be the first to try this meal!" The average rating area shows no stars.

### Scenario 4: Paginated reviews
A popular meal has 50 reviews. The first 10 are displayed. A "Load more" button or pagination controls allow viewing additional reviews.

### Scenario 5: Rating without review text
Some ratings have no text review. These are displayed with just the stars and the client name/date, without an empty text area.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-408 | Average rating is calculated from all ratings for orders containing this meal |
| BR-409 | Average displayed as X.X/5 (one decimal place) with star visualization |
| BR-410 | Review count shows total number of ratings (including those without text) |
| BR-411 | Individual reviews show: client name (first name + last initial), stars, text (if any), date |
| BR-412 | Reviews are sorted by date descending (newest first) |
| BR-413 | Reviews are paginated with 10 per page (configurable) |
| BR-414 | Ratings without review text still appear in the list (showing only stars and metadata) |
| BR-415 | Client name privacy: only first name and last initial are displayed (e.g., "Amara N.") |
| BR-416 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `ratings` table filtered by orders containing this meal
- `users` table for client names
- `orders` and `order_items` to link ratings to specific meals
- Calculated average rating and count

**Creates:**
- Nothing

**Updates:**
- Nothing

**Relationships:**
- Rating belongsTo Order
- Order hasMany OrderItems
- OrderItem belongsTo Meal
- Rating belongsTo User (client)

---

## Acceptance Criteria
- **Given** a meal with ratings, **when** viewing the meal detail, **then** the average rating and review count are displayed
- **Given** a meal with reviews, **when** viewing the review list, **then** each review shows client name, stars, text (if any), and date
- **Given** more than 10 reviews, **when** viewing, **then** pagination or "Load more" controls are available
- **Given** a meal with no ratings, **when** viewing, **then** an empty state message is shown
- **Given** a rating without review text, **when** listed, **then** it shows stars and metadata without empty text placeholder

---

## Verification Steps
1. View a meal with multiple ratings and verify the average and count display
2. Verify individual review entries show correct client name format, stars, text, and date
3. Verify reviews are sorted newest first
4. Verify pagination works with more than 10 reviews
5. View a meal with no reviews and verify the empty state
6. Verify ratings without text reviews are handled gracefully

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client's account is deactivated | Review remains visible; client name still displayed |
| Rating is for an order with multiple meals | Rating appears on each meal's page in the order |
| Average calculation with only 1 rating | Shows that single rating as the average |
| Very long review text (near 500 char limit) | Displayed in full or with "Read more" toggle |
| Same client has multiple orders with the same meal | Each order's rating appears as a separate review |

---

## UI/UX Notes
- Reviews section positioned below the meal description and pricing on the detail page
- Average rating header: large stars + "X.X/5 (N reviews)" text
- Star breakdown (optional): horizontal bars showing count per star level (5-star: 15, 4-star: 8, etc.)
- Individual review cards: compact layout with avatar placeholder, name, stars, text, date
- "Load more" button for additional reviews
- Mobile-first: full-width review cards
- Light/dark mode support
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-176 | Order Rating Prompt | Creates the ratings displayed here |
| F-177 | Order Review Text Submission | Creates the review text displayed here |
| F-129 | Meal Detail View | Reviews section appears on this page |
| F-179 | Cook Overall Rating Calculation | Uses same ratings for cook-level aggregation |
| F-130 | Ratings Summary Display | Summary on tenant landing page |
