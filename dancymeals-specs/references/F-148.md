# F-148 â€” Order Scheduling for Future Date

> Module: Ordering
> Priority: Should-have
> Precedence: F-139, F-098
> Type: functional

---

## What It Does
Allows the client to schedule an order for a future date rather than ordering for the next available slot. Provides a date picker during checkout that shows only dates when the cook is available (based on the cook's schedule). The selected date determines which meals and schedule windows apply. The default behavior is ordering for the next available slot, and scheduling is an optional step.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (authenticated) | Optionally schedules their order for a future date during checkout |

---

## User Scenarios
### Scenario 1: Ordering for next available slot (default)
The client does not interact with the scheduling option. The order defaults to the next available delivery/pickup slot based on the cook's current schedule.

### Scenario 2: Scheduling for a future date
The client clicks "Schedule for later" and sees a calendar. Available dates are highlighted (e.g., Monday through Friday when the cook operates). The client selects next Wednesday. The available time slots for Wednesday are shown. The order is saved with the scheduled date.

### Scenario 3: Unavailable date
The client opens the calendar. Saturday and Sunday are greyed out because the cook does not operate on weekends. The client cannot select those dates.

### Scenario 4: Scheduling affects meal availability
The client schedules for next Monday. Some meals that are only available on specific days (via meal schedule overrides) may not be available on Monday. The cart is validated against the scheduled date's availability.

### Scenario 5: Maximum scheduling window
The calendar only shows dates up to 2 weeks in the future. Dates beyond that are not selectable.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-335 | Scheduling is optional; the default is the next available slot |
| BR-336 | The date picker shows only dates where the cook has at least one available schedule entry |
| BR-337 | Unavailable dates (no schedule entries or all marked unavailable) are disabled in the picker |
| BR-338 | The maximum scheduling window is 14 days from today |
| BR-339 | Past dates and today are not selectable for scheduling (today uses "next available" default) |
| BR-340 | The selected date determines which order/delivery/pickup time windows apply |
| BR-341 | Cart items are validated against the scheduled date's meal availability |
| BR-342 | If a cart item is not available on the scheduled date, a warning is shown |
| BR-343 | The order stores the scheduled date for cook reference |
| BR-344 | All text must be localized via `__()` |

---

## Data Involved
**Reads:**
- Cook schedule entries (to determine available dates)
- Meal schedule overrides (to validate cart items against scheduled date)
- Current date for calendar range

**Creates:**
- Scheduled date entry in checkout session/order draft

**Updates:**
- Checkout session with the scheduled date

**Relationships:**
- Uses schedule data from F-098 (Cook Day Schedule Creation)
- Uses meal schedule overrides from F-106 (Meal Schedule Override)
- Affects order time windows from F-099 (Order Time Interval)
- Part of the checkout flow alongside F-139 (Cart), F-140 (Delivery/Pickup)

---

## Acceptance Criteria
- **Given** the client does not select a date, **when** proceeding, **then** the order defaults to the next available slot
- **Given** the client opens the date picker, **when** viewing the calendar, **then** only available dates are selectable
- **Given** the cook operates Mon-Fri, **when** viewing the calendar, **then** Saturday and Sunday are disabled
- **Given** the client selects a future date, **when** proceeding, **then** the order stores that date
- **Given** a cart item is unavailable on the selected date, **when** the date is selected, **then** a warning is shown
- **Given** dates beyond 14 days, **when** viewing the calendar, **then** those dates are not selectable

---

## Verification Steps
1. Proceed through checkout without scheduling; verify order uses next available slot
2. Click "Schedule for later" and verify the calendar opens
3. Verify unavailable days are greyed out and not selectable
4. Select a future date and verify it is stored with the order
5. Verify dates beyond 14 days are not selectable
6. Add a meal with a schedule override, schedule for a day it is not available, and verify the warning
7. Verify today and past dates are not selectable

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has no available dates in the next 14 days | "Schedule for later" option is hidden or disabled |
| Client schedules then removes the scheduled date | Order reverts to next available slot default |
| Cook changes schedule after client schedules | Order retains the scheduled date; cook sees it on their dashboard |
| All cart items unavailable on scheduled date | Warning shown; suggest changing date or modifying cart |
| Client timezone differs from server | Calendar uses Africa/Douala timezone |

---

## UI/UX Notes
- "Schedule for later" as a toggle or expandable option in the checkout flow
- Calendar widget with available dates highlighted in accent color
- Unavailable dates greyed out
- Current date indicator
- "Next available: [day, time]" shown as the default option
- Selected date displayed prominently with a "Change" link
- Warning messages for cart incompatibilities displayed as inline alerts
- Mobile: full-screen calendar picker

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-139 | Order Cart Management | Cart items validated against scheduled date |
| F-098 | Cook Day Schedule Creation | Source of available dates |
| F-099 | Order Time Interval Configuration | Time windows for the scheduled date |
| F-106 | Meal Schedule Override | Meal-specific availability on scheduled date |
| F-132 | Schedule & Availability Display | Client sees schedule before ordering |
