# F-137 â€” Meal Sort Options

> Module: Meal Search
> Priority: Should-have
> Precedence: F-128
> Type: functional

---

## What It Does
Adds sort controls to the tenant meals page allowing clients to change the order in which meals are displayed in the grid. Sort options include: price (low to high, high to low), popularity (order count), newest, and alphabetical. The default sort is by popularity. Sorting applies via Gale without page reloads and works in combination with active search and filters.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Sorts meals by their preferred criteria to browse more efficiently |

---

## User Scenarios
### Scenario 1: Sorting by price low to high
A visitor selects "Price: Low to High" from the sort dropdown. The meals grid reorders to show the cheapest meals first based on starting price.

### Scenario 2: Sorting by popularity
A visitor selects "Most Popular" (the default). Meals with the highest order count appear first.

### Scenario 3: Sorting by newest
A visitor selects "Newest First." Recently added meals appear at the top of the grid.

### Scenario 4: Sorting with active filters
A visitor has "Traditional" tag filter active and sorts by "Price: High to Low." The filtered results reorder by descending price while maintaining the tag filter.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-234 | Available sort options: "Most Popular" (default), "Price: Low to High", "Price: High to Low", "Newest First", "A to Z" |
| BR-235 | "Most Popular" sorts by total order count descending |
| BR-236 | Price sort uses the meal's starting price (minimum component price) |
| BR-237 | "Newest First" sorts by meal creation date descending |
| BR-238 | "A to Z" sorts alphabetically by the meal name in the current locale |
| BR-239 | Sort is applied via Gale without page reload |
| BR-240 | Sort works in combination with active search (F-135) and filters (F-136) |
| BR-241 | The currently active sort option is visually indicated |
| BR-242 | All sort option labels must be localized via `__()` |

---

## Data Involved
**Reads:**
- Meal starting prices (for price sort)
- Meal order counts (for popularity sort)
- Meal creation dates (for newest sort)
- Meal names in current locale (for alphabetical sort)

**Creates:**
- Sort dropdown Blade component

**Updates:**
- Reorders the meals grid display (F-128) based on selected sort

**Relationships:**
- Operates on the meals displayed by F-128 (Available Meals Grid Display)
- Combinable with F-135 (Meal Search Bar) and F-136 (Meal Filters)

---

## Acceptance Criteria
- **Given** the page loads with default sort, **when** viewing the grid, **then** meals are sorted by popularity (order count descending)
- **Given** the user selects "Price: Low to High", **when** the sort applies, **then** the cheapest meals appear first
- **Given** the user selects "Newest First", **when** the sort applies, **then** recently added meals appear first
- **Given** active filters and a sort change, **when** sort applies, **then** filtered results are reordered without resetting filters
- **Given** the user selects "A to Z" in French locale, **when** the sort applies, **then** meals are sorted by their French names

---

## Verification Steps
1. Verify the default sort is "Most Popular" on page load
2. Select "Price: Low to High" and verify meals reorder correctly
3. Select "Price: High to Low" and verify reverse order
4. Select "Newest First" and verify newest meals appear first
5. Select "A to Z" and verify alphabetical order
6. Apply a filter, then change sort, and verify both work together
7. Verify the active sort option is visually indicated

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| All meals have the same price | Price sort preserves existing order (stable sort) |
| All meals have zero orders | Popularity sort falls back to creation date |
| Two meals with the same name | Secondary sort by creation date |
| Only 1 meal available | Sort dropdown still visible but has no visible effect |

---

## UI/UX Notes
- Sort as a dropdown select positioned above the meals grid, right-aligned
- Current sort option displayed in the dropdown trigger text
- On mobile, sort dropdown is full-width above the grid
- Subtle transition as grid items reorder
- Can also be implemented as horizontal tabs/pills for better visibility

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-128 | Available Meals Grid Display | Grid that is sorted |
| F-135 | Meal Search Bar | Combinable with sort |
| F-136 | Meal Filters | Combinable with sort |
