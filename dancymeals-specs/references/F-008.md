# F-008 â€” Language Switcher Component

> Module: Foundation
> Priority: Must-have
> Precedence: F-007
> Type: foundation

---

## What It Does
Provides a reusable Gale/Alpine.js component that allows users to toggle between English and French. The component persists the user's choice to the session (for guests) and to the user's `preferred_language` field (for authenticated users). The page text updates reactively without a full page reload. The component is accessible from the site navigation on all domains.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Toggles language from the navigation bar |
| Cook | Toggles language from the cook dashboard navigation |
| Admin | Toggles language from the admin panel navigation |
| Guest | Toggles language from the public navigation |

---

## User Scenarios
### Scenario 1: Guest switches language
An unauthenticated user on the main domain clicks the language switcher and selects "Francais". The page text updates to French without a full reload. The choice is stored in the session, so subsequent pages remain in French.

### Scenario 2: Authenticated user switches language
A logged-in user clicks the language switcher. The choice is saved to both the session and their `preferred_language` database field. On their next visit (even from a different device), the platform defaults to their saved preference.

### Scenario 3: Language persists across navigation
After switching to French, the user navigates to different pages via Gale SPA navigation. Every page loads in French without requiring re-selection.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-055 | The language switcher must be accessible on every page via the navigation |
| BR-056 | Switching language must not cause a full page reload; use Gale reactivity |
| BR-057 | For guests, the choice is persisted in the session |
| BR-058 | For authenticated users, the choice is persisted in the session AND the `preferred_language` field |
| BR-059 | The switcher displays the current language and allows switching to the other |
| BR-060 | The component must show language names in their own language ("English" / "Francais") |
| BR-061 | The switcher must work on main domain, tenant domains, and admin panel |

---

## Data Involved
**Creates:**
- Language switcher Blade component (Gale + Alpine.js)
- Route/endpoint for language switching (POST request to update locale)
- Controller method to handle language change

**Reads:**
- Current application locale
- User `preferred_language` (if authenticated)

**Updates:**
- Session `locale` value
- User `preferred_language` in database (if authenticated)
- Application locale for the current request

**Relationships:**
- Depends on F-007 localization infrastructure
- Included in F-016 base layout navigation

---

## Acceptance Criteria
- **Given** the language is English, **when** clicking the switcher and selecting French, **then** all visible text updates to French without a full reload
- **Given** a guest user switches to French, **when** navigating to another page, **then** the new page loads in French
- **Given** an authenticated user switches language, **when** checking the database, **then** their `preferred_language` is updated
- **Given** the switcher component, **when** rendered on a mobile viewport, **then** it is fully accessible and usable
- **Given** any page on any domain, **when** looking at the navigation, **then** the language switcher is visible

---

## Verification Steps
1. Click the language switcher as a guest and confirm text changes to French without reload
2. Navigate to another page and confirm French persists
3. Log in, switch language, and confirm `preferred_language` is updated in the database
4. View the switcher on mobile viewport and confirm it is accessible
5. Confirm the switcher appears on main domain, tenant domain, and admin panel navigation

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| JavaScript disabled | Switcher submits a regular form POST and the page reloads in the new language |
| Session expired while switching | Language change request creates a new session with the selected language |
| Rapid successive toggles | Each request is processed; last one wins |
| User preference conflicts with session | User preference takes priority on next full page load |

---

## UI/UX Notes
- Display as a compact dropdown or toggle button in the navigation bar.
- Show a flag icon or two-letter abbreviation (EN/FR) for quick visual identification.
- Current language should be visually distinct (bold, highlighted, or checked).
- On mobile, the switcher should be in the hamburger menu or easily accessible.
- Smooth transition when text updates (no visual jank).
- The switcher should be placed near the theme switcher (F-010) in the navigation.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-007 | Localization System Setup | Prerequisite; provides the translation infrastructure |
| F-010 | Theme Switcher Component | Sibling component; placed nearby in navigation |
| F-016 | Base Layout & Responsive Navigation | Parent layout that includes this component |
| F-042 | Language Preference Setting | User settings page for language preference |
