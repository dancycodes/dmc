# F-040 — Delete Payment Method

> Module: User Settings
> Type: functional
> Priority: Must-have
> Precedence: F-038

---

## What It Does

Allows an authenticated user to delete a saved payment method. A confirmation dialog is shown
before deletion. Unlike delivery addresses, payment methods can always be deleted — there
are no dependency constraints preventing deletion. On successful deletion, a toast notification
confirms the action.

---

## Who Uses It

- **All authenticated users** removing a saved payment method they no longer need.

---

## User Scenarios

### Happy Path
1. User clicks "Delete" on a payment method in the list (F-038).
2. A confirmation dialog appears: "Delete this payment method? This cannot be undone."
3. User confirms the deletion.
4. The payment method is removed from the database.
5. The method disappears from the list via Gale (no page reload).
6. Toast: "Payment method deleted."

### Alternate Path — Delete the Default Method
1. User deletes the payment method currently set as default.
2. After deletion, if other methods remain, the first remaining method becomes the new default.
3. If no methods remain, there is no default.

### Alternate Path — Cancel Deletion
1. User clicks "Delete."
2. Confirmation dialog appears.
3. User clicks "Cancel."
4. The payment method remains unchanged.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-170 | A confirmation dialog must be shown before deleting a payment method. |
| BR-171 | Payment methods can always be deleted regardless of pending orders (orders store payment info at creation time). |
| BR-172 | If the deleted method was the default, the first remaining method becomes the new default. |
| BR-173 | Users can only delete their own payment methods. |
| BR-174 | Deletion is permanent (hard delete). |

---

## Data Involved

### PaymentMethod Model (deleted)
| Action | Details |
|--------|---------|
| Hard delete | Payment method record removed from database |
| Default reassignment | If deleted method was default, next method becomes default |

---

## Acceptance Criteria

```
Given I click "Delete" on a payment method
When the confirmation dialog appears and I confirm
Then the method is deleted and removed from the list

Given I click "Delete" and then "Cancel"
When I return to the list
Then the method is still there

Given I delete my default method and have other methods
When deletion completes
Then another method becomes the new default

Given I delete my only payment method
When deletion completes
Then the list shows an empty state

Given I have a pending order that used this payment method
When I delete the method
Then the deletion succeeds (orders store their own payment data)
```

---

## Verification Steps

1. Delete a payment method and confirm it is removed from the list and database.
2. Cancel a deletion and confirm the method remains.
3. Delete the default method — confirm another method becomes default.
4. Delete all methods — confirm empty state is displayed.

---

## Edge Cases

- Rapid double-click on delete — handle idempotently, no errors.
- User tries to delete via URL manipulation for another user's method — denied (403).
- User deletes a method while checkout is open in another tab — checkout should re-fetch available methods.

---

## UI/UX Notes

- Confirmation dialog is a modal with "Delete" (red/danger) and "Cancel" buttons.
- Dialog shows the method's label and provider for clarity.
- Deletion animation: card fades out or slides away.
- No page reload — Gale handles the update.
- Light/dark mode support.

---

## Related Features

- **F-038** — Payment Method List (delete action originates here)
- **F-037** — Add Payment Method (user may add a new method after deleting)
- **F-039** — Edit Payment Method (alternative to deletion)
