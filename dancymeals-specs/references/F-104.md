# F-104 — Delete Schedule Template

> Module: Schedule
> Priority: Must-have
> Precedence: F-102
> Type: functional

---

## What It Does
Allows a cook to delete a schedule template. Deleting a template does not affect day schedules that were previously created using it — those schedules retain their interval values because the template's values were copied (not linked) when applied. A confirmation dialog is shown before deletion. The deletion is performed via Gale and logged.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Deletes schedule templates they no longer need |
| Manager | Deletes templates if granted `manage-schedules` permission |

---

## User Scenarios
### Scenario 1: Delete an unused template
The cook clicks delete on a template that has never been applied. A confirmation dialog appears: "Delete template 'Dinner Service'? This cannot be undone." The cook confirms, the template is removed, and the list updates via Gale.

### Scenario 2: Delete a template applied to day schedules
The cook deletes "Lunch Service" which was applied to 3 day schedules. The confirmation dialog includes: "This template was applied to 3 day schedules. Those schedules will keep their current settings." After deletion, the 3 day schedules continue to function normally.

### Scenario 3: Cancel deletion
The cook clicks delete, sees the confirmation dialog, and clicks "Cancel." No deletion occurs.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-146 | Deleting a template does NOT affect day schedules that used it (values were copied, not linked) |
| BR-147 | A confirmation dialog must be shown before deletion |
| BR-148 | The confirmation dialog must mention if the template is applied to day schedules |
| BR-149 | Template deletion is a hard delete (not soft delete) |
| BR-150 | Template deletion is logged via Spatie Activitylog |
| BR-151 | Only users with `manage-schedules` permission can delete templates |
| BR-152 | The `template_id` reference on affected CookSchedule entries is set to null after deletion |

---

## Data Involved
**Creates:**
- Nothing

**Reads:**
- ScheduleTemplate record
- CookSchedule entries referencing this template (for applied-to count in confirmation)

**Updates:**
- CookSchedule entries: `template_id` set to null

**Deletes:**
- ScheduleTemplate record

**Relationships:**
- CookSchedule entries with `template_id` are updated (nullified), not deleted

---

## Acceptance Criteria
- **Given** a template, **when** the cook clicks delete, **then** a confirmation dialog appears
- **Given** confirmation is accepted, **when** processing, **then** the template is deleted and the list updates
- **Given** a template applied to 3 days, **when** deleted, **then** those 3 day schedules still function with their existing values
- **Given** deletion confirmed, **when** checking CookSchedule entries, **then** their `template_id` is null
- **Given** the confirmation dialog, **when** the cook clicks Cancel, **then** no deletion occurs

---

## Verification Steps
1. Delete an unused template — confirm it is removed from the list
2. Delete a template applied to day schedules — confirm schedules retain their values
3. Verify `template_id` on affected schedules is null after deletion
4. Cancel a deletion and verify the template remains
5. Check activity log for the deletion entry
6. Verify unauthorized users cannot delete templates

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Template deleted while another user is viewing it | Template disappears from their list on next Gale update |
| Rapid double-click on delete | Only one deletion request processed; second returns gracefully |
| Last template in the list | Deletion succeeds; empty state shown |

---

## UI/UX Notes
- Delete button with trash icon on template card/row
- Confirmation dialog (modal) with template name and applied-to count
- Dialog buttons: "Delete" (destructive, red) and "Cancel" (neutral)
- After deletion, list refreshes via Gale with success toast
- No page reload

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-101 | Create Schedule Template | Creates the templates that can be deleted here |
| F-102 | Schedule Template List View | Displays the list that updates after deletion |
| F-103 | Edit Schedule Template | Alternative to deletion — edit instead |
