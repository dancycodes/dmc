# F-098 — Cook Day Schedule Creation

> Module: Schedule
> Priority: Must-have
> Precedence: F-076
> Type: functional

---

## What It Does
Allows a cook to create schedule entries for specific days of the week from the cook dashboard. The cook selects a day (Monday through Sunday) and indicates whether they are available on that day. Multiple schedule entries can exist per day to support different service windows (e.g., a lunch slot and a dinner slot). Each schedule entry serves as the foundation for configuring order, delivery, and pickup time intervals in subsequent features. Schedules are tenant-scoped and managed via Gale without page reloads.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Creates and manages day schedules from the cook dashboard |
| Manager | Creates and manages day schedules if granted schedule management permission |

---

## User Scenarios
### Scenario 1: Create a single schedule entry for a day
The cook navigates to the Schedule section of the cook dashboard. They click "Add Schedule," select "Monday" from the day dropdown, and toggle availability to "Available." The schedule entry is saved via Gale with a success toast. The entry appears in the schedule list for Monday.

### Scenario 2: Create multiple entries for the same day
The cook already has a Monday lunch schedule. They create another entry for Monday to cover a dinner window. Both entries appear under Monday in the schedule view. Each entry will independently hold its own time intervals.

### Scenario 3: Mark a day as unavailable
The cook creates a schedule entry for Sunday with availability set to "Unavailable." This explicitly marks Sunday as a non-operating day. No time intervals can be configured for unavailable entries.

### Scenario 4: Manager creates a schedule
A manager with the `manage-schedules` permission navigates to the schedule section and creates a new entry for Wednesday. The system logs the activity with the manager as the causer.

### Scenario 5: Duplicate entry prevention
The cook tries to create a third schedule entry for Monday when the maximum per-day limit has been reached. The system shows a validation error indicating the limit has been exceeded.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-098 | Each schedule entry belongs to a single day of the week (Monday through Sunday) |
| BR-099 | A schedule entry has an availability flag: available or unavailable |
| BR-100 | Multiple schedule entries can exist per day (e.g., lunch and dinner slots), up to a configurable maximum (default 3) |
| BR-101 | Unavailable entries cannot have time intervals configured (order, delivery, pickup) |
| BR-102 | Schedule entries are tenant-scoped and only visible/editable within the cook's tenant |
| BR-103 | Only users with `manage-schedules` permission can create schedule entries |
| BR-104 | Schedule creation is logged via Spatie Activitylog |
| BR-105 | Each schedule entry must have a unique label or position within its day to distinguish multiple slots |

---

## Data Involved
**Creates:**
- `CookSchedule` model with fields: `id`, `tenant_id`, `day_of_week` (enum: monday-sunday), `is_available` (boolean), `label` (nullable, e.g., "Lunch", "Dinner"), `position` (integer for ordering), `created_at`, `updated_at`
- Migration for `cook_schedules` table
- Factory and seeder for CookSchedule

**Reads:**
- Existing schedule entries for the tenant to validate limits
- Tenant context from middleware

**Updates:**
- Nothing (creation only)

**Relationships:**
- CookSchedule belongsTo Tenant
- CookSchedule hasOne OrderTimeInterval (configured in F-099)
- CookSchedule hasOne DeliveryTimeInterval (configured in F-100)
- CookSchedule hasOne PickupTimeInterval (configured in F-100)

---

## Acceptance Criteria
- **Given** a cook on the schedule page, **when** they select a day and set availability to available, **then** a new schedule entry is created and displayed
- **Given** a day with one existing entry, **when** the cook creates another entry for the same day, **then** both entries are listed under that day
- **Given** a day with the maximum entries, **when** the cook tries to add another, **then** a validation error is shown
- **Given** the cook sets availability to unavailable, **when** the entry is saved, **then** no time interval configuration options appear for it
- **Given** a manager without `manage-schedules` permission, **when** they attempt to access the schedule section, **then** they receive a 403 response

---

## Verification Steps
1. Navigate to the Schedule section in the cook dashboard and create an entry for Monday
2. Create a second entry for Monday (e.g., "Dinner") and confirm both appear
3. Attempt to exceed the per-day limit and confirm validation error
4. Create an unavailable entry for Sunday and confirm time interval options are hidden
5. Log in as a manager with permission and create an entry — confirm it succeeds
6. Log in as a manager without permission and confirm access is blocked
7. Check the activity log for the schedule creation entry

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has no schedules at all | Schedule page shows empty state with prompt to create first schedule |
| All 7 days have at least one entry | Cook can still add more entries per day up to the limit |
| Manager permission revoked while on schedule page | Next action re-checks permissions and blocks the request |
| Label field left empty | Defaults to "Slot 1", "Slot 2", etc. based on position |

---

## UI/UX Notes
- Schedule section accessible from cook dashboard sidebar under "Schedule"
- Day selection via dropdown or segmented control (Mon-Sun)
- Availability toggle as a switch component
- Optional label field for naming the slot (e.g., "Lunch", "Dinner")
- Entries grouped by day in the schedule view
- Mobile-first layout with cards per entry
- All interactions via Gale (no page reloads)
- Toast notifications on success/error

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Provides the dashboard shell and navigation |
| F-099 | Order Time Interval Configuration | Configures order windows on schedule entries created here |
| F-100 | Delivery/Pickup Time Interval Config | Configures delivery/pickup windows on entries created here |
| F-101 | Create Schedule Template | Templates can be applied to entries created here |
| F-106 | Meal Schedule Override | Meals can override schedules created here |
| F-107 | Schedule Validation Rules | Validation constraints applied to entries |
