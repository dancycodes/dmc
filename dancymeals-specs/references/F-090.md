# F-090 — Quarter Group Creation

> Module: Location
> Priority: Must-have
> Precedence: F-086
> Type: functional

---

## What It Does

Allows a cook to create a group of quarters that share a common delivery fee. The cook names the group and sets a single delivery fee. Existing quarters can be assigned to the group. When quarters belong to a group, the group's fee overrides any individual quarter fees. This simplifies management for cooks who have many quarters with the same delivery fee.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Creates quarter groups to manage delivery fees efficiently |
| Manager | Creates groups if granted location management permission |

---

## User Scenarios

### Scenario 1: Create a group and assign quarters
A cook clicks "Create Group." They name the group "Central Douala" and set a delivery fee of 300 XAF. They select 3 existing quarters (Akwa, Deido, Bonanjo) to add to the group. After saving, all 3 quarters now show the group fee of 300 XAF.

### Scenario 2: Create an empty group
A cook creates a group "South Douala" with 500 XAF fee but does not assign any quarters yet. The group is saved and appears in the group list. Quarters can be assigned later via edit quarter (F-088).

### Scenario 3: Group with free delivery
A cook creates a group "Nearby" with 0 XAF fee. All quarters in this group get free delivery.

### Scenario 4: Reassign quarters between groups
A cook moves quarter "Akwa" from "Central Douala" (300 XAF) to "Premium Zone" (800 XAF). Akwa now charges 800 XAF for delivery.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-264 | Group name is required (plain text, not translatable — groups are internal management tools) |
| BR-265 | Group name must be unique within this tenant |
| BR-266 | Group delivery fee is required and must be >= 0 XAF |
| BR-267 | The group fee overrides individual quarter fees for all quarters in the group |
| BR-268 | A quarter can belong to at most one group at a time |
| BR-269 | Quarters from any town under this tenant can be assigned to a group |
| BR-270 | Groups are tenant-scoped (tenant_id) |
| BR-271 | Creating a group does not require assigning quarters immediately |
| BR-272 | Fee changes on the group apply to all member quarters for new orders |

---

## Data Involved

**Creates:**
- Quarter group record: id, tenant_id, name, delivery_fee, created_at, updated_at

**Reads:**
- Existing quarters (for assignment selection)
- Existing groups (uniqueness check)

**Updates:**
- Quarter records: quarter_group_id updated for assigned quarters

---

## Acceptance Criteria

- **Given** the group creation form, **when** the cook enters a name, fee, and assigns quarters, **then** the group is created and quarters show the group fee
- **Given** a duplicate group name, **when** submitting, **then** a uniqueness error is shown
- **Given** quarters assigned to the group, **when** viewing their list entries, **then** they show the group name and group fee
- **Given** a group with 0 XAF fee, **when** viewing member quarters, **then** they show "Free delivery"
- **Given** a quarter already in another group, **when** assigned to a new group, **then** it moves to the new group (leaves the old one)

---

## Verification Steps

1. Create a group with a name and fee — confirm it appears in the group list
2. Assign quarters to the group — confirm their fees update to the group fee
3. Attempt a duplicate group name — confirm validation error
4. Create a group with 0 XAF — confirm quarters show "Free delivery"
5. Move a quarter from one group to another — confirm it leaves the old group

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Group with 0 quarters | Allowed; group exists but has no members |
| Deleting a group | Quarters revert to their individual fees (not covered here; separate edit) |
| Group with quarters from multiple towns | Allowed; groups are cross-town within a tenant |
| Very long group name | Max 100 characters; validation enforced |

---

## UI/UX Notes

- "Create Group" button in the Locations section (separate tab or section for groups)
- Form: group name field, delivery fee field (XAF), quarter selection (multi-select with checkboxes)
- Quarter selection shows quarter name and parent town for clarity
- Existing group members highlighted in the selection
- "Save" and "Cancel" buttons
- After creation, group appears in a groups list/section
- Success: toast notification

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-086 | Add Quarter | Quarters can be assigned to groups at creation |
| F-088 | Edit Quarter | Group assignment can be changed on edit |
| F-091 | Delivery Fee Configuration | Groups are part of fee management strategy |
| F-087 | Quarter List View | Group filter and badge in quarter list |
