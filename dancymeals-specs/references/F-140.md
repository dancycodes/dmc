# F-140 â€” Delivery/Pickup Choice Selection

> Module: Ordering
> Priority: Must-have
> Precedence: F-139
> Type: functional

---

## What It Does
Presents the first checkout step after cart review: choosing between delivery and pickup for the order. The client selects one option via radio buttons or a toggle. This choice determines the subsequent steps: delivery requires a location selection (F-141), while pickup requires selecting a pickup point (F-142). The choice also affects fee calculation: delivery incurs a fee based on the quarter, while pickup is always free.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (authenticated) | Chooses delivery or pickup for their order |

---

## User Scenarios
### Scenario 1: Choosing delivery
The client selects "Delivery" from the two options. The interface proceeds to show the delivery location selection form (F-141). A note shows: "Delivery fees vary by location."

### Scenario 2: Choosing pickup
The client selects "Pickup" from the two options. The interface shows available pickup locations (F-142). A note shows: "Pickup is free!"

### Scenario 3: Cook offers only delivery
The cook has no pickup locations configured. The pickup option is disabled or hidden. Delivery is pre-selected as the only choice.

### Scenario 4: Cook offers only pickup
The cook has no delivery areas configured. The delivery option is disabled or hidden. Pickup is pre-selected.

### Scenario 5: Changing choice
The client initially selects delivery, fills in some location details, then switches to pickup. The delivery form hides and the pickup form appears. Previous delivery selections are not lost in case they switch back.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-264 | The client must choose either "Delivery" or "Pickup" to proceed |
| BR-265 | "Delivery" leads to the delivery location selection step (F-141) |
| BR-266 | "Pickup" leads to the pickup location selection step (F-142) |
| BR-267 | If the cook has no pickup locations, the "Pickup" option is hidden or disabled |
| BR-268 | If the cook has no delivery areas, the "Delivery" option is hidden or disabled |
| BR-269 | Delivery shows a note about variable delivery fees |
| BR-270 | Pickup shows a note that it is free |
| BR-271 | The choice persists if the client navigates back and returns to this step |
| BR-272 | This step requires authentication; unauthenticated users are redirected to login |
| BR-273 | All text must be localized via `__()` |

---

## Data Involved
**Reads:**
- Cook's delivery area configuration (to determine if delivery is available)
- Cook's pickup location configuration (to determine if pickup is available)

**Creates:**
- Order delivery method selection (stored in session/order draft)

**Updates:**
- Checkout session with selected delivery method

**Relationships:**
- Follows F-139 (Order Cart Management)
- Leads to F-141 (Delivery Location Selection) or F-142 (Pickup Location Selection)
- Affects F-145 (Delivery Fee Calculation) and F-146 (Order Total Calculation)

---

## Acceptance Criteria
- **Given** a cook with both delivery and pickup, **when** this step loads, **then** both options are available
- **Given** the client selects "Delivery", **when** proceeding, **then** the delivery location form appears
- **Given** the client selects "Pickup", **when** proceeding, **then** the pickup location options appear
- **Given** a cook with no pickup locations, **when** this step loads, **then** only "Delivery" is available
- **Given** a cook with no delivery areas, **when** this step loads, **then** only "Pickup" is available
- **Given** the client switches from delivery to pickup, **when** switching, **then** the correct form appears

---

## Verification Steps
1. Proceed to checkout and verify the delivery/pickup choice is presented
2. Select "Delivery" and verify the location form appears
3. Select "Pickup" and verify the pickup locations appear
4. Test with a cook that only offers delivery; verify pickup is hidden
5. Test with a cook that only offers pickup; verify delivery is hidden
6. Switch between options and verify forms toggle correctly

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has neither delivery areas nor pickup locations | Show error: "This cook has not configured delivery or pickup. Contact them via WhatsApp." |
| Client navigates back to cart and returns | Delivery/pickup choice is preserved |
| Cook disables delivery while client is in checkout | Next interaction re-validates; error shown if option no longer available |

---

## UI/UX Notes
- Two large, clickable card-style radio buttons: one with a delivery truck icon, one with a store/pickup icon
- Selected card has accent border from tenant theme
- Brief description under each option ("Delivered to your door" / "Pick up at cook's location")
- Fee note below selected option
- "Continue" button to proceed to the next step
- Step indicator showing progress (Step 1 of N)
- Mobile: cards stack vertically, full width

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-139 | Order Cart Management | Previous step in checkout |
| F-141 | Delivery Location Selection | Next step if delivery chosen |
| F-142 | Pickup Location Selection | Next step if pickup chosen |
| F-145 | Delivery Fee Calculation | Affected by this choice |
| F-146 | Order Total Calculation | Affected by this choice |
