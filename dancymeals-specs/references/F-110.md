# F-110 — Meal Edit

> Module: Meal
> Priority: Must-have
> Precedence: F-108
> Type: functional

---

## What It Does
Allows a cook to edit a meal's name (English and French) and description (English and French). The edit form is pre-populated with existing values. Both language versions are required when either is provided. Changes are saved via Gale with a success toast. The edit is logged via Spatie Activitylog for audit purposes. The meal edit page also serves as the hub for accessing image management (F-109), component management (F-118-F-125), tags (F-114), schedule override (F-106), and other meal settings.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Edits meal names and descriptions |
| Manager | Edits meals if granted `manage-meals` permission |

---

## User Scenarios
### Scenario 1: Edit meal name
The cook opens the edit page for "Jollof Rice," changes the French name from "Riz Jollof" to "Riz au Jollof," and saves. The change is reflected immediately. Toast: "Meal updated."

### Scenario 2: Edit meal description
The cook updates the English description to include more detail about ingredients. The change saves via Gale.

### Scenario 3: Remove one language translation
The cook tries to clear the French description while keeping the English one. Validation fails: "French description is required when English description is provided."

### Scenario 4: No changes submitted
The cook opens the edit form and clicks Save without making changes. The form submits successfully (no-op) or is smart enough to detect no changes and skip the request.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-210 | Meal name is required in both English and French |
| BR-211 | Meal description is required in both English and French |
| BR-212 | Meal name must remain unique within the tenant (per language) |
| BR-213 | Name max length: 150 characters per language |
| BR-214 | Description max length: 2000 characters per language |
| BR-215 | Only users with `manage-meals` permission can edit meals |
| BR-216 | Meal edits are logged via Spatie Activitylog, recording old and new values |
| BR-217 | Editing does not change the meal's status or availability |

---

## Data Involved
**Creates:**
- Nothing

**Reads:**
- Meal record to populate the edit form
- Other meals for name uniqueness validation

**Updates:**
- Meal record with new name and/or description values

**Relationships:**
- Meal belongsTo Tenant

---

## Acceptance Criteria
- **Given** a meal, **when** the cook edits the name and saves, **then** the new name is stored and displayed
- **Given** a meal, **when** the cook edits the description and saves, **then** the new description is stored
- **Given** an edit that removes one language, **when** submitted, **then** validation fails
- **Given** a successful edit, **when** checking the activity log, **then** the change is recorded with old and new values
- **Given** an edit to a name that conflicts with another meal, **when** submitted, **then** validation fails

---

## Verification Steps
1. Edit a meal name and verify it persists
2. Edit a meal description and verify it persists
3. Try to clear one language — confirm validation error
4. Try to set a duplicate name — confirm validation error
5. Check activity log for the edit entry with before/after values
6. Verify unauthorized users cannot access the edit form

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Special characters in name (accents, hyphens) | Stored and displayed correctly |
| HTML in description | Stripped or escaped to prevent XSS |
| Editing a meal with pending orders | Edit succeeds; orders reference the meal by ID, not name |
| Concurrent edits by cook and manager | Last save wins; activity log records both changes |

---

## UI/UX Notes
- Edit form is the main meal management page, with sections/tabs for: Basic Info (name, description), Images (F-109), Components (F-118-F-125), Tags (F-114), Schedule (F-106), Settings (prep time F-117)
- Basic Info is the default active section
- Form fields: name_en, name_fr, description_en, description_fr
- Description fields as textarea with character counter
- Save button per section or a global save button
- All interactions via Gale
- Toast on success
- Mobile-friendly stacked layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-108 | Meal Creation Form | Creates the meal being edited here |
| F-109 | Meal Image Upload & Carousel | Image section on this edit page |
| F-114 | Meal Tag Assignment | Tag section on this edit page |
| F-106 | Meal Schedule Override | Schedule section on this edit page |
| F-117 | Meal Estimated Preparation Time | Settings section on this edit page |
| F-118 | Meal Component Creation | Component section on this edit page |
