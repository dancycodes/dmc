# F-066 â€” Discovery Page Layout

> Module: Discovery
> Priority: Must-have
> Precedence: F-016, F-004
> Type: functional

---

## What It Does

Renders the main DancyMeals home page on the main domain (dm.test / dancymeals.com). This is the primary entry point for clients discovering cooks and food in their area. Displays a responsive grid of cook cards, a prominent search bar in the header, a filter sidebar (bottom sheet on mobile), a sort dropdown, and paginated or infinite-scroll results. Only cooks with active tenants and at least one available meal are shown. The page loads without authentication and is optimized for mobile-first browsing.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Browses the discovery page to find cooks and meals nearby |
| Admin | Sees the public-facing discovery page (also has admin panel access) |
| Cook | Can visit to see how their card appears among other cooks |

---

## User Scenarios

### Scenario 1: First visit to DancyMeals
A visitor opens `dm.test` in their browser. The discovery page loads with a hero header containing the DancyMeals branding, a search bar, and a tagline (e.g., "Find homemade food near you"). Below the header, a grid of cook cards displays. The visitor scrolls through the grid, seeing cook names, cover images, ratings, and delivery towns.

### Scenario 2: Mobile browsing
A visitor opens DancyMeals on their phone. The layout renders as a single-column grid of cook cards. The filter sidebar is hidden behind a floating filter button that opens a bottom sheet. The search bar is visible in the header. The sort dropdown appears above the grid.

### Scenario 3: No cooks available
A new deployment has no active cooks. The page renders with the header and search bar but the grid area shows an empty state: "No cooks available yet. Check back soon!" with an illustration.

### Scenario 4: Pagination / Infinite scroll
The visitor scrolls to the bottom of the initial cook cards. More cards load automatically (infinite scroll) or pagination controls appear, depending on implementation. The page does not perform a full reload.

### Scenario 5: Tenant domain redirect
A visitor accidentally navigates to a tenant's domain discovery path. Since the discovery page is main-domain-only, this route does not exist on tenant domains.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-066 | The discovery page is accessible ONLY on the main domain (not on tenant domains) |
| BR-067 | Only cooks with `is_active = true` on their tenant AND at least one active, available meal are displayed |
| BR-068 | The page must load without authentication (publicly accessible) |
| BR-069 | Cook cards are loaded in pages of 12 (configurable) for performance |
| BR-070 | The discovery page must be fully responsive: 1 column on mobile, 2 on tablet, 3 on desktop |
| BR-071 | All user-facing text must use `__('English text')` localization |
| BR-072 | The page must support light and dark mode |
| BR-073 | Grid updates (from search, filter, sort, pagination) must happen via Gale without full page reload |

---

## Data Involved

**Reads:**
- `tenants` table (active tenants)
- `users` table (cook profiles: name, bio, cover images)
- `meals` table (to determine active meal count)
- `reviews` / ratings data (average rating per cook)
- `towns` table (primary delivery town per cook)

**Creates:**
- Nothing

**Updates:**
- Nothing

---

## Acceptance Criteria

- **Given** the main domain, **when** a visitor loads the home page, **then** the discovery page renders with header, search bar, and cook card grid
- **Given** active cooks with available meals, **when** the page loads, **then** cook cards are displayed in a responsive grid
- **Given** no active cooks, **when** the page loads, **then** an empty state message is shown
- **Given** more than 12 cooks, **when** the visitor scrolls to the bottom, **then** more cards load without page reload
- **Given** a mobile viewport, **when** the page loads, **then** the grid is single-column and filters are accessible via a bottom sheet
- **Given** a tenant domain, **when** visiting the root path, **then** the discovery page does NOT render (tenant landing page is shown instead)

---

## Verification Steps

1. Visit `dm.test` and confirm the discovery page loads with header, search bar, and grid
2. Verify at least one cook card is visible (with seeded data)
3. Resize to mobile width and confirm single-column layout and bottom sheet filter trigger
4. Resize to tablet and confirm two-column layout
5. Resize to desktop and confirm three-column layout
6. Toggle dark mode and confirm all elements render correctly
7. Switch language to French and confirm all text is translated
8. Verify the page is accessible without logging in

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has active tenant but zero active meals | Cook is not displayed in the grid |
| Cook's tenant is inactive | Cook is not displayed |
| Very long cook name | Truncated with ellipsis on the card |
| Slow network connection | Loading skeleton/placeholder cards shown while data loads |
| Hundreds of cooks | Pagination/infinite scroll handles large datasets without performance degradation |

---

## UI/UX Notes

- Hero header with DancyMeals logo, tagline, and centered search bar
- Below header: filter button (mobile) or sidebar (desktop), sort dropdown, result count
- Grid area with consistent card spacing
- Loading skeletons while cards load
- Smooth scroll-to-top button appears after scrolling down
- Footer with platform information, language switcher, and links

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-004 | Multi-Tenant Domain Resolution | Discovery page only renders on main domain |
| F-016 | Base Layout & Responsive Navigation | Provides the page shell and navigation |
| F-067 | Cook Card Component | Individual card component rendered in the grid |
| F-068 | Discovery Search | Search functionality integrated into the header |
| F-069 | Discovery Filters | Filter sidebar/bottom sheet on this page |
| F-070 | Discovery Sort Options | Sort dropdown on this page |
