# F-200 â€” Cook Revenue Analytics

> Module: Analytics
> Priority: Should-have
> Precedence: F-076, F-151
> Type: functional

---

## What It Does
Provides a revenue dashboard for cooks within the cook dashboard. Displays interactive charts showing daily, weekly, and monthly revenue over time (line chart) and revenue breakdown by meal (pie/bar chart). Summary cards show total revenue (all time), this month's revenue, this week's revenue, and today's revenue. A date range selector allows the cook to view revenue for custom periods. A comparison toggle shows the current period versus the previous period (e.g., this month vs last month).

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Views revenue analytics in the cook dashboard |
| Manager | Views revenue analytics if granted `view-analytics` permission |

---

## User Scenarios
### Scenario 1: View revenue overview
The cook navigates to the Analytics section and sees summary cards: "Total Revenue: 2,450,000 XAF," "This Month: 320,000 XAF," "This Week: 85,000 XAF," "Today: 12,500 XAF." Below, a line chart shows daily revenue for the current month.

### Scenario 2: Change time period
The cook selects "Last 3 Months" from the date range selector. The line chart updates to show weekly revenue points over the last 3 months. Summary cards update to reflect the selected period.

### Scenario 3: Revenue by meal
The cook scrolls to the revenue-by-meal chart (pie or bar). It shows "Ndole: 35%, Jollof Rice: 25%, Eru: 20%, Others: 20%." Clicking a segment shows the exact amount.

### Scenario 4: Period comparison
The cook toggles "Compare with previous period." The line chart overlays the previous period's revenue in a lighter color. Summary cards show percentage change (e.g., "+15% vs last month").

### Scenario 5: No revenue data
A new cook with no orders sees empty charts with a message: "No revenue data yet. Your revenue analytics will appear here once you receive your first paid order."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-368 | Revenue data is tenant-scoped; only the cook's own orders are included |
| BR-369 | Revenue is calculated from completed/delivered orders only (not cancelled or refunded) |
| BR-370 | Revenue amounts are the cook's portion (after platform commission deduction) |
| BR-371 | Default view shows the current month with daily granularity |
| BR-372 | Date range options: Today, This Week, This Month, Last 3 Months, Last 6 Months, This Year, Custom |
| BR-373 | Granularity auto-adjusts: daily for <= 31 days, weekly for <= 6 months, monthly for > 6 months |
| BR-374 | Revenue by meal chart shows the top 10 meals; remaining grouped as "Others" |
| BR-375 | Comparison shows the equivalent previous period (e.g., this month vs last month) |
| BR-376 | All amounts displayed in XAF format |
| BR-377 | Charts update via Gale when date range changes (no page reload) |
| BR-378 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table filtered by `tenant_id`, status (Completed/Delivered), and date range
- `order_items` table for per-meal revenue breakdown
- `meals` table for meal names
- Commission configuration for net revenue calculation

**Creates:**
- Nothing (read-only dashboard)

**Updates:**
- Nothing

**Relationships:**
- Order belongsTo Tenant
- Order hasMany OrderItem
- OrderItem belongsTo Meal

---

## Acceptance Criteria
- **Given** a cook with orders, **when** viewing the analytics page, **then** summary cards show correct revenue figures
- **Given** the default view, **when** loaded, **then** a line chart shows daily revenue for the current month
- **Given** a date range selection, **when** changed, **then** the chart and summary cards update accordingly
- **Given** the revenue-by-meal chart, **when** viewed, **then** it shows the top 10 meals by revenue
- **Given** comparison mode enabled, **when** viewing, **then** the previous period is overlaid on the chart
- **Given** a cook with no orders, **when** viewing analytics, **then** an empty state message is shown

---

## Verification Steps
1. Navigate to the analytics page and verify summary cards show correct values
2. Verify the line chart displays daily revenue for the current month
3. Change the date range and verify the chart updates
4. Verify the revenue-by-meal chart shows correct breakdown
5. Enable comparison mode and verify the overlay works
6. Test with a cook with no orders and verify the empty state
7. Verify amounts are in XAF format
8. Test with a manager with and without `view-analytics` permission

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Only one order ever | Charts show a single data point; summary cards still accurate |
| Refunded order | Excluded from revenue calculations |
| Custom date range with no orders | Charts show zero line; summary cards show 0 XAF |
| Cook with 1000+ orders | Aggregation is performant; no timeout |
| Revenue by meal with 50+ meals | Top 10 shown; rest grouped as "Others" |

---

## UI/UX Notes
- Analytics section in cook dashboard sidebar under "Analytics" or "Insights"
- Summary cards at the top in a responsive 4-column grid (stacks on mobile)
- Line chart below with smooth curves and data point tooltips
- Revenue by meal as a horizontal bar chart or donut chart below the line chart
- Date range selector as a dropdown with preset options and a custom date picker
- Comparison toggle as a switch/checkbox
- Chart colors follow the tenant's theme
- Loading skeletons while chart data loads
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Dashboard shell for analytics |
| F-151 | Payment Webhook Handling | Creates the payment data for revenue calculations |
| F-201 | Cook Order Analytics | Sibling analytics feature for orders |
| F-208 | Analytics CSV/PDF Export | Export this data |
