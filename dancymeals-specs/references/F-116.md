# F-116 — Meal List View (Cook Dashboard)

> Module: Meal
> Priority: Must-have
> Precedence: F-108
> Type: functional

---

## What It Does
Displays a list of all the cook's meals in the cook dashboard. Each meal row shows an image thumbnail, name (in the user's preferred language), status (draft/live), availability status, component count, and order count. The list supports filtering by status and availability, searching by name, and sorting by name, created date, or order count. Quick toggles for status (draft/live) and availability (available/unavailable) are available directly on each row. The view is rendered via Gale.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Views and manages their meal catalog |
| Manager | Views and manages meals if granted `manage-meals` permission |

---

## User Scenarios
### Scenario 1: View all meals
The cook navigates to the Meals section. A list of 12 meals is displayed with thumbnails, names, status badges, availability indicators, component counts, and order counts.

### Scenario 2: Filter by status
The cook selects "Draft" from the status filter. Only draft meals are shown (e.g., 3 of 12).

### Scenario 3: Search by name
The cook types "Jollof" in the search field. Only meals containing "Jollof" in their name (EN or FR) are displayed.

### Scenario 4: Quick toggle status
The cook clicks the status toggle on "New Dish" to change it from draft to live. The status updates inline via Gale with validation (must have components).

### Scenario 5: Quick toggle availability
The cook clicks the availability toggle on "Jollof Rice" to mark it as unavailable. The toggle updates inline via Gale.

### Scenario 6: Sort by order count
The cook sorts by "Most Ordered." Meals reorder with the most popular first.

### Scenario 7: Navigate to meal edit
The cook clicks on a meal name or edit button. They are navigated to the meal edit page (F-110).

---

## Business Rules
| Code | Rule |
|------|------|
| BR-261 | Meal list is tenant-scoped — only shows meals for the current tenant |
| BR-262 | Soft-deleted meals are excluded from the list (unless a "show deleted" filter is provided) |
| BR-263 | Search matches against both name_en and name_fr |
| BR-264 | Status filter options: All, Draft, Live |
| BR-265 | Availability filter options: All, Available, Unavailable |
| BR-266 | Sort options: Name (A-Z), Name (Z-A), Newest First, Oldest First, Most Ordered |
| BR-267 | Quick toggles respect the same business rules as F-112 and F-113 |
| BR-268 | Only users with `manage-meals` permission can access the meal list |
| BR-269 | Component count and order count are displayed for each meal |

---

## Data Involved
**Creates:**
- Nothing (read-only view with inline toggles)

**Reads:**
- Meals for the current tenant with eager loading: images (first image for thumbnail), components (count), orders (count)
- Filter and sort parameters from the request

**Updates:**
- Meal status and availability via quick toggles (delegates to F-112 and F-113 logic)

**Relationships:**
- Meal hasMany MealComponents (count)
- Meal hasMany MealImages (first for thumbnail)
- Meal hasMany Orders (count)

---

## Acceptance Criteria
- **Given** a cook with 10 meals, **when** viewing the meal list, **then** all 10 meals are displayed with correct data
- **Given** a status filter of "Draft," **when** applied, **then** only draft meals are shown
- **Given** a search query "Jollof," **when** submitted, **then** matching meals are displayed
- **Given** a quick status toggle, **when** clicked, **then** the status updates inline
- **Given** sorting by "Most Ordered," **when** applied, **then** meals reorder correctly
- **Given** a meal with no images, **when** displayed, **then** a placeholder thumbnail is shown

---

## Verification Steps
1. View the meal list — confirm all meals are displayed with correct data
2. Apply status filter — confirm only matching meals show
3. Apply availability filter — confirm only matching meals show
4. Search by name — confirm search results are correct
5. Quick toggle status on a meal with components — confirm it works
6. Quick toggle status on a meal without components — confirm it is blocked
7. Quick toggle availability — confirm it works
8. Sort by different options — confirm ordering changes
9. Click a meal name — confirm navigation to edit page

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No meals exist | Empty state with "Create your first meal" prompt and button |
| All meals filtered out | "No meals match your filters" message |
| Meal with 0 images | Placeholder thumbnail displayed |
| Meal with 0 components | Component count shows "0" with a warning indicator |
| Very long meal name | Truncated with ellipsis in the list |
| Many meals (50+) | Pagination or infinite scroll |

---

## UI/UX Notes
- Table layout on desktop, card layout on mobile
- Columns (desktop): Thumbnail, Name, Status, Availability, Components, Orders, Actions
- Each row has: status toggle, availability toggle, edit button, delete button
- Filter bar at the top with status dropdown, availability dropdown, and search input
- Sort dropdown
- "Add Meal" button prominently placed
- Status badges: "Draft" (grey), "Live" (green)
- Availability badges: "Available" (green), "Unavailable" (red/grey)
- All interactions via Gale
- Responsive with appropriate column hiding on mobile

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-108 | Meal Creation Form | "Add Meal" button navigates to creation |
| F-110 | Meal Edit | Row click navigates to edit |
| F-111 | Meal Delete | Delete button triggers deletion |
| F-112 | Meal Status Toggle | Quick toggle delegates to status logic |
| F-113 | Meal Availability Toggle | Quick toggle delegates to availability logic |
