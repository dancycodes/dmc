# F-099 — Order Time Interval Configuration

> Module: Schedule
> Priority: Must-have
> Precedence: F-098
> Type: functional

---

## What It Does
For a given cook schedule entry, configures the time window during which clients can place orders. The order interval is defined relative to the schedule's open day. The start time can be on the same day, the day before, or up to N days before the open day. The end time can be on the same day or the day before. For example, "Orders accepted from 6:00 PM the day before to 8:00 AM on the same day." This allows cooks to set flexible advance-ordering windows. Configuration is done via Gale within the schedule management interface.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Configures order time intervals on their schedule entries |
| Manager | Configures intervals if granted `manage-schedules` permission |

---

## User Scenarios
### Scenario 1: Same-day ordering only
The cook sets the order interval for a Monday schedule: start at 6:00 AM same day, end at 10:00 AM same day. Clients can only order Monday meals between 6 AM and 10 AM on Monday.

### Scenario 2: Day-before ordering
The cook sets: start at 6:00 PM day before (Sunday), end at 8:00 AM same day (Monday). Clients can order Monday meals starting Sunday evening through Monday morning.

### Scenario 3: Multiple days before
The cook sets: start at 12:00 PM 2 days before (Saturday), end at 6:00 PM day before (Sunday). Clients must order Monday meals between Saturday noon and Sunday evening.

### Scenario 4: Invalid interval — end before start
The cook tries to set start at 10:00 AM same day and end at 8:00 AM same day (end is chronologically before start). Validation fails with a clear error message.

### Scenario 5: Edit existing interval
The cook modifies a previously configured interval from same-day to day-before. The change saves via Gale with a success toast. Existing orders placed under the old window are unaffected.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-106 | Order interval start is defined as a time + day offset (same day, 1 day before, 2 days before, ... up to 7 days before) |
| BR-107 | Order interval end is defined as a time + day offset (same day or 1 day before) |
| BR-108 | The start datetime must be chronologically before the end datetime when resolved to absolute times |
| BR-109 | Time format is 24-hour (HH:MM) |
| BR-110 | The day offset for start cannot exceed 7 days before the open day |
| BR-111 | The end day offset must be same day or 1 day before (cannot end earlier than 1 day before) |
| BR-112 | Only available schedule entries (is_available = true) can have order intervals configured |
| BR-113 | The order interval must be configured before delivery/pickup intervals (prerequisite for F-100) |
| BR-114 | Changes to the order interval do not affect already-placed orders |
| BR-115 | Order interval configuration is logged via Spatie Activitylog |

---

## Data Involved
**Creates:**
- Order time interval fields on `CookSchedule` or a related `ScheduleOrderInterval` model: `order_start_time` (time), `order_start_day_offset` (integer, 0 = same day, 1 = day before, etc.), `order_end_time` (time), `order_end_day_offset` (integer, 0 or 1)

**Reads:**
- CookSchedule entry to validate availability
- Existing interval data for edit

**Updates:**
- CookSchedule or related interval record with new time configuration

**Relationships:**
- ScheduleOrderInterval belongsTo CookSchedule (or fields directly on CookSchedule)

---

## Acceptance Criteria
- **Given** an available schedule entry, **when** the cook sets start to 6:00 PM day before and end to 8:00 AM same day, **then** the interval is saved and displayed correctly
- **Given** an unavailable schedule entry, **when** the cook attempts to configure an order interval, **then** the option is disabled or hidden
- **Given** an interval where end is before start chronologically, **when** submitted, **then** validation rejects with a clear error
- **Given** a start day offset of 8, **when** submitted, **then** validation rejects (max 7 days before)
- **Given** an existing interval, **when** the cook edits the times, **then** the update saves via Gale with a success toast
- **Given** the interval is saved, **when** viewing the schedule entry, **then** a human-readable summary displays (e.g., "Orders: 6:00 PM day before to 8:00 AM same day")

---

## Verification Steps
1. Configure a same-day order interval and verify it saves correctly
2. Configure a day-before-to-same-day interval and verify the summary text
3. Attempt to set end before start and verify validation error
4. Attempt to set day offset beyond 7 and verify validation error
5. Try to configure an interval on an unavailable entry and verify it is blocked
6. Edit an existing interval and verify the update persists
7. Check the activity log for interval configuration changes

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Start and end at exactly the same time | Validation error — interval must have a positive duration |
| Midnight crossing (e.g., start 11 PM, end 1 AM) | Handled correctly via day offset (start day before 11 PM, end same day 1 AM) |
| Schedule entry deleted after interval configured | Interval is cascade-deleted with the schedule entry |
| Cook changes entry from available to unavailable | Interval data is retained but hidden; re-enabling restores it |

---

## UI/UX Notes
- Appears as a collapsible section within the schedule entry edit view
- Start time: time picker + day offset dropdown ("Same day", "1 day before", "2 days before", ... "7 days before")
- End time: time picker + day offset dropdown ("Same day", "1 day before")
- Human-readable preview below the inputs (e.g., "Orders accepted from Sun 6:00 PM to Mon 8:00 AM")
- Time picker in 30-minute increments by default, with manual override for custom times
- Mobile-friendly layout with stacked fields
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-098 | Cook Day Schedule Creation | Provides the schedule entry this interval is configured on |
| F-100 | Delivery/Pickup Time Interval Config | Must start at or after this interval ends |
| F-101 | Create Schedule Template | Templates include order interval configuration |
| F-107 | Schedule Validation Rules | Cross-validates order interval with delivery/pickup |
