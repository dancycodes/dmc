# F-147 â€” Location Not Available Flow

> Module: Ordering
> Priority: Must-have
> Precedence: F-141
> Type: edge-case

---

## What It Does
Handles the scenario where a client's desired delivery quarter is not in the cook's configured delivery areas. Instead of blocking the client with a dead end, this feature displays a helpful message explaining that delivery to the desired area is not currently available, shows the cook's WhatsApp number and phone number, and provides clear instructions to contact the cook to inquire about delivery to their area. The cook can then add the quarter from their dashboard if they choose to serve that area.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (authenticated) | Sees a message and contact options when their area is not covered |
| Cook | Receives WhatsApp inquiries about new delivery areas and can add them |

---

## User Scenarios
### Scenario 1: Quarter not in delivery areas
The client selects "Douala" as town. They need delivery to "Logpom" quarter but Logpom is not in the cook's delivery areas list. A message appears: "Delivery to Logpom is not currently available." Below it: "Contact Chef Latifa to inquire about delivery to your area" with a WhatsApp button and phone number.

### Scenario 2: WhatsApp contact
The client clicks the WhatsApp button. WhatsApp opens with a pre-filled message: "Hi Chef Latifa, I'd like to order from DancyMeals but I'm in Logpom, Douala. Is delivery to my area possible?"

### Scenario 3: Client switches to pickup
After seeing that delivery is not available to their area, the client clicks "Switch to Pickup" and is redirected to the pickup location selection (F-142).

### Scenario 4: Client selects a different quarter
The client sees the message but then changes the quarter dropdown to "Akwa" which is available. The "not available" message disappears and the delivery fee for Akwa is shown.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-327 | When a client's quarter is not in the cook's delivery areas, a clear message is displayed |
| BR-328 | Message format: "Delivery to {quarter} is not currently available." |
| BR-329 | Cook's WhatsApp number and phone number are displayed with action buttons |
| BR-330 | WhatsApp message is pre-filled with the client's location and inquiry text (localized) |
| BR-331 | A "Switch to Pickup" option is provided if the cook has pickup locations |
| BR-332 | The client can still select a different quarter from the dropdown |
| BR-333 | This flow does not block the entire checkout; only delivery to that specific quarter |
| BR-334 | All text must be localized via `__()` |

---

## Data Involved
**Reads:**
- Cook's delivery area configuration (to determine available quarters)
- Cook's WhatsApp number and phone number
- Cook's brand name
- Client's selected quarter name

**Creates:**
- Nothing

**Updates:**
- Nothing

**Relationships:**
- Triggered by F-141 (Delivery Location Selection) when a quarter is not available
- Uses cook contact info displayed by F-134 (WhatsApp Contact & Social Links)
- Can redirect to F-142 (Pickup Location Selection)

---

## Acceptance Criteria
- **Given** the client selects a quarter not in the cook's delivery areas, **when** the selection processes, **then** the "not available" message is displayed
- **Given** the "not available" message is shown, **when** viewing the message, **then** WhatsApp and phone contact options are visible
- **Given** the client clicks WhatsApp, **when** WhatsApp opens, **then** the message includes the client's quarter and inquiry text
- **Given** the cook has pickup locations, **when** the message is shown, **then** a "Switch to Pickup" option appears
- **Given** the client changes to an available quarter, **when** the change processes, **then** the message disappears and normal delivery flow resumes

---

## Verification Steps
1. Select a town then select a quarter not in the cook's delivery areas
2. Verify the "not available" message displays with the correct quarter name
3. Verify WhatsApp and phone contact options are shown
4. Click the WhatsApp button and verify the pre-filled message
5. Click "Switch to Pickup" and verify redirection to pickup selection
6. Change to an available quarter and verify normal delivery flow resumes

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has no WhatsApp number | Only phone number is shown; no WhatsApp button |
| Cook has neither WhatsApp nor phone | Show generic message: "Please contact the cook through their social media." |
| Cook has no pickup locations | "Switch to Pickup" option is hidden |
| Client enters a neighbourhood in a non-available quarter manually | Quarter validation still triggers the message |
| All quarters in the selected town are unavailable | Message applies to each quarter selected; town is technically available but quarters are not |

---

## UI/UX Notes
- Message displayed as an info/warning card below the quarter selection dropdown
- Amber/warning color scheme with an info icon
- Cook's WhatsApp: green button with WhatsApp icon
- Cook's phone: text link with phone icon
- "Switch to Pickup" as a secondary action button
- Message is not modal; the client can still interact with the form
- Smooth transition: message appears/disappears as quarter selection changes

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-141 | Delivery Location Selection | Context where this flow triggers |
| F-134 | WhatsApp Contact & Social Links | Source of cook contact data |
| F-142 | Pickup Location Selection | Alternative path via "Switch to Pickup" |
| F-091 | Delivery Area Management | Cook can add the quarter from here |
