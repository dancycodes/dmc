# F-010 â€” Theme Switcher Component

> Module: Foundation
> Priority: Must-have
> Precedence: F-009
> Type: foundation

---

## What It Does
Provides a reusable component that allows users to toggle between light mode, dark mode, and system (auto-detect) theme. The component persists the choice to `localStorage` for instant application and to the user's database profile for authenticated users. The theme applies reactively without a full page reload. The component is accessible from the site navigation alongside the language switcher.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Toggles theme from the navigation bar |
| Cook | Toggles theme from the cook dashboard navigation |
| Admin | Toggles theme from the admin panel navigation |
| Guest | Toggles theme from the public navigation |

---

## User Scenarios
### Scenario 1: User switches to dark mode
A user in light mode clicks the theme switcher and selects "Dark". The page transitions smoothly to dark mode. The choice is saved to `localStorage` and (if authenticated) to their profile.

### Scenario 2: User selects system mode
A user selects "System" from the theme options. The site immediately matches their OS preference. If they later change their OS setting, the site follows.

### Scenario 3: Authenticated user theme persists across devices
A logged-in user selects dark mode on their phone. Later, they log in on a different device. The dark mode preference is loaded from the database and applied.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-070 | The theme switcher must offer three options: Light, Dark, System |
| BR-071 | Switching theme must not cause a full page reload |
| BR-072 | Theme changes apply instantly with a smooth CSS transition |
| BR-073 | For guests, the choice persists in `localStorage` only |
| BR-074 | For authenticated users, the choice persists in `localStorage` AND the database |
| BR-075 | The component must be accessible (keyboard navigable, screen reader friendly) |
| BR-076 | The switcher must work identically on main domain, tenant domains, and admin panel |
| BR-077 | Each option should have an icon: sun (light), moon (dark), monitor/auto (system) |

---

## Data Involved
**Creates:**
- Theme switcher Blade component (Alpine.js for client-side reactivity)
- Route/endpoint for persisting theme choice to database (authenticated users only)

**Reads:**
- Current theme from `localStorage`
- User `theme_preference` field (if authenticated)

**Updates:**
- `localStorage` theme value
- `<html>` element class (adds/removes `dark` class)
- User `theme_preference` in database (if authenticated)

**Relationships:**
- Depends on F-009 theme system infrastructure
- Included in F-016 base layout navigation alongside language switcher (F-008)

---

## Acceptance Criteria
- **Given** the theme is light, **when** selecting "Dark", **then** the page transitions to dark mode without reload
- **Given** the theme is dark, **when** selecting "System", **then** the page matches the OS preference
- **Given** a guest user selects dark mode, **when** refreshing the page, **then** dark mode is still active (from `localStorage`)
- **Given** an authenticated user changes theme, **when** checking the database, **then** `theme_preference` is updated
- **Given** any viewport size, **when** the switcher is rendered, **then** it is fully usable on mobile and desktop
- **Given** the navigation, **when** looking at the switcher area, **then** it appears alongside the language switcher

---

## Verification Steps
1. Click the theme switcher and select "Dark" -- confirm dark mode applies without reload
2. Select "Light" -- confirm light mode applies
3. Select "System" -- confirm it matches OS preference
4. Refresh the page after selecting dark mode -- confirm no flash and dark mode persists
5. Log in, change theme, and verify database `theme_preference` is updated
6. Test on a mobile viewport and confirm the switcher is accessible

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| `localStorage` unavailable | Theme still toggles for current session; no persistence across page loads |
| Database save fails (network error) | `localStorage` still saves; database syncs on next successful request |
| User has DB preference but cleared `localStorage` | On page load, DB preference is written to `localStorage` and applied |
| OS theme changes while "System" is active | Theme updates in real-time via `matchMedia` listener |

---

## UI/UX Notes
- Display as a small dropdown or segmented control with three icons: sun, moon, and monitor/auto.
- Current selection should be visually highlighted.
- Smooth transition animation (200-300ms) when switching themes.
- On mobile, place within the hamburger menu or as a compact icon button.
- Group with the language switcher (F-008) in the navigation for a unified settings area.
- Tooltip or label on hover to clarify each option.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-009 | Theme System (Light/Dark Mode) | Prerequisite; provides the CSS infrastructure |
| F-008 | Language Switcher Component | Sibling component; placed nearby in navigation |
| F-016 | Base Layout & Responsive Navigation | Parent layout that includes this component |
| F-011 | Tenant Theme Customization | Extends the theme system with per-tenant customizations |
