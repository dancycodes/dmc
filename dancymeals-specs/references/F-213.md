# F-213 â€” Minimum Order Amount Configuration

> Module: Cook Settings
> Priority: Must-have
> Precedence: F-076
> Type: functional

---

## What It Does
Allows a cook to set a minimum order amount (in XAF) that clients must meet before they can proceed to checkout. The default is 0 (no minimum). The cook can set a value between 0 and 100,000 XAF. When a client's cart total is below the configured minimum, the checkout button is disabled and a message shows how much more they need to add. The minimum order amount is displayed on the tenant landing page and in the cart view. All changes to this setting are logged via Spatie Activitylog.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Sets the minimum order amount in tenant settings |
| Manager | Can view the setting if granted appropriate permissions, but cannot change cook settings |
| Client | Sees the minimum on the landing page; receives feedback in cart when below threshold |
| Admin | Can view the setting in tenant details |

---

## User Scenarios
### Scenario 1: Cook sets a minimum order amount
The cook navigates to Settings, sets the minimum order amount to 2,000 XAF, and saves. A success toast confirms the change. Clients placing new orders must have at least 2,000 XAF in their cart before checkout is available.

### Scenario 2: Client's cart is below the minimum
A client adds items totaling 1,500 XAF to their cart. The checkout button is disabled with the message: "Add 500 XAF more to meet the minimum order of 2,000 XAF." As the client adds more items and the total reaches 2,000 XAF, the checkout button becomes enabled via Gale.

### Scenario 3: Client sees the minimum on the landing page
A client visits `latifa.dm.test` and sees: "Minimum order: 2,000 XAF" in the ordering information section.

### Scenario 4: Cook removes the minimum
The cook sets the minimum back to 0 XAF. All carts can now proceed to checkout regardless of total.

### Scenario 5: Minimum with promo code applied
A client's cart subtotal is 2,500 XAF. They apply a promo code for 600 XAF off, bringing the total to 1,900 XAF. Since the post-discount total is below the 2,000 XAF minimum, checkout is blocked.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-507 | Default minimum order amount is 0 XAF (no minimum) |
| BR-508 | Allowed range: 0 to 100,000 XAF (inclusive) |
| BR-509 | Value must be a whole number (integer XAF) |
| BR-510 | When a client's cart total (after promo discounts) is below the minimum, the checkout button is disabled |
| BR-511 | The disabled checkout button shows a message indicating the remaining amount needed |
| BR-512 | The minimum order amount is displayed on the tenant landing page |
| BR-513 | The minimum order amount is displayed in the cart view |
| BR-514 | Setting a minimum of 0 effectively disables the minimum order requirement |
| BR-515 | Only the cook can modify this setting (not managers) |
| BR-516 | The minimum is evaluated against the food subtotal after promo discount, excluding delivery fees |
| BR-517 | All changes are logged via Spatie Activitylog with old and new values |
| BR-518 | All user-facing text must use `__()` localization |
| BR-519 | Gale reactively updates the checkout button and message as the cart changes |

---

## Data Involved
**Creates:**
- Activity log entry for setting changes

**Reads:**
- Current tenant's `minimum_order_amount` setting
- Client's cart total for checkout validation

**Updates:**
- Tenant `settings` JSON column (`minimum_order_amount` key)

**Relationships:**
- Setting is read during checkout validation (F-146, F-148)
- Displayed on tenant landing page (F-126) and cart (F-139)

---

## Acceptance Criteria
- **Given** a new tenant, **when** viewing the minimum order setting, **then** the default is 0 XAF
- **Given** a cook, **when** they set the minimum to 2,000 XAF, **then** the value is persisted
- **Given** a cart total of 1,500 XAF and minimum of 2,000 XAF, **when** viewing the cart, **then** the checkout button is disabled with "Add 500 XAF more"
- **Given** a cart total reaching 2,000 XAF, **when** the client adds items, **then** the checkout button enables via Gale
- **Given** a value above 100,000, **when** submitted, **then** validation rejects with a range error
- **Given** the landing page, **when** a client visits, **then** the minimum order amount is displayed
- **Given** a minimum of 0, **when** a client has any amount in cart, **then** checkout is always enabled

---

## Verification Steps
1. Create a new tenant -- confirm default minimum is 0 XAF
2. Set minimum to 3,000 XAF -- confirm success toast and persisted value
3. Add items totaling 2,000 XAF to cart -- confirm checkout is disabled with correct message
4. Add more items to exceed 3,000 XAF -- confirm checkout enables reactively
5. Attempt to set minimum to 150,000 -- confirm validation error
6. Attempt to set a negative value -- confirm validation error
7. Set minimum to 0 -- confirm checkout works with any cart total
8. Visit the tenant landing page -- confirm minimum is displayed
9. Apply a promo code that brings the total below minimum -- confirm checkout is re-disabled
10. Check activity log for setting change entries

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Minimum set while client has items in cart | Cart view reactively re-evaluates on next view/interaction |
| Minimum exceeds any available meal price | Client sees the minimum; must order multiple items |
| Promo discount brings total below minimum | Checkout is blocked; client must add more items or remove the promo |
| Delivery fee excluded from minimum check | Only food subtotal (after promo) counts toward the minimum |
| Non-numeric input | Validation rejects: "Minimum order amount must be a number" |
| Decimal input (e.g., 1500.50) | Validation rejects: "Amount must be a whole number in XAF" |
| Landing page when minimum is 0 | Minimum order section is not displayed (hidden when 0) |

---

## UI/UX Notes
- Located in Cook Dashboard > Settings section, near the cancellation window setting
- Input field: number input with "XAF" unit label
- Label: "Minimum Order Amount"
- Helper text: "Set the minimum amount clients must order. Set to 0 for no minimum."
- Cart message format: "Add X XAF more to meet the minimum order of Y XAF" (where X = remaining, Y = minimum)
- Checkout button: visually disabled (greyed out) with the message below it
- Landing page display: "Minimum order: 2,000 XAF" in an info badge
- When minimum is 0: no mention of minimum anywhere (clean UX)
- XAF amounts formatted with thousand separators (e.g., 2,000 XAF)
- Mobile: full-width input in settings; clear cart message on mobile cart view

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Dashboard where settings live |
| F-126 | Tenant Landing Page Layout | Displays the minimum order amount |
| F-139 | Order Cart Management | Cart enforces the minimum before checkout |
| F-146 | Order Total Calculation & Summary | Total used for minimum validation |
| F-148 | Order Creation | Validates minimum at order placement |
| F-218 | Promo Code Application at Checkout | Post-discount total must still meet minimum |
