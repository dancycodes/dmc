# F-196 â€” Favorite Cook Toggle

> Module: Favorites
> Priority: Should-have
> Precedence: F-024, F-066
> Type: functional

---

## What It Does
Adds a heart/star toggle button on cook cards (on the discovery page and tenant landing pages) that allows authenticated users to add or remove a cook from their favorites. Clicking the icon toggles the favorite state instantly via Gale. The visual state updates immediately (filled icon = favorited, outline icon = not favorited). If the user is not authenticated, clicking the button prompts them to log in. The favorite relationship is stored per user per cook.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (authenticated) | Toggles a cook as a favorite from cook cards |
| Client (guest) | Clicks the button and is prompted to log in |

---

## User Scenarios
### Scenario 1: Add a cook to favorites
An authenticated client browses the discovery page. They see a cook card for "Chef Latifa" and click the heart icon. The icon fills in (turns solid red/primary color) with a brief animation. Chef Latifa is now in their favorites.

### Scenario 2: Remove a cook from favorites
The client visits the discovery page and sees Chef Latifa's card with a filled heart (already favorited). They click the heart icon. It transitions to an outline (unfilled). Chef Latifa is removed from their favorites.

### Scenario 3: Guest user clicks favorite
A guest user (not logged in) clicks the heart icon on a cook card. A login prompt appears (modal or redirect to login page). After logging in, they are returned to the discovery page. They can then favorite the cook.

### Scenario 4: Favorite from tenant landing page
The client visits `latifa.dm.test` (tenant landing page). A heart icon appears in the cook's header/profile section. The client clicks it to favorite Chef Latifa.

### Scenario 5: Favorite state persists across sessions
The client favorites Chef Latifa, closes their browser, and returns later. The heart icon on Chef Latifa's card is still filled, reflecting the persisted favorite.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-323 | Favoriting requires authentication; guests are prompted to log in |
| BR-324 | A user can favorite any active cook |
| BR-325 | The toggle is idempotent: clicking when favorited removes, clicking when not favorited adds |
| BR-326 | Favorite state is stored as a user-cook relationship (pivot table) |
| BR-327 | The heart icon visually reflects the current favorite state on page load |
| BR-328 | Toggle happens via Gale without page reload |
| BR-329 | Visual feedback is immediate with a brief animation (scale or color transition) |
| BR-330 | A user can favorite unlimited cooks |
| BR-331 | Favoriting a deactivated cook is not possible (their card is not shown) |
| BR-332 | All user-facing text must use `__()` localization |

---

## Data Involved
**Creates:**
- Record in `favorite_cooks` pivot table: `user_id`, `cook_user_id`, `created_at`

**Reads:**
- `favorite_cooks` table to determine current state on page load
- `users` table for cook identity

**Updates:**
- Toggle: insert or delete from `favorite_cooks` pivot table

**Relationships:**
- User belongsToMany User (cooks) via `favorite_cooks` pivot

---

## Acceptance Criteria
- **Given** an authenticated user, **when** they click the heart on an unfavorited cook, **then** the cook is added to favorites and the icon fills
- **Given** an authenticated user, **when** they click the heart on a favorited cook, **then** the cook is removed and the icon becomes outlined
- **Given** a guest user, **when** they click the heart, **then** a login prompt appears
- **Given** a favorited cook, **when** the page reloads, **then** the heart icon is filled
- **Given** the toggle, **when** clicked, **then** the state changes without page reload

---

## Verification Steps
1. Log in and click the heart on an unfavorited cook; verify it fills and the record is created
2. Click the filled heart; verify it becomes outlined and the record is deleted
3. As a guest, click the heart; verify login prompt appears
4. Favorite a cook, refresh the page; verify the heart is still filled
5. Favorite a cook on the discovery page, then visit the tenant landing; verify the heart state is consistent
6. Verify the toggle works via Gale without page reload

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Double-clicking rapidly | Debounced; only one toggle processed |
| Network failure during toggle | Revert visual state; show error toast |
| Cook's account is deactivated after being favorited | Cook removed from favorites list view; favorite record can remain |
| User favorites themselves (if user is also a cook) | Allowed; no restriction |
| Hundreds of favorites | No performance issue; pagination handled in favorites list (F-198) |

---

## UI/UX Notes
- Heart icon positioned in the top-right corner of cook cards
- Icon: outlined heart (unfavorited) / filled heart (favorited)
- Color: muted gray (outline) / red or primary color (filled)
- Brief scale animation on toggle (pulse/bounce)
- Tooltip: "Add to favorites" / "Remove from favorites"
- On tenant landing page: heart icon near the cook name/bio area
- Accessible: button has aria-label describing the action
- Touch-friendly: adequate tap target size (min 44x44px)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-024 | User Authentication | Required for favoriting |
| F-066 | Discovery Page Layout | Cook cards where heart icons appear |
| F-198 | Favorites List View | Displays all favorited cooks |
| F-126 | Tenant Landing Page | Heart icon also appears here |
