# F-204 — Client Spending & Order Stats

> Module: Analytics
> Priority: Should-have
> Precedence: F-024, F-151
> Type: functional

---

## What It Does
Provides a personal stats page for clients showing their spending and ordering patterns. Displays total amount spent (all time and this month), order count, most-ordered-from cooks (favorite cooks by frequency), and most-ordered meals (favorite meals by frequency). This is a simple, informative page rather than a full analytics dashboard. Accessible from the client's profile or settings area.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Views their personal spending and order statistics |

---

## User Scenarios
### Scenario 1: View spending overview
The client navigates to "My Stats" from their profile menu. Summary cards show: "Total Spent: 125,000 XAF," "This Month: 18,500 XAF," "Total Orders: 32."

### Scenario 2: Favorite cooks by order frequency
A section shows "Your Most Ordered From" with cook cards: "Chef Latifa (12 orders)," "Chef Amara (8 orders)," "Chef Bruno (5 orders)." Each links to the cook's tenant page.

### Scenario 3: Favorite meals by order frequency
A section shows "Your Most Ordered Meals" with meal cards: "Ndole (15 times)," "Jollof Rice (10 times)," "Eru (7 times)." Each links to the meal detail page.

### Scenario 4: New user with no orders
A new client visits their stats page. It shows: "No orders yet. Discover cooks and place your first order!" with a link to the discovery page.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-408 | Stats are personal to the authenticated client |
| BR-409 | Total spent includes only completed/delivered orders (not cancelled/refunded) |
| BR-410 | "This month" is calculated from the 1st of the current month |
| BR-411 | Most-ordered cooks ranked by order count (top 5) |
| BR-412 | Most-ordered meals ranked by times ordered (top 5) |
| BR-413 | Amounts in XAF format |
| BR-414 | Cook cards link to the cook's tenant landing page |
| BR-415 | Meal cards link to the meal detail on the cook's tenant domain |
| BR-416 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table filtered by `user_id` (client) and completed statuses
- `order_items` table for meal frequency
- `meals` table for meal names and images
- `users` table for cook names and images
- `tenants` table for cook domain links

**Creates:**
- Nothing

**Updates:**
- Nothing

---

## Acceptance Criteria
- **Given** a client with orders, **when** viewing stats, **then** correct spending totals are shown
- **Given** orders from multiple cooks, **when** viewed, **then** most-ordered cooks are ranked correctly
- **Given** multiple meals ordered, **when** viewed, **then** most-ordered meals are ranked correctly
- **Given** no orders, **when** viewed, **then** empty state with discovery link is shown

---

## Verification Steps
1. Verify total spent matches sum of completed orders
2. Verify "This Month" shows only current month's orders
3. Verify most-ordered cooks ranking is accurate
4. Verify most-ordered meals ranking is accurate
5. Click a cook card; verify navigation to tenant landing
6. Click a meal card; verify navigation to meal detail
7. Test with a user with no orders; verify empty state

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client has orders but all are refunded | Total spent shows 0 XAF |
| Meal has been deleted since ordering | Shown as "Meal no longer available" |
| Cook's tenant deactivated | Cook card shown with "Unavailable" badge |
| Only one order ever | Stats show correctly with one data point per section |

---

## UI/UX Notes
- Accessible from profile menu under "My Stats" or "My Activity"
- Clean, simple layout — not a full dashboard
- Summary cards at top in a 3-column grid (Total Spent, This Month, Total Orders)
- "Most Ordered From" section with small cook cards in a row
- "Most Ordered Meals" section with small meal cards in a row
- Empty state centered with illustration and CTA
- Responsive: stacks on mobile
- All interactions via Gale

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-024 | User Authentication | Required for personal stats |
| F-151 | Payment Webhook Handling | Creates the order data for stats |
| F-198 | Favorites List View | Complementary feature for client preferences |
