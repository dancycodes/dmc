# F-136 â€” Meal Filters

> Module: Meal Search
> Priority: Must-have
> Precedence: F-128
> Type: functional

---

## What It Does
Adds filter controls to the tenant meals page allowing clients to filter the meals grid by tags (multi-select), availability status (available now vs. all), and price range (slider or min/max inputs). Filters are applied via Gale without page reloads and are combinable with each other and with search (F-135). Active filter count is displayed as a badge. A "Clear filters" option resets all filters.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Filters meals by tags, availability, or price to find what they want |

---

## User Scenarios
### Scenario 1: Filtering by tag
A visitor selects the "Traditional" tag from the filter panel. The meals grid updates to show only meals tagged "Traditional." The filter badge shows "1" to indicate one active filter.

### Scenario 2: Filtering by multiple tags
A visitor selects both "Traditional" and "Spicy" tags. Meals that have either tag are displayed (OR logic within tag filter). The filter badge shows "2."

### Scenario 3: Filtering by availability
A visitor selects "Available now" from the availability filter. Only meals that can be ordered right now (within the current schedule window) are shown.

### Scenario 4: Filtering by price range
A visitor sets the price range to 500 - 2,000 XAF. Only meals with a starting price within this range are displayed.

### Scenario 5: Combined filters
A visitor selects "Traditional" tag AND "Available now" AND price range 500-2,000 XAF. The grid shows only meals matching all three criteria.

### Scenario 6: Clearing all filters
The visitor clicks "Clear filters." All filter selections are reset and the full meals grid is restored.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-223 | Tag filter is multi-select; meals matching ANY selected tag are shown (OR logic) |
| BR-224 | Availability filter options: "All" (default) and "Available Now" |
| BR-225 | "Available Now" means the meal can be ordered within the current active schedule window |
| BR-226 | Price range filter uses the meal's starting price (minimum component price) |
| BR-227 | Price range minimum is 0 XAF, maximum is determined by the highest meal starting price for this cook |
| BR-228 | All filters are combinable: tag AND availability AND price range (AND logic between filter types) |
| BR-229 | A filter count badge shows the number of active filters |
| BR-230 | "Clear filters" resets all filter selections |
| BR-231 | Filters are applied via Gale without page reload |
| BR-232 | Filters are combinable with search (F-135) |
| BR-233 | All filter labels must be localized via `__()` |

---

## Data Involved
**Reads:**
- Available tags for the cook's meals (to populate tag multi-select)
- Meal starting prices (to determine price range bounds)
- Schedule data (to determine "Available Now" status)
- Current filter selections from user input

**Creates:**
- Filter panel Blade component
- Tag multi-select component
- Price range slider component
- Filter badge component

**Updates:**
- Filters the meals grid display (F-128) based on selected filters

**Relationships:**
- Operates on the meals displayed by F-128 (Available Meals Grid Display)
- Combinable with F-135 (Meal Search Bar) and F-137 (Meal Sort Options)

---

## Acceptance Criteria
- **Given** the user selects one tag, **when** the filter applies, **then** only meals with that tag are shown
- **Given** the user selects multiple tags, **when** the filter applies, **then** meals matching any selected tag are shown
- **Given** the user selects "Available Now", **when** the filter applies, **then** only currently orderable meals are shown
- **Given** the user sets a price range, **when** the filter applies, **then** only meals within the range are shown
- **Given** multiple filters active, **when** viewing results, **then** the filter badge shows the correct count
- **Given** the user clicks "Clear filters", **when** filters reset, **then** the full grid is restored

---

## Verification Steps
1. Select a tag and verify the grid filters correctly
2. Select multiple tags and verify OR logic
3. Select "Available Now" and verify only currently available meals show
4. Set a price range and verify correct filtering
5. Combine all three filter types and verify results
6. Verify the filter count badge updates correctly
7. Click "Clear filters" and verify the full grid returns
8. Apply filters with an active search query and verify both work together

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook has no tags on any meal | Tag filter section hidden |
| All meals have the same price | Price range filter hidden or disabled |
| No meals match all combined filters | Empty state message shown |
| Filters applied with zero results then search | Search results also respect active filters |
| Only 1 meal exists | Filters still available but may be less useful |

---

## UI/UX Notes
- Filter panel: sidebar on desktop, bottom sheet on mobile (triggered by a floating "Filter" button)
- Tag filter as pill/chip multi-select
- Availability as radio buttons or toggle switch
- Price range as a dual-handle slider with min/max text inputs
- Active filter count displayed as a badge on the filter button (mobile) and in the filter header (desktop)
- "Clear filters" as a text link button below the filters
- Smooth grid transitions as filters are applied

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-128 | Available Meals Grid Display | Grid that is filtered |
| F-135 | Meal Search Bar | Combinable with filters |
| F-137 | Meal Sort Options | Combinable with filters |
