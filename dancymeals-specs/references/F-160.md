# F-160 — Client Order List

> Module: Order Tracking
> Priority: Must-have
> Precedence: F-024, F-151
> Type: functional

---

## What It Does
Displays the authenticated client's order history across all tenants (cooks). Shows a paginated list of all orders the client has placed, with order ID, cook name, items summary, total amount, current status, and order date. Active orders (not yet Completed, Cancelled, or Refunded) are pinned to the top. Clients can filter by status and sort by date. Each order links to the client order detail view (F-161). This page is accessible from any domain (main or tenant) because orders span across tenants.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Views their order history from any domain |

---

## User Scenarios
### Scenario 1: View all orders
The client navigates to "My Orders" from the navigation menu. A paginated list shows all their orders across all cooks, sorted by date with newest first. Active orders appear at the top, separated from past orders.

### Scenario 2: Active orders highlighted
The client has 2 orders in progress (one "Preparing," one "Out for Delivery") and 10 completed orders. The 2 active orders appear in a pinned section at the top with a distinct background. Completed orders appear below in the main list.

### Scenario 3: Filter by status
The client selects "Completed" from the status filter. Only completed orders are shown. Active order pinning is disabled when a filter is active.

### Scenario 4: Click to view detail
The client clicks on an order row. They are navigated to the client order detail page (F-161) for that order.

### Scenario 5: Cross-tenant orders
The client has ordered from 3 different cooks. All orders appear in a single unified list. The cook name column identifies which cook each order belongs to.

### Scenario 6: No orders yet
A new client with no order history sees an empty state: "You haven't placed any orders yet. Browse cooks to get started!" with a link to the discovery page.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-212 | The order list shows all orders for the authenticated client across all tenants |
| BR-213 | Active orders (statuses: Pending Payment, Paid, Confirmed, Preparing, Ready, Out for Delivery, Ready for Pickup, Delivered, Picked Up) are pinned to the top |
| BR-214 | Past orders (Completed, Cancelled, Refunded) appear below active orders |
| BR-215 | Default sort is by date descending (newest first) within each section |
| BR-216 | Orders are paginated with 15 orders per page (configurable) |
| BR-217 | Cook name links to the cook's tenant landing page |
| BR-218 | Status badges use the same color scheme as the cook order list (F-155) |
| BR-219 | The page is accessible from any domain (main or tenant) |
| BR-220 | Authentication is required; unauthenticated users are redirected to login |
| BR-221 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table filtered by `client_id` (authenticated user)
- `tenants` table for cook/tenant names
- `order_items` table for items summary
- `users` table for cook name

**Creates:**
- Nothing

**Updates:**
- Nothing

**Relationships:**
- Order belongsTo User (client)
- Order belongsTo Tenant
- Tenant belongsTo User (cook)

---

## Acceptance Criteria
- **Given** an authenticated client, **when** they visit "My Orders," **then** a paginated list of all their orders is displayed
- **Given** active orders exist, **when** the list loads, **then** active orders appear pinned at the top
- **Given** orders across multiple cooks, **when** viewing the list, **then** the cook name is shown for each order
- **Given** a status filter is applied, **when** viewing the list, **then** only orders matching the filter are shown
- **Given** a client clicks an order, **when** navigating, **then** they reach the order detail page (F-161)
- **Given** an unauthenticated user, **when** they access the orders page, **then** they are redirected to login

---

## Verification Steps
1. Log in as a client and navigate to "My Orders" — verify the list loads
2. Verify active orders appear pinned at the top
3. Verify orders from different cooks all appear in the list
4. Apply the status filter and verify filtering works
5. Click an order and verify navigation to the detail page
6. Test with no orders and verify the empty state
7. Test without authentication and verify redirect to login
8. Verify pagination with more than 15 orders

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client has orders but all are completed | No active section shown; all orders in the main list |
| Order's cook/tenant has been deactivated | Order still appears; cook name shown but may be marked as "inactive" |
| Client accesses on a tenant domain | Page still shows ALL their orders (not just that tenant's) |
| Very old orders (months ago) | Still accessible via pagination |
| Order status updates while client is viewing the list | Status badge updates in real-time via Gale SSE |

---

## UI/UX Notes
- Accessible from main navigation under "My Orders" (with order count badge for active orders)
- Active orders section has a distinct background color or border
- Table layout on desktop; card layout on mobile
- Each card/row shows: order ID, cook name, items summary (truncated), total XAF, status badge, date
- Status filter as a segmented control or dropdown above the list
- Cook name is a clickable link to their tenant landing page
- Empty state includes illustration and CTA to discovery page
- Real-time status updates via Gale SSE
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-024 | User Login | Authentication required to access this page |
| F-151 | Payment Webhook Handling | Creates paid orders that appear here |
| F-161 | Client Order Detail & Status Tracking | Clicking an order navigates here |
| F-066 | Discovery Page Layout | Empty state links to discovery |
| F-199 | Reorder from Past Order | Reorder action available from this list |
