# F-044 — Super-Admin Creation Artisan Command

> Module: Admin
> Priority: Must-have
> Precedence: F-006
> Type: functional

---

## What It Does
Provides the `php artisan dancymeals:create-super-admin` Artisan command that creates the first super-admin user for the platform. The command prompts for name, email, phone number, and password. It assigns the `super-admin` role with all permissions. By default, the command only works when no super-admin exists. The `--force` flag allows creating additional super-admins. The creation event is logged via Spatie Activitylog.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Developer | Runs the command during initial deployment or local setup |
| DevOps | Runs the command in production to create the first admin |

---

## User Scenarios
### Scenario 1: First super-admin creation
The developer runs `php artisan dancymeals:create-super-admin` on a fresh installation. The command prompts for name, email, phone, and password (with confirmation). It creates the user, assigns the `super-admin` role, and displays a success message with the user's email.

### Scenario 2: Attempt to create duplicate super-admin
A super-admin already exists. The developer runs the command without `--force`. The command displays "A super-admin already exists. Use --force to create another." and exits without creating a user.

### Scenario 3: Force creation of additional super-admin
The developer runs `php artisan dancymeals:create-super-admin --force`. Despite an existing super-admin, the command proceeds with prompts and creates the additional super-admin.

### Scenario 4: Email already in use
The developer enters an email that already belongs to an existing user. The command displays "A user with this email already exists." and re-prompts for email.

### Scenario 5: Weak password
The developer enters a password shorter than 8 characters. The command displays a validation error and re-prompts for password.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-049 | Only one super-admin can be created by default; `--force` flag bypasses this |
| BR-050 | Super-admin receives the `super-admin` role which inherits ALL permissions |
| BR-051 | Email must be unique across all users |
| BR-052 | Phone number must be a valid Cameroon mobile number format (+237 followed by 9 digits) |
| BR-053 | Password must be at least 8 characters |
| BR-054 | Super-admin creation must be logged in the activity log with causer "system" |
| BR-055 | The created user's `is_active` field is set to `true` |

---

## Data Involved
**Creates:**
- User record with name, email, phone, hashed password, `is_active = true`
- Role assignment: `super-admin` role for the created user
- Activity log entry recording the creation

**Reads:**
- Existing users to check for email uniqueness
- Existing super-admin count to enforce single-creation default

**Updates:**
- Nothing

**Relationships:**
- F-006: The `super-admin` role and permissions must exist before this command runs

---

## Acceptance Criteria
- **Given** no super-admin exists, **when** running the command with valid inputs, **then** a super-admin user is created with the `super-admin` role
- **Given** a super-admin exists, **when** running the command without `--force`, **then** the command exits with a warning message
- **Given** a super-admin exists, **when** running with `--force` and valid inputs, **then** an additional super-admin is created
- **Given** a duplicate email, **when** entered during the prompt, **then** the command shows an error and re-prompts
- **Given** a successful creation, **when** checking the activity log, **then** an entry exists for the super-admin creation

---

## Verification Steps
1. Run command on fresh database — confirm user created with `super-admin` role
2. Run command again without `--force` — confirm it is blocked
3. Run with `--force` — confirm second super-admin created
4. Enter duplicate email — confirm validation error and re-prompt
5. Enter password under 8 characters — confirm validation error and re-prompt
6. Check activity log — confirm creation is logged with causer "system"
7. Log in as the created super-admin via web — confirm full admin panel access

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Command run in production without `--force` and super-admin exists | Blocked with clear message |
| Database connection failure during command | Laravel shows PDO connection error |
| `super-admin` role not yet seeded | Command fails with descriptive error: "super-admin role not found. Run seeders first." |
| User enters empty name or email | Validation error, re-prompts for the field |
| Ctrl+C during prompts | Command exits cleanly without partial data |

---

## UI/UX Notes
- This is a CLI-only feature — no web interface.
- Command output uses Laravel Prompts for styled terminal prompts (text inputs, password inputs).
- Success output: green-colored confirmation with the created email address.
- Error output: red-colored messages with clear instructions.
- The `--force` flag is documented in the command's `--help` output.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-006 | Spatie Permission Setup | Must be run first to create the super-admin role |
| F-043 | Admin Panel Layout | Super-admin uses this to access the admin panel |
| F-005 | User Model & Migration | Provides the User model this command creates |
