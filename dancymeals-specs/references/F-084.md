# F-084 â€” Edit Town

> Module: Location
> Priority: Must-have
> Precedence: F-083
> Type: functional

---

## What It Does

Allows the cook to edit an existing town's name in both English and French. The edit form pre-populates with the current values. Validates uniqueness against other towns for this cook. Saves via Gale without page reload. Changes reflect across all existing data that references this town (orders, quarters, etc.) since they reference the town by ID.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Edits a town name to correct spelling or update translations |
| Manager | Edits towns if granted location management permission |

---

## User Scenarios

### Scenario 1: Edit town name
A cook clicks "Edit" on "Douala." An inline edit form or modal appears with the current English and French names pre-filled. The cook corrects a typo in the French name and saves. The town list updates immediately.

### Scenario 2: Duplicate name attempt
A cook tries to rename "Bafoussam" to "Douala" (which already exists). A validation error appears: "A town with this name already exists."

### Scenario 3: Cancel edit
A cook opens the edit form, makes changes, then clicks "Cancel." The original values are restored and no changes are saved.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-219 | Town name required in both English and French |
| BR-220 | Edited town name must remain unique within this cook's towns (excluding the current town) |
| BR-221 | Save via Gale; list updates without page reload |
| BR-222 | Changes to town name do not affect existing order records (orders reference town by ID) |
| BR-223 | Edit action requires location management permission |
| BR-224 | All validation messages must use `__()` localization |

---

## Data Involved

**Reads:**
- Current town data (for pre-population)
- Other town names for this tenant (uniqueness check)

**Updates:**
- Town record: name_en, name_fr, updated_at

---

## Acceptance Criteria

- **Given** the edit form, **when** the cook updates the town name and saves, **then** the changes are persisted and the list updates
- **Given** a duplicate name, **when** saving, **then** a uniqueness validation error is shown
- **Given** the cook clears one language name, **when** saving, **then** a validation error requires both languages
- **Given** the cook clicks "Cancel", **when** the form closes, **then** no changes are saved
- **Given** a successful edit, **when** viewing the town list, **then** the updated name is displayed

---

## Verification Steps

1. Edit a town name and confirm the update is saved and reflected in the list
2. Attempt to rename to a duplicate and confirm validation error
3. Clear one language and confirm validation error
4. Cancel an edit and confirm original data is unchanged
5. Verify related quarters still reference the same town

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Editing a town with active orders | Allowed; orders reference by ID, not name |
| Concurrent edit by two managers | Last save wins |
| Network error during save | Error toast; form data preserved for retry |
| Town name with only whitespace | Rejected as empty |

---

## UI/UX Notes

- Inline edit form that replaces the town row, or a modal dialog
- Pre-populated fields for English and French names
- "Save" and "Cancel" buttons
- Loading state on Save button during submission
- Success: row updates with new name; toast notification
- Error: inline validation messages

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-083 | Town List View | Edit initiated from the town list |
| F-082 | Add Town | Same form structure |
| F-085 | Delete Town | Alternative action on the town |
