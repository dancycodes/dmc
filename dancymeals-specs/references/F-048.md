# F-048 — Tenant Edit & Status Toggle

> Module: Admin
> Priority: Must-have
> Precedence: F-047
> Type: functional

---

## What It Does
Allows admins to edit a tenant's details (name, description, domains) and toggle the tenant's active/inactive status. Deactivating a tenant causes their website to show a "temporarily unavailable" page to all visitors. Reactivating restores normal access. Domain changes are validated to prevent conflicts. All changes are logged in the activity log.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Edits tenant details and toggles status |
| Admin | Edits tenant details and toggles status |

---

## User Scenarios
### Scenario 1: Editing tenant name
An admin navigates to the edit form for "Chef Amara's Kitchen" and updates the French name from "La Cuisine de Chef Amara" to "Les Saveurs d'Amara". They submit and the tenant detail page shows the updated name with a success toast.

### Scenario 2: Deactivating a tenant
An admin toggles the tenant status from Active to Inactive. A confirmation dialog appears: "Deactivating this tenant will show a 'temporarily unavailable' page on their website. Continue?" The admin confirms. The tenant is deactivated and visitors to the subdomain see the unavailable page.

### Scenario 3: Reactivating a tenant
An admin toggles an inactive tenant back to Active. The tenant's website immediately becomes accessible again. No confirmation dialog is needed for activation.

### Scenario 4: Changing subdomain
An admin updates the subdomain from "chef-amara" to "amara-kitchen". The system validates the new subdomain is available and updates the record. The old subdomain no longer resolves to this tenant.

### Scenario 5: Domain conflict on edit
An admin tries to change the custom domain to one already used by another tenant. Validation prevents the save and displays "This domain is already assigned to another tenant."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-075 | Deactivated tenant's website shows a platform-branded "temporarily unavailable" page |
| BR-076 | Deactivation does not delete any data — it only blocks public access |
| BR-077 | The cook assigned to a deactivated tenant retains their cook role but cannot manage orders |
| BR-078 | Subdomain changes must follow the same validation rules as creation (BR-057) |
| BR-079 | Subdomain and domain uniqueness checks must exclude the current tenant's own values |
| BR-080 | All edits and status changes are recorded in the activity log with the admin as causer |
| BR-081 | Deactivation requires explicit confirmation; activation does not |

---

## Data Involved
**Reads:**
- Current tenant record
- Other tenants' subdomains and domains for uniqueness validation

**Creates:**
- Activity log entries for each change

**Updates:**
- Tenant: name_en, name_fr, description_en, description_fr, subdomain, custom_domain, status

**Relationships:**
- F-047: Returns to detail view after save
- F-016: Domain middleware uses status to serve unavailable page

---

## Acceptance Criteria
- **Given** a tenant, **when** editing the name and saving, **then** the updated name is displayed on the detail page
- **Given** a tenant, **when** toggling status to inactive with confirmation, **then** the tenant's website shows "temporarily unavailable"
- **Given** a deactivated tenant, **when** toggling back to active, **then** the website is restored immediately
- **Given** a subdomain change to a taken value, **when** saving, **then** a validation error is displayed
- **Given** any edit, **when** saved successfully, **then** an activity log entry records the change

---

## Verification Steps
1. Edit tenant name — confirm change persists and appears on detail page
2. Deactivate tenant — visit tenant's subdomain and confirm "temporarily unavailable" page
3. Reactivate tenant — visit subdomain and confirm website loads normally
4. Change subdomain to a duplicate — confirm validation error
5. Check activity log — confirm edit and status change entries exist with admin as causer

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Admin edits but makes no changes and submits | No activity log entry created; success toast still shown |
| Subdomain changed while cook is actively managing orders | Existing orders retain their data; cook's dashboard URL updates |
| Custom domain removed (set to empty) | Tenant is only accessible via subdomain |
| Two admins editing same tenant simultaneously | Last save wins; no conflict resolution needed for MVP |
| Deactivating tenant with active orders in progress | Orders remain in their current status; cook and clients can still view order history |

---

## UI/UX Notes
- Edit form pre-filled with current tenant values
- Status toggle is a prominent switch at the top of the form, separate from the text fields
- Deactivation confirmation uses a modal dialog with warning styling
- Save button with loading state during submission
- Cancel button returns to detail page without changes
- Form uses Gale for submission (no full page reload)
- Breadcrumb: Admin > Tenants > Chef Amara's Kitchen > Edit

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-047 | Tenant Detail View | Navigated from and returns to after save |
| F-045 | Tenant Creation Form | Shares validation rules |
| F-016 | Multi-Domain Middleware | Uses tenant status to determine access |
