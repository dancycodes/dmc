# F-002 â€” Database Configuration

> Module: Foundation
> Priority: Must-have
> Precedence: F-001
> Type: foundation

---

## What It Does
Establishes the PostgreSQL database connection for DancyMeals. Creates the database, verifies connectivity from the Laravel application, runs the initial migration to confirm the schema pipeline works, and ensures `config/database.php` is properly configured for PostgreSQL as the default connection.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Developer | Creates database, configures credentials, runs initial migration |

---

## User Scenarios
### Scenario 1: Successful database setup
The developer creates a PostgreSQL database named `dancymeals`, sets credentials in `.env`, and runs `php artisan migrate`. The default Laravel migrations execute successfully and tables appear in the database.

### Scenario 2: Test database setup
The developer creates a separate `dancymeals_test` database for the test suite, ensuring tests run against an isolated database without affecting development data.

### Scenario 3: Connection failure
The developer enters incorrect database credentials. When running `php artisan migrate`, a clear PDO connection error is shown with the host, port, and database name that failed.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-007 | PostgreSQL is the only supported database engine for DancyMeals |
| BR-008 | The default database connection in `config/database.php` must be `pgsql` |
| BR-009 | Database name should be `dancymeals` for development |
| BR-010 | A separate test database (`dancymeals_test`) must be configured for testing |
| BR-011 | Database credentials must never be hardcoded; always use `.env` variables |
| BR-012 | All database access must go through Eloquent ORM or Laravel query builder |

---

## Data Involved
**Creates:**
- PostgreSQL database `dancymeals`
- PostgreSQL database `dancymeals_test`
- Default Laravel migration tables (users, password_reset_tokens, sessions, cache, jobs)

**Reads:**
- `.env` database connection variables

**Updates:**
- `config/database.php` default connection setting
- `.env` with `DB_CONNECTION`, `DB_HOST`, `DB_PORT`, `DB_DATABASE`, `DB_USERNAME`, `DB_PASSWORD`

**Relationships:**
- All subsequent features depend on this database connection

---

## Acceptance Criteria
- **Given** PostgreSQL is installed and running, **when** the developer configures `.env` with valid credentials, **then** `php artisan migrate` executes without errors
- **Given** a configured database, **when** running `php artisan db:show`, **then** it displays PostgreSQL as the driver with the correct database name
- **Given** the test environment, **when** `.env.testing` or `phpunit.xml` references `dancymeals_test`, **then** tests run against the test database
- **Given** incorrect credentials, **when** running any database command, **then** a meaningful connection error is displayed

---

## Verification Steps
1. Run `php artisan db:show` and confirm PostgreSQL connection with database name `dancymeals`
2. Run `php artisan migrate:status` and confirm all default migrations have run
3. Run `php artisan tinker` and execute `DB::connection()->getPDO()` to confirm a live connection
4. Verify `.env` contains all six `DB_*` variables with correct values
5. Confirm `config/database.php` has `'default' => env('DB_CONNECTION', 'pgsql')`

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| PostgreSQL service not running | Clear connection refused error with host/port details |
| Database does not exist | PDO error indicating the database is not found; developer creates it |
| Insufficient database privileges | Permission denied error; developer grants necessary privileges |
| Port conflict (non-default PostgreSQL port) | Developer updates `DB_PORT` in `.env` |

---

## UI/UX Notes
No user-facing UI. This is a developer-only infrastructure feature.

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-001 | Laravel Project Scaffolding | Prerequisite; provides the .env and project base |
| F-003 | Core Package Installation | Depends on this; packages may run their own migrations |
| F-020 | Testing Infrastructure | Uses the test database configured here |
