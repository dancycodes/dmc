# F-045 — Tenant Creation Form

> Module: Admin
> Priority: Must-have
> Precedence: F-043
> Type: functional

---

## What It Does
Provides a form within the admin panel for creating new tenants (cook websites). Admins fill in the tenant name (English and French), subdomain, optional custom domain, description (English and French), and initial status. The system validates subdomain uniqueness and domain format, then creates the tenant record. In local development, optionally triggers `herd link` to register the subdomain with Laravel Herd.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Creates new tenants for onboarding cooks |
| Admin | Creates new tenants for onboarding cooks |

---

## User Scenarios
### Scenario 1: Standard tenant creation
An admin navigates to Tenants > Create New Tenant. They fill in: name_en "Chef Amara's Kitchen", name_fr "La Cuisine de Chef Amara", subdomain "chef-amara", description in both languages, and status "active". The system validates the subdomain is available, creates the tenant, and redirects to the tenant detail page with a success toast.

### Scenario 2: Tenant with custom domain
The admin creates a tenant and also specifies a custom domain "chefamara.cm". The system validates the domain format (valid hostname, not a reserved domain), stores it, and displays a note about DNS configuration needed.

### Scenario 3: Duplicate subdomain
The admin enters a subdomain "chef-amara" that already exists. On form submission, a validation error appears next to the subdomain field: "This subdomain is already taken."

### Scenario 4: Invalid subdomain format
The admin enters "Chef Amara!" as the subdomain. Validation rejects it with "Subdomain may only contain lowercase letters, numbers, and hyphens."

### Scenario 5: Local development with Herd
After creating a tenant with subdomain "chef-amara", the system shows an optional action to run `herd link chef-amara.dm` to make the subdomain accessible locally. The admin clicks it and the system confirms the link was created.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-056 | Subdomain must be unique across all tenants |
| BR-057 | Subdomain must contain only lowercase letters, numbers, and hyphens; must start and end with a letter or number; 3-63 characters |
| BR-058 | Custom domain is optional but if provided must be a valid hostname format |
| BR-059 | Custom domain must not conflict with the platform's main domain or any existing tenant's domain |
| BR-060 | Both name_en and name_fr are required; both description_en and description_fr are required |
| BR-061 | Initial status can be "active" or "inactive"; defaults to "active" |
| BR-062 | Tenant creation must be logged in the activity log |
| BR-063 | Reserved subdomains (www, api, admin, mail, ftp, etc.) cannot be used |

---

## Data Involved
**Creates:**
- Tenant record: name_en, name_fr, subdomain, custom_domain, description_en, description_fr, status, slug

**Reads:**
- Existing tenant subdomains and domains for uniqueness validation
- Reserved subdomain list

**Updates:**
- Nothing

**Relationships:**
- Tenant model created here is referenced by F-049 (cook assignment), F-046 (list view), F-047 (detail view)

---

## Acceptance Criteria
- **Given** valid form data with a unique subdomain, **when** submitting the form, **then** a tenant is created and the admin is redirected to the tenant detail page
- **Given** a duplicate subdomain, **when** submitting the form, **then** a validation error is displayed
- **Given** an invalid subdomain format, **when** submitting, **then** a clear validation message explains the format rules
- **Given** a custom domain conflicting with an existing tenant, **when** submitting, **then** a validation error is shown
- **Given** only name_en is provided without name_fr, **when** submitting, **then** validation requires both translations
- **Given** successful creation, **when** checking the activity log, **then** the creation is recorded

---

## Verification Steps
1. Create a tenant with all valid fields — confirm it appears in the tenant list
2. Attempt to create a tenant with a duplicate subdomain — confirm validation error
3. Enter a reserved subdomain ("www") — confirm it is rejected
4. Submit with an invalid subdomain format ("Chef's!") — confirm validation error
5. Leave name_fr empty — confirm both translations are required
6. Check activity log after creation — confirm entry exists

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Subdomain with consecutive hyphens (e.g., "chef--amara") | Rejected by validation |
| Custom domain identical to main platform domain | Rejected with specific error |
| Very long tenant name (>255 chars) | Rejected by validation with max length error |
| Special characters in description (emojis, HTML) | HTML sanitized; emojis allowed in description |
| Form submitted twice rapidly (double-click) | Idempotency: second submission fails with duplicate subdomain error |

---

## UI/UX Notes
- Form layout: single column on mobile, two-column on desktop (en/fr side by side)
- Subdomain field shows a live preview: "chef-amara.dancymeals.com"
- Custom domain field has a help tooltip explaining DNS setup requirements
- Status toggle: pill switch for active/inactive
- Submit button with loading state during form processing
- Validation errors appear inline beneath each field
- Form uses Gale for submission (no full page reload)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-043 | Admin Panel Layout | Parent layout for this form |
| F-046 | Tenant List & Search | Lists the tenants created here |
| F-047 | Tenant Detail View | Redirected to after creation |
| F-049 | Cook Account Assignment | Next step after tenant creation |
