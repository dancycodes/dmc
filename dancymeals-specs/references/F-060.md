# F-060 — Complaint Escalation Queue

> Module: Admin
> Priority: Must-have
> Precedence: F-043
> Type: functional

---

## What It Does
Displays a queue of complaints that have been escalated to the admin level within the admin panel. Complaints are escalated either automatically (when a cook does not respond within 24 hours) or manually (by the client or cook). The queue shows complaint details, involved parties, category, timing, and current status. Priority sorting ensures the oldest unresolved complaints appear first, prompting timely resolution.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Reviews and manages escalated complaints |
| Admin | Reviews and manages escalated complaints |

---

## User Scenarios
### Scenario 1: Viewing the escalation queue
An admin navigates to Complaints in the sidebar. The queue lists escalated complaints with columns: Complaint ID, Order (linked), Client name, Cook name, Category (badge), Submitted date, Escalated date, Status. Default sorting: oldest unresolved first.

### Scenario 2: Identifying auto-escalated complaints
The admin sees a complaint with escalation reason "Auto-escalated (24h no response)". This means the cook did not respond within 24 hours and the system automatically moved it to the admin queue.

### Scenario 3: Filtering by category
The admin selects "Food Quality" from the category filter. Only complaints about food quality are shown. Categories include: Food Quality, Late Delivery, Missing Items, Wrong Order, Rude Behavior, Other.

### Scenario 4: Filtering by status
The admin filters by "Pending Resolution". Only complaints awaiting admin action are shown. Other statuses: Under Review, Resolved, Dismissed.

### Scenario 5: Clicking to resolve
The admin clicks a complaint row to open the resolution view (F-061), where they can review all details and take action.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-158 | Complaints are auto-escalated if the cook does not respond within 24 hours |
| BR-159 | Clients and cooks can manually escalate complaints at any time |
| BR-160 | Default sort: oldest unresolved complaints first (priority queue) |
| BR-161 | Complaint categories: Food Quality, Late Delivery, Missing Items, Wrong Order, Rude Behavior, Other |
| BR-162 | Complaint statuses in admin queue: Pending Resolution, Under Review, Resolved, Dismissed |
| BR-163 | The escalation queue only shows complaints that have reached admin level |
| BR-164 | Resolved and dismissed complaints remain visible but are sorted below unresolved ones |

---

## Data Involved
**Reads:**
- Complaints: id, order_id, client_id, cook_id, category, description, submitted_at, escalated_at, status, escalation_reason
- Orders: order number, associated tenant
- Users: client name, cook name

**Creates:**
- Nothing (read-only queue view)

**Updates:**
- Nothing (resolution handled by F-061)

**Relationships:**
- F-043: Displayed within admin panel
- F-061: Clicking a complaint navigates to resolution view

---

## Acceptance Criteria
- **Given** escalated complaints exist, **when** navigating to the complaints queue, **then** they are displayed sorted by oldest unresolved first
- **Given** an auto-escalated complaint, **when** viewed in the queue, **then** the escalation reason shows "Auto-escalated (24h no response)"
- **Given** the category filter set to "Food Quality", **when** applied, **then** only food quality complaints are shown
- **Given** the status filter set to "Pending Resolution", **when** applied, **then** only pending complaints are shown
- **Given** a complaint row, **when** clicked, **then** the admin navigates to the complaint resolution page

---

## Verification Steps
1. Navigate to complaints queue — confirm escalated complaints are listed
2. Verify sort order — confirm oldest unresolved complaints appear first
3. Check auto-escalated complaint — confirm escalation reason is displayed
4. Filter by category — confirm correct filtering
5. Click a complaint — confirm navigation to resolution page
6. Verify resolved complaints appear below unresolved ones

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No escalated complaints | Empty state: "No escalated complaints. All issues have been resolved." |
| Complaint's associated order was deleted | Complaint still displays with "Order deleted" note |
| Cook or client account deactivated after complaint | Their name still shows with "(Deactivated)" badge |
| Multiple complaints for the same order | Each listed separately; admin can see the pattern |
| Complaint escalated just now (within seconds) | Appears at the bottom of unresolved list (newest) |

---

## UI/UX Notes
- Queue styled as a priority list, not a generic table — urgency is visually communicated
- Unresolved complaints have a subtle left border accent (warning color)
- Category badges color-coded: Food Quality (red), Late Delivery (orange), Missing Items (yellow), etc.
- Time since escalation shown: "3 days ago" with red color for complaints older than 48 hours
- Summary bar above queue: Total Escalated, Pending Resolution, Resolved This Week
- Notification badge on the Complaints sidebar item showing pending count
- Mobile: card layout with complaint summary, tap to view detail
- Refresh button to reload the queue (or auto-refresh via Gale polling)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-043 | Admin Panel Layout | Parent layout |
| F-061 | Admin Complaint Resolution | Resolving complaints from this queue |
