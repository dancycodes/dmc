# F-165 — Transaction Detail View

> Module: Client Financial
> Priority: Must-have
> Precedence: F-164
> Type: functional

---

## What It Does
Displays the full details of a single financial transaction for the client. Shows the amount, transaction type (payment, refund, wallet payment), date and time, order reference with link, payment method (MTN MoMo, Orange Money, wallet), Flutterwave reference (for mobile money payments), and transaction status. For refund transactions, shows the original order and the reason for the refund (cancellation or complaint resolution).

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Views full details of a specific transaction |

---

## User Scenarios
### Scenario 1: View payment transaction detail
The client clicks a payment transaction from the history list. The detail page shows: "Payment for Order #ORD-1234," amount: 5,000 XAF, method: MTN MoMo, Flutterwave reference: FLW-12345678, status: Completed, date: 2026-02-10 14:30.

### Scenario 2: View refund transaction detail
The client clicks a refund transaction. The detail page shows: "Refund for Order #ORD-1234," amount: 5,000 XAF (credit), reason: "Order cancelled by client," original order link, status: Completed, date: 2026-02-11 09:15.

### Scenario 3: View wallet payment detail
The client clicks a wallet payment transaction. The detail page shows: "Wallet payment for Order #ORD-5678," amount: 3,000 XAF (debit), method: Wallet, status: Completed, date: 2026-02-12 12:00.

### Scenario 4: Navigate to related order
The client clicks the order reference link on the transaction detail page and is navigated to the order detail page (F-161).

### Scenario 5: Failed transaction detail
The client views a failed payment. The detail shows: status: Failed, error: "Payment timed out," with a note about the 15-minute retry window (if applicable).

---

## Business Rules
| Code | Rule |
|------|------|
| BR-271 | The client can only view their own transaction details |
| BR-272 | All transaction types display: amount, type, date/time, status |
| BR-273 | Payment transactions additionally show: payment method, Flutterwave reference |
| BR-274 | Refund transactions additionally show: original order reference, refund reason |
| BR-275 | Wallet payment transactions show: wallet as the payment method |
| BR-276 | Order reference is a clickable link to the order detail page (F-161) |
| BR-277 | Failed transactions show the failure reason |
| BR-278 | All amounts are displayed in XAF format |
| BR-279 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `transactions` table for transaction data
- `orders` table for order reference
- Flutterwave payment data for reference numbers
- Refund reason from cancellation or complaint records

**Creates:**
- Nothing

**Updates:**
- Nothing

---

## Acceptance Criteria
- **Given** a client clicks a payment transaction, **when** the detail page loads, **then** amount, method, Flutterwave reference, status, and date are shown
- **Given** a client clicks a refund transaction, **when** the detail page loads, **then** amount, reason, original order link, and status are shown
- **Given** the order reference is displayed, **when** the client clicks it, **then** they navigate to the order detail page
- **Given** a failed transaction, **when** viewing detail, **then** the failure reason is displayed
- **Given** a client tries to view another user's transaction, **when** accessing the URL, **then** they receive a 403 response

---

## Verification Steps
1. View a payment transaction detail — verify all fields
2. View a refund transaction detail — verify refund reason and original order link
3. View a wallet payment transaction detail — verify wallet is shown as method
4. Click the order reference link — verify navigation to order detail
5. View a failed transaction — verify failure reason is displayed
6. Attempt to access another client's transaction — verify 403

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Original order has been soft-deleted | Order link shows "Order details unavailable" |
| Flutterwave reference not available (wallet-only payment) | Flutterwave reference field hidden |
| Transaction is still pending | Status shows "Pending" with appropriate messaging |
| Refund reason is from complaint resolution | Shows "Complaint resolved — refund issued" |

---

## UI/UX Notes
- Back navigation to transaction history at the top
- Transaction type and amount displayed prominently in the header
- Details organized in a card layout with labeled fields
- Order reference as a clickable blue link
- Status badge: Completed (green), Pending (amber), Failed (red)
- Credit amounts in green, debit amounts in standard text
- Mobile-first layout
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-164 | Client Transaction History | Navigates to this detail view |
| F-161 | Client Order Detail & Status Tracking | Order reference links here |
| F-163 | Order Cancellation Refund Processing | Creates refund transactions shown here |
| F-150 | Flutterwave Payment Initiation | Creates payment transactions shown here |
