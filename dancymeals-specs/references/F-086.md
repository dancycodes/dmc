# F-086 — Add Quarter

> Module: Location
> Priority: Must-have
> Precedence: F-082
> Type: functional

---

## What It Does

Allows a cook to add a quarter within a selected town. The cook enters the quarter name in both English and French and sets a delivery fee in XAF (>= 0). Validates uniqueness of the quarter name within the parent town. The quarter can optionally be assigned to a quarter group for shared delivery fee management. Saves via Gale and the quarter appears immediately in the quarter list.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Adds quarters to define delivery coverage within a town |
| Manager | Adds quarters if granted location management permission |

---

## User Scenarios

### Scenario 1: Add a quarter with delivery fee
A cook expands "Douala" in the town list and clicks "Add Quarter." They enter "Bonaberi" (en) / "Bonabéri" (fr) with a delivery fee of 500 XAF. They click "Save." The quarter appears in the Douala quarter list.

### Scenario 2: Add a free delivery quarter
A cook adds quarter "Akwa" with a delivery fee of 0 XAF (free delivery). The quarter is saved and displayed with a "Free delivery" label.

### Scenario 3: Assign to a quarter group
A cook adds quarter "Deido" and selects the existing group "Central Douala" from a dropdown. The quarter's delivery fee is overridden by the group's fee. The individual fee field is disabled when a group is selected.

### Scenario 4: Duplicate quarter name
A cook tries to add "Bonaberi" to Douala when it already exists. A validation error appears: "This quarter already exists in Douala."

### Scenario 5: Quarter in different towns
A cook adds "Centre Ville" to both Douala and Yaounde. This is allowed because uniqueness is per-town, not global.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-232 | Quarter name is required in both English and French |
| BR-233 | Quarter name must be unique within its parent town |
| BR-234 | Delivery fee is required and must be >= 0 XAF |
| BR-235 | Delivery fee is stored as an integer in XAF |
| BR-236 | A fee of 0 means free delivery to that quarter |
| BR-237 | Quarter can optionally be assigned to a quarter group |
| BR-238 | When assigned to a group, the group's delivery fee overrides the individual fee |
| BR-239 | Quarter is scoped to its parent town (town_id foreign key) |
| BR-240 | Save via Gale; quarter appears in list without page reload |
| BR-241 | Only users with location management permission can add quarters |

---

## Data Involved

**Creates:**
- Quarter record: id, town_id, name_en, name_fr, delivery_fee, quarter_group_id (nullable), created_at, updated_at

**Reads:**
- Parent town
- Existing quarters in this town (uniqueness check)
- Available quarter groups (for optional assignment)

**Updates:**
- Quarter list UI (via Gale)

---

## Acceptance Criteria

- **Given** a town, **when** the cook adds a quarter with valid data, **then** the quarter is created and appears in the quarter list
- **Given** a duplicate quarter name within the same town, **when** submitting, **then** a uniqueness error is shown
- **Given** a delivery fee of 0, **when** saved, **then** the quarter shows "Free delivery"
- **Given** a quarter group selected, **when** saved, **then** the quarter uses the group's delivery fee
- **Given** missing French name, **when** submitting, **then** a validation error requires both languages
- **Given** a negative delivery fee, **when** submitting, **then** a validation error requires fee >= 0

---

## Verification Steps

1. Add a quarter with 500 XAF fee and confirm it appears in the list
2. Add a quarter with 0 XAF and confirm "Free delivery" label
3. Attempt a duplicate name and confirm validation error
4. Assign a quarter to a group and confirm group fee is used
5. Submit with missing French name and confirm validation error
6. Verify the quarter is linked to the correct town in the database

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Very high delivery fee (99,999 XAF) | Accepted but soft warning for unusual amount |
| Quarter name with numbers or special chars | Accepted (e.g., "Quartier 7") |
| No quarter groups exist | Group assignment dropdown hidden or shows "No groups available" |
| Same quarter name in different towns | Allowed; uniqueness is per-town |
| Adding 50+ quarters to one town | Accepted; list handles scrolling |

---

## UI/UX Notes

- Add Quarter form appears inline within the expanded town section
- Three fields: name (en), name (fr), delivery fee (XAF)
- Optional: group assignment dropdown
- Fee field shows "XAF" suffix, numeric input only
- "Save" and "Cancel" buttons
- Success: quarter fades into the list; toast notification
- Fee of 0 displays as "Free" with a distinct visual indicator (green badge)

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-082 | Add Town | Parent town must exist first |
| F-087 | Quarter List View | Displays the added quarter |
| F-088 | Edit Quarter | Edit the quarter after creation |
| F-090 | Quarter Group Creation | Groups that quarters can be assigned to |
| F-091 | Delivery Fee Configuration | Manages fees at quarter and group level |
