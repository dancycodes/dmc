# F-105 — Schedule Template Application to Days

> Module: Schedule
> Priority: Must-have
> Precedence: F-101
> Type: functional

---

## What It Does
Allows a cook to apply a schedule template to one or multiple days of the week. Applying a template copies the template's interval configurations (order, delivery, pickup) to create or overwrite schedule entries for the selected days. The cook selects days via checkboxes. If selected days already have schedule entries, a confirmation dialog warns that existing schedules will be overwritten. The application is performed via Gale.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Applies schedule templates to days to quickly configure their schedule |
| Manager | Applies templates if granted `manage-schedules` permission |

---

## User Scenarios
### Scenario 1: Apply to multiple empty days
The cook selects the "Lunch Service" template and checks Monday, Tuesday, Wednesday, and Thursday. None of these days have existing schedules. The template's intervals are copied to create schedule entries for all 4 days. Success toast: "Template applied to 4 days."

### Scenario 2: Apply to days with existing schedules
The cook selects the "Dinner Service" template and checks Monday and Friday. Monday already has a schedule. A confirmation dialog warns: "Monday already has a schedule. Applying will overwrite it. Continue?" The cook confirms, and both days receive the template's configuration.

### Scenario 3: Apply to a single day
The cook selects "Lunch Service" and checks only Saturday. The template is applied to Saturday only.

### Scenario 4: No days selected
The cook clicks "Apply" without selecting any days. Validation error: "Select at least one day."

### Scenario 5: Cancel overwrite confirmation
The cook selects days that include some with existing schedules. The confirmation dialog appears, and the cook clicks Cancel. No changes are made.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-153 | Applying a template copies its values to the target schedule entries (not a live link) |
| BR-154 | At least one day must be selected |
| BR-155 | If a selected day already has schedule entries, a confirmation dialog must warn about overwriting |
| BR-156 | Overwriting replaces all interval values on the existing schedule entry with the template's values |
| BR-157 | The applied schedule entry stores a `template_id` reference for tracking purposes |
| BR-158 | Availability is set to `true` (available) for all applied entries |
| BR-159 | If a day has multiple schedule entries, the template replaces the first entry and removes extras (or creates one fresh entry) |
| BR-160 | Template application is logged via Spatie Activitylog |
| BR-161 | Only users with `manage-schedules` permission can apply templates |

---

## Data Involved
**Creates:**
- CookSchedule entries for days that don't have existing schedules

**Reads:**
- ScheduleTemplate to copy values from
- Existing CookSchedule entries for the selected days to detect overwrites

**Updates:**
- Existing CookSchedule entries for selected days (overwrite with template values)
- Sets `template_id` on affected CookSchedule entries

**Deletes:**
- Extra schedule entries if a day had multiple and the template replaces with one

**Relationships:**
- CookSchedule references ScheduleTemplate via `template_id`

---

## Acceptance Criteria
- **Given** a template and 3 unconfigured days selected, **when** applied, **then** 3 new schedule entries are created with the template's intervals
- **Given** a day with an existing schedule, **when** the template is applied, **then** a confirmation dialog warns about overwriting
- **Given** confirmation accepted, **when** processing, **then** the existing schedule is overwritten with template values
- **Given** no days selected, **when** clicking apply, **then** validation error is shown
- **Given** cancel on the confirmation dialog, **when** processing, **then** no changes are made
- **Given** a successful application, **when** viewing the schedule entries, **then** they display the template's intervals and reference the template

---

## Verification Steps
1. Apply a template to 3 empty days — confirm 3 entries created with correct values
2. Apply a template to a day with existing schedule — confirm overwrite warning
3. Accept overwrite and verify values are replaced
4. Cancel overwrite and verify no changes
5. Apply with no days selected — confirm validation error
6. Verify `template_id` is set on the applied entries
7. Check activity log for the application event

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Template deleted after applying | Applied schedules unaffected; `template_id` becomes null |
| Apply same template to same days again | Overwrite confirmation shown; values re-copied (no-op if unchanged) |
| Day has multiple entries, template applied | All existing entries for that day replaced with one template-based entry |
| Template has delivery disabled | Applied schedule entries have delivery disabled |

---

## UI/UX Notes
- Accessible from template list (F-102) via "Apply" button, or from template detail view
- Day selection via checkboxes (Mon through Sun)
- Days with existing schedules marked with a warning icon
- "Apply Template" button at the bottom
- Confirmation dialog lists the days that will be overwritten
- Success toast after application
- Schedule list refreshes via Gale to show updated entries
- Mobile-friendly checkbox layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-098 | Cook Day Schedule Creation | Creates schedule entries that can be overwritten |
| F-101 | Create Schedule Template | Creates the templates applied here |
| F-102 | Schedule Template List View | Provides the entry point via "Apply" button |
| F-103 | Edit Schedule Template | Template can be edited before re-applying |
