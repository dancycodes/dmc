# F-129 â€” Meal Detail View

> Module: Tenant Landing
> Priority: Must-have
> Precedence: F-128
> Type: functional

---

## What It Does
Renders a full meal detail page or modal on the cook's tenant site when a client clicks a meal card from the grid. Displays the meal's complete information: name, description, image carousel (up to 3 images), all components with individual prices and units, per-component availability status, requirement rules explained in plain language, the schedule indicating when the meal is orderable, and the delivery/pickup locations available. Each component has an "Add to Cart" action with a quantity selector, respecting component requirements and availability constraints.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Views full meal details and selects components to add to cart |
| Cook | Can preview how their meal detail appears to clients |

---

## User Scenarios
### Scenario 1: Viewing a complete meal
The visitor clicks "Ndole Platter" from the grid. A detail view opens showing: "Ndole Platter" title, a rich description, a carousel of 3 food photos, and a component list: "Ndole (main)" at 2,000 XAF/plate, "Plantains (side)" at 500 XAF/portion, "Miondo (side)" at 300 XAF/portion. The visitor sees that Plantains requires Ndole to be selected first (requirement rule displayed).

### Scenario 2: Component with limited availability
One component "Special Pepper Sauce" shows "Only 5 left" with an amber indicator. The quantity selector maxes out at 5. Another component "Egusi Soup" shows "Sold Out" with a greyed-out add button.

### Scenario 3: Viewing schedule information
The meal detail shows "Available: Monday to Friday, 11:00 AM - 2:00 PM (Lunch)" from the cook's schedule. The current day is highlighted if it falls within the schedule.

### Scenario 4: Adding components to cart
The visitor selects 2 plates of Ndole and 1 portion of Plantains. They click "Add to Cart." The cart icon in the navigation updates to show 2 items and the running total. The detail view remains open for further selection.

### Scenario 5: Mobile view
On mobile, the detail view takes the full screen. The image carousel is at the top, followed by description, components list, and action buttons. Components are displayed as stacked cards with inline quantity selectors.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-156 | The meal detail view displays: name, description, images, all components, schedule, locations |
| BR-157 | Image carousel supports up to 3 images with manual navigation (swipe on mobile, arrows on desktop) |
| BR-158 | Each component shows: name, price, unit (e.g., plate, portion, piece), availability status |
| BR-159 | Component availability statuses: "Available", "Low Stock (X left)", "Sold Out" |
| BR-160 | Requirement rules are displayed in plain language (e.g., "Requires: Ndole (main dish)") |
| BR-161 | Quantity selector respects: minimum 1, maximum based on available stock or cook-defined max |
| BR-162 | "Add to Cart" is disabled for sold-out components |
| BR-163 | Adding to cart updates the cart state reactively via Gale without page reload |
| BR-164 | The meal's orderable schedule is displayed with day/time information |
| BR-165 | Available delivery towns and pickup locations are listed |
| BR-166 | All text localized via `__()`, meal name and description shown in user's locale |

---

## Data Involved
**Reads:**
- Meal record: name_en, name_fr, description_en, description_fr
- Meal images (up to 3, ordered by position)
- Meal components: name, price, unit, stock/availability, requirement rules
- Meal schedule (from cook schedule or meal-specific override)
- Meal delivery/pickup locations

**Creates:**
- Meal detail Blade component/page
- Component selection UI component
- Quantity selector component

**Updates:**
- Cart session data when components are added

**Relationships:**
- Accessed from F-128 (Available Meals Grid Display)
- Uses component data from F-118 (Meal Component management)
- Cart interaction feeds into F-138 (Meal Component Selection & Cart Add)
- Schedule data from F-098 (Cook Schedule) / F-106 (Meal Schedule Override)

---

## Acceptance Criteria
- **Given** a meal with 3 images, **when** the detail view opens, **then** a navigable image carousel is displayed
- **Given** a component with 5 items in stock, **when** viewing the component, **then** "Low Stock (5 left)" indicator is shown and quantity max is 5
- **Given** a sold-out component, **when** viewing the component, **then** the add button is disabled and "Sold Out" is shown
- **Given** a component with a requirement rule, **when** viewing the component, **then** the requirement is displayed in plain language
- **Given** the visitor adds a component to the cart, **when** clicking "Add to Cart", **then** the cart updates reactively and shows the new total
- **Given** a mobile viewport, **when** the detail view opens, **then** it displays in a full-screen layout

---

## Verification Steps
1. Click a meal card and confirm the detail view opens with complete information
2. Navigate the image carousel with arrows/swipe and confirm all images display
3. Verify each component shows name, price, unit, and availability
4. Add a component to the cart and verify the cart icon updates
5. Attempt to add a sold-out component and confirm the button is disabled
6. Verify requirement rules are displayed next to dependent components
7. Check the schedule and location sections display correct data
8. Test on mobile and confirm full-screen responsive layout

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Meal has only 1 image | Single image displayed without carousel controls |
| Meal has no images | Placeholder image displayed |
| Meal has no components | Unusual state; show message "This meal has no items yet" |
| All components are sold out | Show "Currently Unavailable" message prominently |
| Component price is 0 (free add-on) | Display "Free" instead of "0 XAF" |
| Meal description is very long | Description truncated with "Read more" toggle |
| Guest user adds to cart | Cart works without authentication; prompted to login at checkout |

---

## UI/UX Notes
- Detail view can be a full page or a large modal/slide-over panel
- Image carousel with dot indicators and arrow navigation
- Components listed as cards with clear price, unit, and availability
- Quantity selector: minus (-) button, number input, plus (+) button
- "Add to Cart" button per component or a single "Add Selected to Cart" button
- Running total displayed at the bottom of the component selection area
- Back button or close button to return to the meals grid
- Sticky "Add to Cart" bar at the bottom on mobile

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-128 | Available Meals Grid Display | Source of navigation to this view |
| F-118 | Meal Component Management | Source of component data |
| F-138 | Meal Component Selection & Cart Add | Handles cart addition logic |
| F-098 | Cook Day Schedule Creation | Source of schedule data |
| F-106 | Meal Schedule Override | Meal-specific schedule overrides |
| F-091 | Delivery Area Management | Source of delivery location data |
| F-092 | Pickup Location Management | Source of pickup location data |
