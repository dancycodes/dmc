# F-088 â€” Edit Quarter

> Module: Location
> Priority: Must-have
> Precedence: F-087
> Type: functional

---

## What It Does

Allows the cook to edit an existing quarter's name (en/fr), delivery fee, and group assignment. The edit form pre-populates with current values. Validates uniqueness of the quarter name within its parent town. Saves via Gale without page reload. The updated quarter data is reflected in the quarter list and applies to new orders.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Edits quarter details such as name, fee, or group |
| Manager | Edits quarters if granted location management permission |

---

## User Scenarios

### Scenario 1: Edit delivery fee
A cook clicks "Edit" on "Bonaberi" (currently 500 XAF). They change the fee to 600 XAF and save. The quarter list updates to show the new fee.

### Scenario 2: Change group assignment
A cook edits quarter "Deido" which is currently in group "Central Douala." They change it to "North Douala" group. The quarter now uses the "North Douala" group's fee.

### Scenario 3: Remove from group
A cook edits quarter "Akwa" which is in a group. They select "No group" from the dropdown. The quarter's individual delivery fee field becomes editable and they set 400 XAF.

### Scenario 4: Rename validation error
A cook tries to rename "Bonaberi" to "Akwa" (which already exists in this town). A validation error appears.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-250 | Quarter name required in both English and French |
| BR-251 | Quarter name must remain unique within the parent town (excluding current quarter) |
| BR-252 | Delivery fee required; must be >= 0 XAF |
| BR-253 | Group assignment can be changed or removed |
| BR-254 | When in a group, the group's fee overrides the individual fee |
| BR-255 | Fee changes apply to new orders only, not existing orders |
| BR-256 | Save via Gale; list updates without page reload |
| BR-257 | Edit action requires location management permission |

---

## Data Involved

**Reads:**
- Current quarter data (for pre-population)
- Other quarter names in this town (uniqueness check)
- Available quarter groups

**Updates:**
- Quarter record: name_en, name_fr, delivery_fee, quarter_group_id, updated_at

---

## Acceptance Criteria

- **Given** the edit form, **when** the cook updates the fee and saves, **then** the change is persisted and the list updates
- **Given** a name change to a duplicate, **when** saving, **then** a uniqueness error is shown
- **Given** a group change, **when** saved, **then** the quarter uses the new group's fee
- **Given** group removed, **when** saved, **then** the quarter uses its individual fee
- **Given** fee changes, **when** viewing existing orders, **then** they retain the old fee

---

## Verification Steps

1. Edit a quarter's fee and confirm the list updates
2. Change a quarter's group and confirm the fee reflects the new group
3. Remove a quarter from a group and set an individual fee
4. Attempt to rename to a duplicate and confirm validation error
5. Confirm existing orders are not affected by the fee change

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Editing a quarter with active orders | Allowed; changes apply to future orders only |
| Changing group while group has fee 0 | Quarter shows "Free delivery" |
| Network error during save | Error toast; form data preserved |
| Concurrent edits | Last save wins |

---

## UI/UX Notes

- Inline edit form replacing the quarter row, or modal dialog
- Pre-populated fields: name (en), name (fr), delivery fee, group dropdown
- Fee field disabled when group is selected (shows group fee as read-only)
- "Save" and "Cancel" buttons
- Success: row updates; toast notification

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-087 | Quarter List View | Edit initiated from the quarter list |
| F-086 | Add Quarter | Same form structure |
| F-089 | Delete Quarter | Alternative action |
| F-091 | Delivery Fee Configuration | Related fee management |
