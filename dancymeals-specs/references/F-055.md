# F-055 — Delete Role

> Module: Admin
> Priority: Must-have
> Precedence: F-053
> Type: functional

---

## What It Does
Allows admins to delete custom roles that are no longer needed. System roles cannot be deleted under any circumstances. A role with active user assignments cannot be deleted — users must be reassigned to a different role first. Deletion requires explicit confirmation via a dialog. The deletion is logged in the activity log.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Deletes any custom role |
| Admin | Deletes custom roles (with appropriate permissions) |

---

## User Scenarios
### Scenario 1: Deleting an empty custom role
An admin views a custom role "Delivery Boy" that has 0 users. They click "Delete Role". A confirmation dialog appears: "Are you sure you want to delete the role 'Delivery Boy'? This action cannot be undone." They confirm. The role is deleted and they are redirected to the role list.

### Scenario 2: Attempting to delete a role with assigned users
An admin tries to delete "Kitchen Assistant" which has 4 users assigned. The delete button is disabled or clicking it shows: "Cannot delete this role. 4 users are currently assigned to it. Reassign them first."

### Scenario 3: Attempting to delete a system role
An admin views the "cook" system role. The delete option is not available — either hidden or disabled with a tooltip: "System roles cannot be deleted."

### Scenario 4: Confirming deletion
The confirmation dialog displays the role name and the number of permissions that will be removed. The admin must type the role name to confirm (for destructive action safety).

---

## Business Rules
| Code | Rule |
|------|------|
| BR-122 | System roles (super-admin, admin, cook, manager, client) cannot be deleted |
| BR-123 | Custom roles with one or more assigned users cannot be deleted |
| BR-124 | Deletion is permanent — the role and all its permission assignments are removed |
| BR-125 | Deletion requires explicit confirmation (type role name to confirm) |
| BR-126 | Deletion is logged in the activity log with the admin as causer |
| BR-127 | After deletion, the admin is redirected to the role list |

---

## Data Involved
**Reads:**
- Role: is_system flag, name
- User count for the role

**Creates:**
- Activity log entry recording the deletion

**Deletes:**
- Role record (via Spatie Permission)
- All role-permission pivot records for this role

**Relationships:**
- F-053: Navigated from role list; returns to it after deletion
- F-056: Permission assignments are cascade-deleted with the role

---

## Acceptance Criteria
- **Given** a custom role with 0 users, **when** confirming deletion, **then** the role is deleted and removed from the list
- **Given** a custom role with assigned users, **when** attempting to delete, **then** deletion is blocked with a descriptive message
- **Given** a system role, **when** viewing it, **then** no delete option is available
- **Given** deletion confirmation, **when** the admin types the role name and confirms, **then** the role is permanently removed
- **Given** successful deletion, **when** checking the activity log, **then** the deletion is recorded

---

## Verification Steps
1. Delete a custom role with 0 users — confirm it is removed from the role list
2. Attempt to delete a custom role with users — confirm it is blocked
3. Verify system roles have no delete option
4. Check activity log — confirm deletion event recorded
5. Verify deleted role's permissions are also removed from the pivot table

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Admin deletes a role while another admin is editing it | Edit page shows "Role not found" on next save attempt |
| Role deletion fails due to database constraint | Error message: "Unable to delete role. Please contact support." |
| Network failure during deletion | No partial deletion; transaction rolls back |
| Admin types wrong role name in confirmation | Confirm button remains disabled |

---

## UI/UX Notes
- Delete button styled with red/danger color, available only for custom roles
- Confirmation modal with warning icon and destructive styling
- Modal shows: role name, number of permissions being removed, text input for role name confirmation
- Confirm button disabled until role name is typed correctly
- Cancel button closes the modal without action
- Success toast: "Role 'Delivery Boy' has been deleted"
- Redirect to role list after successful deletion

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-053 | Role List View | Parent navigation and redirect target |
| F-054 | Edit Role | Delete option may also appear on edit page |
| F-056 | Permission Assignment | Permissions are removed when role is deleted |
