# F-211 â€” Manager Dashboard Access

> Module: Manager
> Priority: Must-have
> Precedence: F-210, F-076
> Type: functional

---

## What It Does
Controls how managers experience the cook dashboard. When a manager logs into a tenant domain where they hold the manager role, they see the cook dashboard filtered to only the sections and actions their permissions allow. Navigation items for unpermitted sections are completely hidden. Attempting to directly access an unpermitted route returns a 403 Forbidden response. If a manager manages multiple cooks (has the manager role on multiple tenants), they can switch between tenant domains. A tenant switcher is available showing all tenants they manage. All dashboard access by managers is logged via Spatie Activitylog.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Manager | Accesses permitted dashboard sections; switches between tenants if managing multiple cooks |
| Cook | Benefits from delegated work done by managers |
| Admin | Can audit manager activity in logs |

---

## User Scenarios
### Scenario 1: Manager logs in with limited permissions
A manager with "Manage Orders" and "Manage Meals" permissions logs into `latifa.dm.test`. The dashboard sidebar shows only Home, Orders, and Meals. All other sections are hidden. The manager can view, create, and update orders and meals.

### Scenario 2: Manager attempts unpermitted route
The manager manually navigates to `latifa.dm.test/dashboard/wallet`. The system returns a 403 Forbidden page with the message: "You do not have permission to access this section."

### Scenario 3: Manager switches between tenants
The manager manages both Latifa's and Moussa's tenants. A tenant switcher in the dashboard header shows both. Clicking "Moussa's Kitchen" navigates to `moussa.dm.test/dashboard`. The permissions on Moussa's tenant may differ from Latifa's.

### Scenario 4: Manager with no permissions
A manager whose cook has not yet configured any permissions logs in. They see the dashboard home page with the message: "Your permissions haven't been configured yet. Please contact the cook." No sidebar sections are active.

### Scenario 5: Manager access logged
Every page the manager visits within the dashboard is logged with their user ID, the tenant, and the section accessed.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-483 | Managers see only dashboard sections corresponding to their granted permissions |
| BR-484 | Navigation items for unpermitted sections are not rendered in the sidebar |
| BR-485 | Direct URL access to an unpermitted section returns 403 Forbidden |
| BR-486 | A manager with no permissions sees a "no permissions" message on the dashboard home |
| BR-487 | Managers who manage multiple tenants see a tenant switcher in the dashboard header |
| BR-488 | The tenant switcher lists all tenants where the user holds the manager role, with the cook's brand name |
| BR-489 | Switching tenants navigates to the other tenant's domain dashboard |
| BR-490 | Manager dashboard access is logged via Spatie Activitylog (section accessed, timestamp) |
| BR-491 | Managers cannot access cook-reserved sections regardless of route manipulation: wallet, theme, managers, promo codes, cook profile, cook settings |
| BR-492 | All user-facing text must use `__()` localization |
| BR-493 | Gale handles all navigation within the dashboard |

---

## Data Involved
**Creates:**
- Activity log entries for each dashboard section access by a manager

**Reads:**
- Manager's permissions for the current tenant (from Spatie)
- List of all tenants where the user has the manager role
- Tenant brand names for the switcher

**Updates:**
- Nothing

**Relationships:**
- Manager (User) belongsToMany Roles/Permissions (Spatie, tenant-scoped)
- Manager manages multiple Tenants (through role pivot)

---

## Acceptance Criteria
- **Given** a manager with "Manage Orders" permission, **when** they log in, **then** the sidebar shows Home and Orders only
- **Given** a manager, **when** they visit an unpermitted route, **then** a 403 response is returned
- **Given** a manager with no permissions, **when** they log in, **then** a "no permissions" message is displayed
- **Given** a manager on multiple tenants, **when** they view the header, **then** a tenant switcher is visible with all their tenants
- **Given** the tenant switcher, **when** the manager clicks another tenant, **then** they navigate to that tenant's dashboard
- **Given** a manager navigating the dashboard, **when** they visit any section, **then** the access is logged

---

## Verification Steps
1. Log in as a manager with "Manage Orders" only -- confirm sidebar shows Home and Orders
2. Navigate directly to `/dashboard/meals` -- confirm 403 response
3. Log in as a manager with no permissions -- confirm "no permissions" message
4. Create a manager on two tenants -- confirm tenant switcher appears with both tenants
5. Switch tenants via the switcher -- confirm navigation to the other tenant's dashboard
6. Verify permissions are independently evaluated per tenant
7. Check activity log for manager access entries
8. Verify cook-reserved sections are never accessible to managers

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Manager's permissions change while they are on the dashboard | Next navigation re-evaluates; sidebar updates accordingly |
| Manager removed from tenant while logged in | Next request returns 403 for the entire dashboard; tenant disappears from switcher |
| Manager is also a client on the same tenant | Client browsing on the tenant's public site is unaffected; dashboard access follows manager permissions |
| Tenant is deactivated while manager is logged in | Dashboard shows "site unavailable" page |
| Manager manages 10+ tenants | Tenant switcher becomes scrollable; search filter available |
| Browser back button to unpermitted section | 403 response; no cached content |

---

## UI/UX Notes
- Dashboard layout is identical to the cook dashboard (F-076) but with filtered sidebar
- Tenant switcher in the header: dropdown showing cook brand name and avatar for each tenant
- Active tenant is highlighted in the switcher
- "No permissions" state: centered message with the cook's brand name, e.g., "Contact Latifa to configure your access"
- 403 page: friendly design with a "Go back to dashboard" link
- Manager's name shown in the header with a "Manager" badge
- On mobile: tenant switcher accessible from the hamburger menu
- All navigation via Gale (no full page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-210 | Manager Permission Configuration | Defines what the manager can access |
| F-076 | Cook Dashboard Layout & Navigation | Base layout the manager dashboard extends |
| F-209 | Cook Creates Manager Role | Creates the manager assignment |
| F-006 | Role & Permission Seed Setup | Defines roles and permissions |
