# F-108 — Meal Creation Form

> Module: Meal
> Priority: Must-have
> Precedence: F-076
> Type: functional

---

## What It Does
Provides a form for cooks to create a new meal within their tenant. The form captures the meal's name (English and French), description (English and French), and sets the initial status to "draft." The meal is saved via Gale and the cook is redirected to the meal edit page where they can add images, components, tags, and other details. A meal cannot go live until at least one component is added (enforced by F-112).

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Creates new meals for their food business |
| Manager | Creates meals if granted `manage-meals` permission |

---

## User Scenarios
### Scenario 1: Create a meal with both languages
The cook navigates to the Meals section and clicks "Add Meal." They fill in: name (EN: "Jollof Rice", FR: "Riz Jollof"), description (EN: "Spicy tomato rice...", FR: "Riz tomate epicé..."). They click Save. The meal is created as draft, and the cook is redirected to the meal edit page. Success toast: "Meal created."

### Scenario 2: Create a meal with one language initially
The cook fills in only the English name and description. Validation fails because both language versions are required when either is provided.

### Scenario 3: Create a meal as a manager
A manager with `manage-meals` permission creates a meal. The meal belongs to the tenant, and the creation is logged with the manager as the causer.

### Scenario 4: Meal name already exists
The cook enters a name that already exists for another meal in the same tenant. Validation fails: "A meal with this name already exists."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-187 | Meal name is required in both English and French |
| BR-188 | Meal description is required in both English and French |
| BR-189 | Meal name must be unique within the tenant (checked per language) |
| BR-190 | New meals default to "draft" status |
| BR-191 | New meals default to "available" availability |
| BR-192 | A meal cannot go live without at least one component (enforced in F-112, not here) |
| BR-193 | Meals are tenant-scoped |
| BR-194 | Only users with `manage-meals` permission can create meals |
| BR-195 | Meal creation is logged via Spatie Activitylog |
| BR-196 | Meal name max length: 150 characters per language |
| BR-197 | Meal description max length: 2000 characters per language |

---

## Data Involved
**Creates:**
- `Meal` model with fields: `id`, `tenant_id`, `name_en`, `name_fr`, `description_en`, `description_fr`, `status` (enum: draft/live, default draft), `is_available` (boolean, default true), `estimated_prep_time` (nullable integer, minutes), `position` (integer for ordering), `created_at`, `updated_at`, `deleted_at` (soft delete)
- Migration for `meals` table
- Factory and seeder for Meal
- Form Request class for meal creation validation

**Reads:**
- Existing meals for name uniqueness validation
- Tenant context

**Updates:**
- Nothing (creation only)

**Relationships:**
- Meal belongsTo Tenant
- Meal hasMany MealComponents (F-118)
- Meal hasMany MealImages (F-109)
- Meal belongsToMany Tags (F-114)
- Meal hasMany MealSchedules (F-106)

---

## Acceptance Criteria
- **Given** a cook on the meal creation form, **when** they fill in valid name and description in both languages, **then** the meal is created with draft status
- **Given** only English name provided, **when** submitted, **then** validation fails requiring both languages
- **Given** a duplicate meal name, **when** submitted, **then** validation fails
- **Given** a successful creation, **when** processing completes, **then** the cook is redirected to the meal edit page
- **Given** a new meal, **when** inspecting its status, **then** it is "draft"
- **Given** a manager without `manage-meals` permission, **when** they access the form, **then** they receive a 403

---

## Verification Steps
1. Create a meal with all fields — confirm it saves as draft
2. Attempt to create with missing French translation — confirm validation error
3. Attempt duplicate name — confirm validation error
4. Verify redirect to meal edit page after creation
5. Verify meal appears in the meal list (F-116) with draft badge
6. Check activity log for the creation entry
7. Verify unauthorized access is blocked

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Name with special characters (accents, apostrophes) | Accepted and stored correctly |
| Description with HTML tags | Tags stripped or escaped (XSS prevention) |
| Very long name at exactly 150 characters | Accepted |
| Name at 151 characters | Validation error |
| Whitespace-only name | Validation error — name must contain non-whitespace characters |

---

## UI/UX Notes
- Accessible from cook dashboard sidebar under "Meals" > "Add Meal" button
- Form fields grouped: English section (name, description) and French section (name, description)
- Or side-by-side tabs for EN/FR if space allows
- Description fields as textarea with character count
- Save and Cancel buttons
- Form submission via Gale (no page reload)
- Toast notification on success
- Redirect to meal edit page for further configuration (images, components, etc.)
- Mobile-friendly stacked layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Provides the dashboard shell |
| F-109 | Meal Image Upload & Carousel | Add images after creation on the edit page |
| F-110 | Meal Edit | Edit the meal after creation |
| F-112 | Meal Status Toggle (Draft/Live) | Cannot go live without components |
| F-116 | Meal List View (Cook Dashboard) | Lists all meals including newly created ones |
| F-118 | Meal Component Creation | Add components from the meal edit page |
