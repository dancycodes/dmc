# F-059 — Payment Monitoring View

> Module: Admin
> Priority: Must-have
> Precedence: F-043
> Type: functional

---

## What It Does
Displays a comprehensive list of all payment transactions across the platform within the admin panel. Shows transaction details including order ID, client, cook, amount, payment method (MTN Mobile Money or Orange Money), status, and date. Supports filtering by payment status and searching by order ID or client name. A detail view reveals full Flutterwave transaction data for troubleshooting.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Monitors all payment transactions, investigates issues |
| Admin | Monitors all payment transactions, investigates issues |

---

## User Scenarios
### Scenario 1: Browsing recent payments
An admin navigates to Finance > Payments. A paginated table shows all transactions, most recent first. Columns: Order ID, Client, Cook, Amount (XAF), Method (MTN/Orange), Status (badge), Date.

### Scenario 2: Filtering failed payments
The admin selects "Failed" from the status filter. Only failed payment transactions are shown. The admin investigates why a particular payment failed by clicking the row.

### Scenario 3: Searching by order ID
The admin types "ORD-1042" in the search bar. The table filters to show only the transaction(s) associated with that order.

### Scenario 4: Viewing transaction detail
The admin clicks a transaction row. A detail panel or page opens showing: full Flutterwave transaction reference, payment channel, customer details (as sent to Flutterwave), amount charged, currency, Flutterwave fees, settlement amount, status history, response codes, and raw webhook payload.

### Scenario 5: Identifying refunded transactions
The admin filters by "Refunded" status. Transactions where the platform refunded to the client's wallet are displayed with the refund reason and amount.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-151 | Payment statuses: successful, failed, pending, refunded |
| BR-152 | All payment data originates from Flutterwave webhook responses stored locally |
| BR-153 | Payment methods shown: MTN Mobile Money, Orange Money |
| BR-154 | Transaction detail shows the raw Flutterwave response data for debugging |
| BR-155 | Search covers: order ID, client name, client email, Flutterwave transaction reference |
| BR-156 | Default sort: date descending (most recent first) |
| BR-157 | Pagination: 20 items per page |

---

## Data Involved
**Reads:**
- Payment transactions: order_id, amount, payment_method, status, flutterwave_reference, created_at
- Flutterwave webhook data: full response payload, status history
- Orders: associated order details
- Users: client name/email, cook name

**Creates:**
- Nothing (read-only monitoring view)

**Updates:**
- Nothing

**Relationships:**
- F-043: Displayed within admin panel
- F-058: Financial reports reference the same transaction data
- F-065: Failed transfers appear in manual payout queue

---

## Acceptance Criteria
- **Given** payment transactions exist, **when** navigating to the payments page, **then** a paginated table of transactions is displayed
- **Given** the "Failed" status filter, **when** applied, **then** only failed transactions are shown
- **Given** a search by order ID, **when** typed, **then** matching transactions are displayed
- **Given** a transaction row click, **when** clicked, **then** the full Flutterwave transaction detail is shown
- **Given** a refunded transaction, **when** viewed in detail, **then** the refund reason and amount are shown

---

## Verification Steps
1. Navigate to payment monitoring — confirm all recent transactions are listed
2. Filter by "Failed" — confirm only failed transactions shown
3. Search by order ID — confirm correct results
4. Click a transaction — confirm Flutterwave details are displayed
5. Verify a "Refunded" transaction shows refund details

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No transactions exist | Empty state: "No payment transactions recorded yet." |
| Flutterwave webhook data missing | Detail view shows "Webhook data unavailable" for missing fields |
| Payment in "pending" status for >15 minutes | Row highlighted with warning indicator |
| Transaction amount is 0 (free order/promo) | Displayed normally with amount "0 XAF" |
| Flutterwave reference is null (webhook not yet received) | Reference column shows "Awaiting confirmation" |

---

## UI/UX Notes
- Table with clear status badges: green (successful), red (failed), yellow (pending), blue (refunded)
- Search bar and status filter dropdown above the table
- Payment method shown with icon: MTN logo for MTN MoMo, Orange logo for Orange Money
- Transaction detail can be a slide-over panel or a dedicated page
- Detail view includes a "raw data" collapsible section for technical debugging
- Amounts formatted: "15,000 XAF"
- Mobile: card layout with key fields; detail view full-screen
- Summary bar above table: Total Transactions, Successful Amount, Failed Count, Pending Count

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-043 | Admin Panel Layout | Parent layout |
| F-058 | Financial Reports | Uses same transaction data for reports |
| F-061 | Admin Complaint Resolution | Refund decisions reference payment data |
| F-065 | Manual Payout Queue | Failed transfers link here for context |
