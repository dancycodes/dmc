# F-115 — Cook Tag Management

> Module: Meal
> Priority: Must-have
> Precedence: F-076
> Type: functional

---

## What It Does
Allows a cook to create and manage custom tags for categorizing their meals within their tenant. Tags are tenant-scoped — each cook has their own tag set. Full CRUD operations are supported: create (name in English and French), edit, and delete. Tags that are currently assigned to meals cannot be deleted until they are unassigned first. Tags are used for filtering on the tenant landing page and the discovery page. Examples: "spicy," "vegetarian," "popular," "new," "breakfast."

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Creates and manages tags for meal categorization |
| Manager | Manages tags if granted `manage-meals` permission |
| Client | Uses tags to filter meals on the tenant landing page |

---

## User Scenarios
### Scenario 1: Create a tag
The cook navigates to the Tag management section and clicks "Add Tag." They enter name_en: "Spicy" and name_fr: "Epice." The tag is created and appears in the tag list. Toast: "Tag created."

### Scenario 2: Edit a tag
The cook edits "Spicy" to "Extra Spicy" (EN) and "Tres Epice" (FR). The change saves. All meals with this tag reflect the updated name.

### Scenario 3: Delete an unused tag
The cook deletes the "New" tag which is not assigned to any meals. The tag is removed from the list.

### Scenario 4: Attempt to delete a tag in use
The cook tries to delete "Breakfast" which is assigned to 3 meals. The action is blocked: "Cannot delete — this tag is assigned to 3 meals. Remove it from all meals first."

### Scenario 5: View tag list
The cook sees a list of all their tags with the number of meals using each one.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-252 | Tags are tenant-scoped — each tenant has its own tag set |
| BR-253 | Tag name is required in both English and French |
| BR-254 | Tag name must be unique within the tenant (per language) |
| BR-255 | Tags cannot be deleted if assigned to any meal |
| BR-256 | Editing a tag name updates it everywhere it is displayed |
| BR-257 | Only users with `manage-meals` permission can manage tags |
| BR-258 | Tag CRUD operations are logged via Spatie Activitylog |
| BR-259 | Tag name max length: 50 characters per language |
| BR-260 | Tag names are case-insensitive for uniqueness (e.g., "Spicy" and "spicy" are duplicates) |

---

## Data Involved
**Creates:**
- `Tag` model with fields: `id`, `tenant_id`, `name_en`, `name_fr`, `created_at`, `updated_at`
- Migration for `tags` table
- Factory and seeder for Tag

**Reads:**
- Existing tags for uniqueness validation
- Meal count per tag (for display and delete validation)

**Updates:**
- Tag name fields on edit

**Deletes:**
- Tag record (hard delete, only if not assigned to any meal)

**Relationships:**
- Tag belongsTo Tenant
- Tag belongsToMany Meals (via meal_tag pivot)

---

## Acceptance Criteria
- **Given** a cook, **when** they create a tag with valid EN and FR names, **then** the tag appears in the list
- **Given** a duplicate tag name, **when** submitted, **then** validation fails
- **Given** a tag assigned to 3 meals, **when** the cook tries to delete it, **then** deletion is blocked
- **Given** a tag not assigned to any meals, **when** deleted, **then** it is removed from the list
- **Given** a tag edit, **when** saved, **then** the updated name appears everywhere the tag is used
- **Given** only one language provided, **when** submitted, **then** validation fails

---

## Verification Steps
1. Create a tag with both language names — confirm it appears in the list
2. Attempt duplicate name — confirm validation error
3. Delete an unused tag — confirm removal
4. Attempt to delete a tag in use — confirm it is blocked with meal count
5. Edit a tag name — confirm the change reflects on assigned meals
6. Create a tag with only one language — confirm validation error
7. Check activity log for tag operations

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Tag with special characters (accents, hyphens) | Accepted and stored correctly |
| Many tags (50+) | List is scrollable; consider search/filter for large tag sets |
| Tag name is whitespace only | Validation error |
| Case-insensitive duplicate ("Spicy" vs "spicy") | Treated as duplicate; validation error |
| Editing a tag to conflict with existing tag | Validation error on save |

---

## UI/UX Notes
- Accessible from cook dashboard sidebar under "Meals" > "Tags" or as a separate section
- Tag list with columns: name (EN/FR), meals using it (count), actions (edit, delete)
- "Add Tag" button at the top
- Inline editing or modal form for create/edit
- Delete button disabled with tooltip if tag is in use
- All interactions via Gale
- Mobile-friendly card layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Provides the dashboard shell |
| F-114 | Meal Tag Assignment | Uses tags created here for assignment |
| F-128 | Available Meals Grid Display | Displays tags on meal cards |
| F-136 | Meal Filters | Tags available as filter options |
