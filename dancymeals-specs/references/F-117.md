# F-117 — Meal Estimated Preparation Time

> Module: Meal
> Priority: Should-have
> Precedence: F-108
> Type: functional

---

## What It Does
Allows a cook to set an estimated preparation time for a meal, specified in minutes. This optional field helps clients plan their orders by knowing approximately how long the meal takes to prepare. When set, the estimated time is displayed on the meal card and meal detail page on the tenant landing page (e.g., "Est. prep: ~30 min"). The field can be updated or cleared at any time from the meal edit page via Gale.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Sets and updates the estimated preparation time |
| Manager | Updates prep time if granted `manage-meals` permission |
| Client | Views the estimated preparation time on the meal card and detail page |

---

## User Scenarios
### Scenario 1: Set preparation time
The cook opens the "Jollof Rice" edit page, navigates to the Settings section, and enters "45" in the preparation time field. The value saves. On the landing page, the meal card shows "Est. prep: ~45 min."

### Scenario 2: Update preparation time
The cook changes the preparation time from 45 to 30 minutes. The update saves via Gale. Toast: "Preparation time updated."

### Scenario 3: Clear preparation time
The cook clears the preparation time field and saves. The field is now empty. The "Est. prep" label no longer appears on the meal card.

### Scenario 4: Client views preparation time
A client browsing the tenant landing page sees "Est. prep: ~30 min" on the "Ndole" meal card. This helps them decide whether to order for an upcoming meal.

### Scenario 5: Invalid value
The cook enters "abc" or "-10" in the preparation time field. Validation fails: "Preparation time must be a positive number."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-270 | Estimated preparation time is optional (nullable) |
| BR-271 | Value is stored as an integer representing minutes |
| BR-272 | Minimum value: 1 minute |
| BR-273 | Maximum value: 1440 minutes (24 hours) |
| BR-274 | When set, displayed to clients as "Est. prep: ~{N} min" (or "~{N} hr" if >= 60) |
| BR-275 | When not set, no preparation time information is shown to clients |
| BR-276 | Only users with `manage-meals` permission can set/update prep time |
| BR-277 | Changes are logged via Spatie Activitylog |

---

## Data Involved
**Creates:**
- Nothing (uses existing `estimated_prep_time` field on the Meal model, defined in F-108)

**Reads:**
- Meal record to populate the field

**Updates:**
- Meal `estimated_prep_time` field

**Relationships:**
- None new; uses existing Meal model

---

## Acceptance Criteria
- **Given** a meal with no prep time, **when** the cook enters 30 and saves, **then** the field stores 30
- **Given** a meal with prep time 30, **when** viewed on the landing page, **then** "Est. prep: ~30 min" is displayed
- **Given** a meal with prep time 90, **when** viewed on the landing page, **then** "Est. prep: ~1.5 hr" is displayed
- **Given** the cook clears the field, **when** saved, **then** no prep time info is shown to clients
- **Given** an invalid value (negative or non-numeric), **when** submitted, **then** validation fails

---

## Verification Steps
1. Set preparation time to 30 — confirm it saves and displays correctly
2. Set to 90 — confirm "~1.5 hr" display format
3. Clear the field — confirm no prep time info shows on the landing page
4. Enter 0 — confirm validation error (minimum 1)
5. Enter 1441 — confirm validation error (maximum 1440)
6. Enter non-numeric value — confirm validation error
7. Check activity log for prep time changes

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Prep time set to exactly 60 | Displayed as "~1 hr" |
| Prep time set to 1 | Displayed as "~1 min" |
| Very large value (1440) | Displayed as "~24 hr" |
| Meal is draft with prep time | Prep time stored but not visible to clients until live |
| Decimal input (e.g., 30.5) | Rounded to nearest integer or validation error |

---

## UI/UX Notes
- Field in the "Settings" or "Details" section of the meal edit page
- Numeric input with "minutes" label
- Helper text: "How long does this meal typically take to prepare?"
- On meal card: small icon (clock) with "~30 min" text
- On meal detail page: displayed in the meal info section
- Display format: under 60 min shows minutes, 60+ shows hours (with fractions if needed)
- Gale-powered save
- Mobile-friendly

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-108 | Meal Creation Form | Defines the `estimated_prep_time` field on the Meal model |
| F-110 | Meal Edit | Prep time is part of the meal edit page |
| F-128 | Available Meals Grid Display | Shows prep time on meal cards |
| F-129 | Meal Detail View | Shows prep time in meal info section |
