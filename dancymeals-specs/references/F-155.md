# F-155 â€” Cook Order List View

> Module: Order Mgmt
> Priority: Must-have
> Precedence: F-076, F-151
> Type: functional

---

## What It Does
Displays a paginated list of all orders for the cook's tenant in the cook dashboard. Each row shows order ID, client name, items summary, total amount, current status, and order date. The cook can filter orders by status and date range, search by order ID or client name, and sort by date or status. Status badges are color-coded for quick visual identification. Each row has a checkbox for mass action selection (used by F-158). New orders appear in real-time via Gale SSE without requiring a page refresh.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Views and manages orders from the cook dashboard |
| Manager | Views and manages orders if granted `manage-orders` permission |

---

## User Scenarios
### Scenario 1: View all orders
The cook navigates to the Orders section in the cook dashboard. A paginated table displays all orders for their tenant, sorted by date (newest first). Each row shows the order ID, client name, a brief summary of items ordered, total in XAF, a color-coded status badge, and the order date.

### Scenario 2: Filter by status
The cook selects "Preparing" from the status filter dropdown. The table updates via Gale to show only orders with the Preparing status. The active filter is visually indicated. The cook clears the filter to see all orders again.

### Scenario 3: Filter by date range
The cook selects a date range (e.g., last 7 days). The table updates to show only orders placed within that range. Date range can be combined with status filter.

### Scenario 4: Search by order ID
The cook types an order ID (e.g., "#ORD-1234") into the search bar. The table filters to show matching orders in real-time as the cook types.

### Scenario 5: Search by client name
The cook types a client's name (e.g., "Amara") into the search bar. All orders from clients whose names match the search term are displayed.

### Scenario 6: Sort orders
The cook clicks the "Date" column header to toggle between ascending and descending sort. They can also sort by status to group orders by their current state.

### Scenario 7: New order arrives in real-time
While the cook is viewing the order list, a new order is placed and paid. The new order appears at the top of the list with a brief highlight animation via Gale SSE, without the cook needing to refresh.

### Scenario 8: Select orders for mass action
The cook checks multiple order checkboxes. A mass action toolbar appears at the top or bottom of the table, showing the count of selected orders and available bulk actions (see F-158).

### Scenario 9: Manager views orders
A manager with `manage-orders` permission navigates to the Orders section and sees the same order list view as the cook.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-155 | Orders are tenant-scoped; only orders belonging to the cook's tenant are displayed |
| BR-156 | Orders are paginated with a configurable page size (default 20 per page) |
| BR-157 | Default sort is by date descending (newest first) |
| BR-158 | Status badges use distinct colors: Pending Payment (gray), Paid (blue), Confirmed (indigo), Preparing (amber), Ready (teal), Out for Delivery (purple), Ready for Pickup (purple), Delivered (green), Picked Up (green), Completed (emerald), Cancelled (red), Refunded (orange) |
| BR-159 | Search is case-insensitive and matches partial strings for both order ID and client name |
| BR-160 | Filters (status, date range) and search can be combined simultaneously |
| BR-161 | New orders are pushed to the list in real-time via Gale SSE |
| BR-162 | Only users with `manage-orders` permission can access the order list |
| BR-163 | Items summary column shows a truncated list of meal names with quantities (e.g., "Ndole x2, Eru x1...") |
| BR-164 | All amounts are displayed in XAF format |
| BR-165 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table filtered by `tenant_id`
- `users` table for client names
- `order_items` table for items summary
- Order statuses for filter options

**Creates:**
- Nothing

**Updates:**
- Nothing

**Relationships:**
- Order belongsTo Tenant
- Order belongsTo User (client)
- Order hasMany OrderItem
- OrderItem belongsTo Meal

---

## Acceptance Criteria
- **Given** a cook on the orders page, **when** the page loads, **then** a paginated list of tenant orders is displayed sorted by date descending
- **Given** orders exist, **when** the cook selects a status filter, **then** only orders with that status are shown
- **Given** orders exist, **when** the cook enters a search term, **then** matching orders by ID or client name are displayed
- **Given** a new order is placed, **when** the cook is on the orders page, **then** the new order appears without page reload
- **Given** the cook checks multiple order checkboxes, **when** orders are selected, **then** a mass action toolbar becomes visible
- **Given** a manager without `manage-orders` permission, **when** they access the orders section, **then** they receive a 403 response

---

## Verification Steps
1. Navigate to the Orders section and confirm the order list loads with all columns
2. Verify pagination works correctly with more than 20 orders
3. Apply a status filter and confirm only matching orders are shown
4. Apply a date range filter and confirm only orders within the range are shown
5. Search by order ID and confirm matching results
6. Search by client name and confirm matching results
7. Click column headers to sort and confirm sort order changes
8. Place a new order from a client account and confirm it appears in real-time on the cook's view
9. Select multiple orders via checkboxes and confirm mass action toolbar appears
10. Test with a manager account with and without `manage-orders` permission

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| No orders exist for the tenant | Empty state with message "No orders yet" and illustration |
| Search returns no results | "No orders match your search" message with option to clear search |
| All filters active with no matches | Clear indication that filters are active with a "Clear all filters" button |
| Very long items summary | Truncated with ellipsis, full list visible in order detail |
| Order placed while filters are active | New order appears only if it matches current filters |
| Hundreds of orders | Pagination handles large datasets; search and filter are performant |

---

## UI/UX Notes
- Orders section accessible from cook dashboard sidebar under "Orders"
- Table layout on desktop; card layout on mobile
- Search bar above the table with placeholder "Search by order ID or client name"
- Filter controls: status dropdown and date range picker side by side
- Sort indicators (arrows) on sortable column headers
- Checkbox column as first column for mass selection
- "Select all on this page" checkbox in the header row
- Color-coded status badges with rounded pill design
- Clicking a row navigates to the order detail view (F-156)
- Real-time indicator (e.g., subtle pulse) on newly arrived orders
- All interactions via Gale (no page reloads)
- Toast notifications on errors

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout & Navigation | Provides the dashboard shell and sidebar navigation |
| F-151 | Payment Webhook Handling | Creates paid orders that appear in this list |
| F-156 | Cook Order Detail View | Clicking an order row navigates to this detail view |
| F-158 | Mass Order Status Update | Uses checkboxes from this list for bulk actions |
| F-191 | Order Creation Notifications | Cook receives notification when new order appears |
