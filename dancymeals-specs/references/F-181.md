# F-181 â€” Cook Testimonial Moderation

> Module: Testimonial
> Priority: Should-have
> Precedence: F-180
> Type: functional

---

## What It Does
Allows the cook to review and moderate testimonials submitted by clients. The cook sees a list of all testimonials organized by status: pending, approved, and rejected. For each pending testimonial, the cook can approve or reject it. Approved testimonials appear on the cook's tenant landing page (F-182). The cook can later un-approve (revoke) a previously approved testimonial, removing it from public display. The cook cannot edit the testimonial text.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Reviews, approves, and rejects testimonials |
| Manager | Moderates testimonials if granted `manage-testimonials` permission |

---

## User Scenarios
### Scenario 1: Approve a testimonial
The cook navigates to "Testimonials" in the dashboard. A pending testimonial from "Amara N." is shown: "I've been ordering from Chef Latifa for 6 months. Her ndole is the best in Douala!" The cook clicks "Approve." The testimonial moves to the approved list and will appear on the landing page.

### Scenario 2: Reject a testimonial
A pending testimonial contains vague text. The cook clicks "Reject." The testimonial moves to the rejected list and will not be displayed publicly.

### Scenario 3: Un-approve a testimonial
A previously approved testimonial is no longer desired on the landing page. The cook clicks "Un-approve" (or "Remove from display"). The testimonial moves back to the rejected list and is removed from the landing page.

### Scenario 4: View all testimonials
The cook sees three tabs or sections: Pending (2), Approved (5), Rejected (1). They can switch between views to manage testimonials.

### Scenario 5: No pending testimonials
The cook checks the testimonials section. "No pending testimonials" is shown. The approved list shows 3 entries.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-437 | Testimonials have three statuses: pending, approved, rejected |
| BR-438 | Only approved testimonials are displayed publicly on the landing page |
| BR-439 | The cook can approve, reject, or un-approve testimonials |
| BR-440 | The cook cannot edit testimonial text (it must remain the client's original words) |
| BR-441 | Un-approving a testimonial moves it to rejected status and removes it from the landing page |
| BR-442 | Moderation actions are logged via Spatie Activitylog |
| BR-443 | Only users with `manage-testimonials` permission can moderate testimonials |
| BR-444 | Testimonials are tenant-scoped |
| BR-445 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `testimonials` table filtered by tenant_id
- `users` table for client names

**Creates:**
- Activity log entries for moderation actions

**Updates:**
- `testimonials.status` changed to approved, rejected
- `testimonials.approved_at` or `testimonials.rejected_at` timestamps

**Relationships:**
- Testimonial belongsTo Tenant
- Testimonial belongsTo User (client)
- Approved testimonials displayed via F-182

---

## Acceptance Criteria
- **Given** pending testimonials exist, **when** the cook views the testimonials section, **then** pending testimonials are listed with approve/reject buttons
- **Given** the cook clicks "Approve," **when** the action completes, **then** the testimonial moves to the approved list
- **Given** the cook clicks "Reject," **when** the action completes, **then** the testimonial moves to the rejected list
- **Given** an approved testimonial, **when** the cook clicks "Un-approve," **then** it moves to the rejected list and is removed from the landing page
- **Given** no pending testimonials, **when** viewing the section, **then** an appropriate empty state is shown

---

## Verification Steps
1. Submit a testimonial as a client and verify it appears as pending for the cook
2. Approve the testimonial and verify it moves to the approved list
3. Check the landing page and verify the approved testimonial appears
4. Reject a testimonial and verify it moves to the rejected list
5. Un-approve a previously approved testimonial and verify it is removed from the landing page
6. Verify the cook cannot edit testimonial text
7. Check the activity log for moderation actions
8. Test with a manager with and without `manage-testimonials` permission

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client deletes their account after submitting a testimonial | Testimonial remains; client name shown as "Former User" or similar |
| Cook approves all testimonials but only 10 are displayed | Display feature (F-182) handles the limit |
| Rapid approve/reject on same testimonial | Last action wins; UI reflects current state |
| Testimonial with offensive content | Cook can reject it; no automated content moderation |
| Manager rejects, cook overrides with approve | Approve takes effect; logged in activity log |

---

## UI/UX Notes
- Accessible from cook dashboard sidebar under "Testimonials"
- Three tabs or filter sections: Pending, Approved, Rejected
- Each testimonial card shows: client name, submission date, text (possibly truncated with expand), status badge
- Approve button: green with checkmark
- Reject button: red with X
- Un-approve button: gray/outline on approved testimonials
- No edit capability (text is read-only)
- Count badges on tabs showing how many in each category
- Mobile-first card layout
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-180 | Testimonial Submission Form | Creates the testimonials moderated here |
| F-182 | Approved Testimonials Display | Displays approved testimonials on landing page |
| F-131 | Testimonials Showcase Section | Landing page section showing testimonials |
