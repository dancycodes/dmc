# F-013 â€” PWA Install Prompt

> Module: Foundation
> Priority: Must-have
> Precedence: F-012
> Type: foundation

---

## What It Does
Captures the browser's `beforeinstallprompt` event and presents a custom in-app UI element (banner or button) encouraging users to install DancyMeals as a PWA on their device. The prompt can be dismissed by the user and does not reappear aggressively. The system tracks whether the app is already installed and only shows the prompt to users who have not yet installed it. Works on both the main domain and tenant domains.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Sees and optionally acts on the install prompt |
| Cook | Sees and optionally acts on the install prompt |
| Guest | Sees the install prompt on first meaningful visit |

---

## User Scenarios
### Scenario 1: First-time visitor sees install prompt
A user visits DancyMeals for the first time on mobile Chrome. After a brief browsing period, a branded banner slides in from the bottom: "Add DancyMeals to your home screen for quick access." The user taps "Install" and the browser's native install dialog appears.

### Scenario 2: User dismisses the prompt
The user sees the install prompt but taps "Not now." The banner disappears and does not reappear for that session. On their next visit (after a configurable period), the prompt may appear again.

### Scenario 3: App already installed
A user who has already installed the PWA returns to the site. The install prompt is not shown because the system detects the app is running in standalone mode or the user has previously installed it.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-096 | The install prompt must only appear when the browser supports PWA installation |
| BR-097 | The prompt must not appear to users who have already installed the app |
| BR-098 | Dismissing the prompt suppresses it for the remainder of the session |
| BR-099 | After dismissal, the prompt may reappear on the user's next visit (configurable delay) |
| BR-100 | The prompt should appear after a meaningful interaction (not immediately on page load) |
| BR-101 | The custom UI must trigger the deferred `beforeinstallprompt` event when the user clicks "Install" |
| BR-102 | The prompt must work on both main domain and tenant domains |
| BR-103 | The prompt must be non-intrusive: a dismissible banner, not a modal or blocking overlay |

---

## Data Involved
**Creates:**
- Alpine.js component for install prompt banner
- JavaScript to capture and defer `beforeinstallprompt` event
- `localStorage` flag for dismissal tracking and install detection

**Reads:**
- `beforeinstallprompt` event from the browser
- `display-mode: standalone` media query to detect installed state
- `localStorage` for dismissal timestamp

**Updates:**
- `localStorage` with dismissal and installation flags

**Relationships:**
- Depends on F-012 for the manifest and service worker that enable installation
- Included in the base layout (F-016)

---

## Acceptance Criteria
- **Given** a supported browser and an uninstalled PWA, **when** the user has browsed for a few seconds, **then** the install prompt banner appears
- **Given** the install prompt, **when** the user clicks "Install", **then** the browser's native install dialog is triggered
- **Given** the install prompt, **when** the user clicks "Not now", **then** the banner disappears and does not reappear during the session
- **Given** the app is already installed (standalone mode), **when** loading any page, **then** the install prompt never appears
- **Given** a tenant domain, **when** the prompt appears, **then** it shows DancyMeals branding (not tenant branding)
- **Given** a browser that does not support PWA install, **when** loading the page, **then** no prompt is shown and no errors occur

---

## Verification Steps
1. Visit the site in Chrome mobile (or emulated) and confirm the install prompt appears after a delay
2. Click "Install" and verify the native browser install dialog appears
3. Dismiss the prompt and confirm it does not reappear on the same session
4. Install the PWA, then visit the site again -- confirm no prompt appears
5. Test on a browser that does not support `beforeinstallprompt` and confirm no errors
6. Visit a tenant domain and confirm the prompt appears with DancyMeals branding

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Browser does not fire `beforeinstallprompt` | No custom prompt shown; relies on browser's default behavior if any |
| User installs then uninstalls the PWA | Prompt may reappear since standalone mode is no longer detected |
| iOS Safari (no `beforeinstallprompt` support) | Show a manual instruction banner: "Tap Share > Add to Home Screen" |
| User clears `localStorage` | Dismissal flag is lost; prompt appears again on next visit |
| Multiple tabs open | Prompt appears in the active tab only (browser manages this) |

---

## UI/UX Notes
- Banner should slide in from the bottom of the screen (mobile-friendly).
- Include the DancyMeals icon, a short message, and two buttons: "Install" (primary) and "Not now" (secondary/text).
- Banner must not obstruct critical content or navigation.
- Use subtle animation for appearance and dismissal.
- Banner must be fully responsive and work on all screen sizes.
- Text must be localized: "Add DancyMeals to your home screen" / "Ajoutez DancyMeals a votre ecran d'accueil".

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-012 | PWA Configuration | Prerequisite; provides manifest and service worker |
| F-016 | Base Layout & Responsive Navigation | Parent layout where the prompt is rendered |
