# F-052 — Create Role

> Module: Admin
> Priority: Must-have
> Precedence: F-043, F-006
> Type: functional

---

## What It Does
Provides a form for creating new roles within the admin panel. Admins define a role name (in English and French), description, and guard name. Only super-admins and admins can create roles. Role names must be unique. A user cannot create a role with higher privilege than their own — this is enforced by restricting the permissions assignable to the new role.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Creates any custom role |
| Admin | Creates custom roles (cannot exceed own privilege level) |

---

## User Scenarios
### Scenario 1: Creating a custom role
A super-admin navigates to Roles > Create New Role. They enter name_en "Kitchen Assistant", name_fr "Assistant de Cuisine", description "Handles meal preparation tasks", and guard "web". They submit and the role is created. They are redirected to the role's permission assignment page (F-056).

### Scenario 2: Duplicate role name
An admin tries to create a role named "cook" which already exists. Validation rejects the submission with "A role with this name already exists."

### Scenario 3: Admin creating a high-privilege role
An admin (who has fewer permissions than super-admin) creates a role. When they later assign permissions (F-056), they can only assign permissions they themselves have. This prevents privilege escalation.

### Scenario 4: Missing required fields
An admin submits the form without filling in name_fr. Validation returns "The French name is required."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-104 | Role names must be unique across the platform (both en and fr variants) |
| BR-105 | Only users with `can-access-admin-panel` permission can create roles |
| BR-106 | The guard defaults to "web" if not specified |
| BR-107 | Both name_en and name_fr are required |
| BR-108 | Role creation is logged in the activity log |
| BR-109 | Newly created roles have zero permissions; permissions are assigned separately (F-056) |
| BR-110 | System role names (super-admin, admin, cook, manager, client) cannot be used for custom roles |

---

## Data Involved
**Creates:**
- Role record via Spatie Permission: name, guard_name
- Role metadata: name_en, name_fr, description, is_system (false for custom roles)
- Activity log entry

**Reads:**
- Existing role names for uniqueness validation
- System role names list for restriction

**Updates:**
- Nothing

**Relationships:**
- F-006: Uses Spatie Permission package for role creation
- F-056: Permissions assigned after role is created
- F-053: New role appears in role list

---

## Acceptance Criteria
- **Given** a unique role name and valid data, **when** submitting the form, **then** the role is created and the admin is redirected to permission assignment
- **Given** a duplicate role name, **when** submitting, **then** a validation error is displayed
- **Given** a system role name ("admin"), **when** submitting, **then** a validation error prevents creation
- **Given** missing name_fr, **when** submitting, **then** a validation error for the required field is shown
- **Given** successful creation, **when** checking the activity log, **then** the creation is recorded

---

## Verification Steps
1. Create a custom role with valid data — confirm it appears in the role list
2. Attempt to create a role with a duplicate name — confirm validation error
3. Attempt to use a system role name — confirm it is rejected
4. Submit without the French name — confirm validation error
5. Check activity log — confirm creation event logged

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Role name with special characters | Rejected; only letters, numbers, hyphens, and spaces allowed |
| Very long role name (>100 chars) | Rejected with max length validation error |
| Creating a role when the guard doesn't exist | Defaults to "web"; custom guards are not supported in MVP |
| Admin's own permissions change after creating role | Does not affect the role; only affects future permission assignments |

---

## UI/UX Notes
- Simple single-column form: name_en, name_fr, description, guard (pre-filled with "web")
- Guard field may be hidden for MVP (only "web" guard used)
- After creation, redirect to permission assignment page with a prompt: "Now assign permissions to this role"
- Cancel button returns to role list
- Form uses Gale for submission
- Breadcrumb: Admin > Roles > Create New Role

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-006 | Spatie Permission Setup | Provides permission infrastructure |
| F-053 | Role List View | New role appears here |
| F-054 | Edit Role | Can edit the created role |
| F-056 | Permission Assignment | Assigned after role creation |
