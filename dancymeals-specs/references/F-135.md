# F-135 â€” Meal Search Bar

> Module: Meal Search
> Priority: Must-have
> Precedence: F-128
> Type: functional

---

## What It Does
Adds a search bar to the tenant meals page that allows clients to search through the cook's available meals. Searches across meal names, descriptions, component names, and tags. Uses live search with debounce via Gale to filter the meals grid in real time without page reloads. Includes a clear search button and an empty state message when no results match.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Searches for specific meals or ingredients on the cook's site |

---

## User Scenarios
### Scenario 1: Searching by meal name
A visitor types "Ndole" in the search bar. After a brief debounce (300ms), the meals grid filters to show only meals with "Ndole" in their name. The results update reactively without page reload.

### Scenario 2: Searching by component name
A visitor types "plantain" in the search bar. Meals that contain a component named "Plantain" appear in the results, even if "plantain" is not in the meal name.

### Scenario 3: Searching by tag
A visitor types "spicy" and meals tagged with "Spicy" appear in the results.

### Scenario 4: No results
A visitor types "pizza" and no meals match. The grid shows an empty state: "No meals found for 'pizza'. Try a different search." with a suggestion to clear the search.

### Scenario 5: Clearing search
The visitor clicks the "X" clear button in the search bar. The search text is removed and the full meals grid is restored.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-214 | Search queries match against: meal name (en/fr), description (en/fr), component names, tag names |
| BR-215 | Search is case-insensitive |
| BR-216 | Search uses debounce of 300ms to avoid excessive requests |
| BR-217 | Results filter the existing meals grid via Gale (no page reload) |
| BR-218 | A clear button ("X") appears when text is entered in the search bar |
| BR-219 | Clearing search restores the full meals grid |
| BR-220 | Empty search results show a descriptive message with the search term |
| BR-221 | Search queries must be at least 2 characters to trigger a search |
| BR-222 | All text (placeholder, empty state) must be localized via `__()` |

---

## Data Involved
**Reads:**
- Meals for the tenant (names, descriptions, component names, tags)
- Search query from user input

**Creates:**
- Search bar Blade component
- Search controller endpoint

**Updates:**
- Filters the meals grid display (F-128) based on search results

**Relationships:**
- Operates on the meals displayed by F-128 (Available Meals Grid Display)
- Combinable with F-136 (Meal Filters) and F-137 (Meal Sort Options)

---

## Acceptance Criteria
- **Given** a search query "Ndole", **when** the debounce triggers, **then** only meals matching "Ndole" are shown in the grid
- **Given** a search query matching a component name, **when** results load, **then** the parent meal is shown
- **Given** a search query matching a tag, **when** results load, **then** meals with that tag are shown
- **Given** a search query with no matches, **when** results load, **then** an empty state message is displayed
- **Given** the user clicks the clear button, **when** search is cleared, **then** the full meals grid is restored
- **Given** a search query of 1 character, **when** typing, **then** no search is triggered

---

## Verification Steps
1. Type a meal name in the search bar and verify matching results appear
2. Type a component name and verify the parent meal appears
3. Type a tag name and verify tagged meals appear
4. Type a non-matching query and verify the empty state message
5. Click the clear button and verify the full grid is restored
6. Verify search is case-insensitive
7. Verify no search triggers on single character input

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Search query contains special characters | Characters are sanitized; no SQL injection or errors |
| Very long search query (100+ characters) | Query is truncated to a reasonable maximum (50 characters) |
| Rapid typing triggers multiple debounce events | Only the last debounce fires the search request |
| Search while filters are active | Results respect both search query AND active filters |
| Network timeout during search | Show error toast and retain previous results |

---

## UI/UX Notes
- Search bar positioned at the top of the meals section, below the section header
- Magnifying glass icon on the left, clear "X" button on the right (appears when text entered)
- Placeholder text: "Search meals..." (localized)
- Search bar full-width on mobile, constrained width on desktop
- Loading indicator (subtle spinner) while search request is in flight
- Results transition smoothly (fade in/out) as the grid updates

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-128 | Available Meals Grid Display | Grid that is filtered by search results |
| F-136 | Meal Filters | Combinable with search |
| F-137 | Meal Sort Options | Combinable with search |
