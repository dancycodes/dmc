# F-180 — Testimonial Submission Form

> Module: Testimonial
> Priority: Should-have
> Precedence: F-024, F-076
> Type: functional

---

## What It Does
Allows authenticated clients who have completed at least one order with a cook to submit a testimonial (separate from order ratings/reviews). The form is accessible on the cook's tenant landing page. Testimonials are longer-form endorsements of the cook's service. Each client can submit one testimonial per cook. Submitted testimonials go to the cook for approval before being displayed publicly (F-181). The form includes a text field for the testimonial content (max 1,000 characters).

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Submits a testimonial for a cook they have ordered from |

---

## User Scenarios
### Scenario 1: Submit a testimonial
The client visits Chef Latifa's landing page. They have completed 3 orders with Latifa. A "Share Your Experience" button appears. They click it and a form opens with a text area. They write: "I've been ordering from Chef Latifa for 6 months. Her ndole is the best in Douala! Always on time, always fresh. Highly recommended!" They submit. A success message shows: "Thank you! Your testimonial has been submitted for review."

### Scenario 2: Ineligible client (no orders)
A new client visits a cook's landing page. They have never ordered from this cook. The "Share Your Experience" button is not visible, or it shows a tooltip: "Complete an order to share your experience."

### Scenario 3: Client already submitted a testimonial
The client has already submitted a testimonial for this cook. Instead of the submission form, they see: "You've already shared your experience with this cook." Their submitted testimonial text is shown (regardless of approval status).

### Scenario 4: Unauthenticated visitor
A guest visitor sees the testimonials section but the submission CTA says "Log in to share your experience." Clicking it redirects to the login page.

### Scenario 5: Testimonial exceeds character limit
The client types more than 1,000 characters. A counter shows the excess in red. The submit button is disabled until within the limit.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-426 | Only authenticated clients who have completed at least 1 order with this cook can submit a testimonial |
| BR-427 | Each client can submit one testimonial per cook (per tenant) |
| BR-428 | Testimonial text is required and has a maximum of 1,000 characters |
| BR-429 | Submitted testimonials are not immediately public; they require cook approval (F-181) |
| BR-430 | A submitted testimonial cannot be edited by the client after submission |
| BR-431 | The submission form is available on the cook's tenant landing page |
| BR-432 | Unauthenticated users see a prompt to log in |
| BR-433 | Ineligible clients (no completed orders) see the CTA but it is disabled with an explanation |
| BR-434 | Testimonial submission notifies the cook (push + DB) |
| BR-435 | Submission is logged via Spatie Activitylog |
| BR-436 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- `orders` table to verify the client has completed orders with this cook
- `testimonials` table to check if the client has already submitted one for this cook
- Authentication status

**Creates:**
- `testimonials` record: tenant_id, user_id (client), text, status (pending), created_at
- Cook notification (push + DB)
- Activity log entry

**Updates:**
- Nothing

**Relationships:**
- Testimonial belongsTo User (client)
- Testimonial belongsTo Tenant
- Testimonial triggers moderation flow (F-181)

---

## Acceptance Criteria
- **Given** an authenticated client with completed orders, **when** they visit the cook's landing page, **then** the testimonial submission CTA is visible and enabled
- **Given** the client writes a testimonial and submits, **when** saved, **then** a success message is shown and the cook is notified
- **Given** a client who has already submitted, **when** visiting the page, **then** they see their existing testimonial instead of the form
- **Given** an unauthenticated visitor, **when** viewing the page, **then** the CTA prompts them to log in
- **Given** a client with no completed orders, **when** viewing the page, **then** the CTA is disabled with an explanation
- **Given** text exceeding 1,000 characters, **when** typing, **then** the submit button is disabled

---

## Verification Steps
1. Log in as a client with completed orders and submit a testimonial
2. Verify the testimonial is saved with "pending" status
3. Verify the cook receives a notification
4. Revisit the page and verify the existing testimonial is shown (no re-submission)
5. Test with a client who has no orders — verify the CTA is disabled
6. Test as an unauthenticated user — verify the login prompt
7. Type more than 1,000 characters — verify the limit enforcement

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Client's only completed order was cancelled then refunded | Refunded orders do not count as "completed"; client is ineligible |
| Client submits testimonial for a deactivated cook's tenant | Submission allowed if the client can access the landing page |
| Concurrent submission attempts | First succeeds; second shows "already submitted" |
| Cook has the testimonial feature disabled | Not applicable; testimonial feature is platform-level (Should-have) |
| Testimonial text contains only whitespace | Validation error: "Testimonial text is required" |

---

## UI/UX Notes
- "Share Your Experience" button or CTA in the testimonials section of the tenant landing page
- Clicking opens a modal or inline form with a large text area
- Character counter: "0/1000"
- "Submit Testimonial" button
- Success state: modal closes, success toast
- Disabled state: grayed out button with tooltip explaining why
- Login prompt: "Log in to share your experience" link
- Mobile-first: full-width text area in modal
- All interactions via Gale (no page reloads)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-024 | User Login | Authentication required for submission |
| F-076 | Cook Dashboard Layout & Navigation | Cook receives notification in dashboard |
| F-181 | Cook Testimonial Moderation | Cook reviews submitted testimonials |
| F-182 | Approved Testimonials Display | Approved testimonials shown on landing page |
| F-131 | Testimonials Showcase Section | Testimonials section on tenant landing page |
