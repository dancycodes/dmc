# F-082 — Add Town

> Module: Location
> Priority: Must-have
> Precedence: F-076
> Type: functional

---

## What It Does

Allows a cook to add a town they deliver to from the Locations section of the cook dashboard. The cook enters the town name in both English and French. The town name is validated for uniqueness within this cook's existing towns. The town is saved via Gale and appears immediately in the town list without page reload.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Adds new delivery towns to their service area |
| Manager | Adds towns if granted location management permission |

---

## User Scenarios

### Scenario 1: Add a town
A cook navigates to Locations in the dashboard. They click "Add Town." A form or modal appears with fields for town name in English and French. They enter "Douala" (en) and "Douala" (fr), click "Save." The town appears in the town list instantly.

### Scenario 2: Add a town with different en/fr names
A cook adds a town: English "Yaounde", French "Yaoundé". Both names are saved and displayed based on the user's current locale.

### Scenario 3: Duplicate town name
A cook already has "Douala" and tries to add "Douala" again. A validation error appears: "You already have a town with this name."

### Scenario 4: Validation errors
A cook submits the form with only the English name filled in. A validation error appears: "Town name is required in both English and French."

---

## Business Rules

| Code | Rule |
|------|------|
| BR-207 | Town name is required in both English (`name_en`) and French (`name_fr`) |
| BR-208 | Town name must be unique within this cook's towns (checked per language) |
| BR-209 | Town is scoped to the current tenant (tenant_id) |
| BR-210 | Save via Gale; town appears in the list without page reload |
| BR-211 | All validation messages must use `__()` localization |
| BR-212 | Only users with location management permission can add towns |

---

## Data Involved

**Creates:**
- Town record: id, tenant_id, name_en, name_fr, created_at, updated_at

**Reads:**
- Existing towns for this tenant (uniqueness check)

**Updates:**
- Town list UI (via Gale)

---

## Acceptance Criteria

- **Given** the add town form, **when** the cook enters valid names (en/fr) and saves, **then** the town is created and appears in the list
- **Given** a duplicate town name, **when** submitting, **then** a uniqueness validation error is shown
- **Given** only one language name provided, **when** submitting, **then** a validation error requires both languages
- **Given** a successful save, **when** viewing the town list, **then** the new town appears without page reload
- **Given** a manager without location permission, **when** they try to add a town, **then** the action is blocked (403)

---

## Verification Steps

1. Add a town with both en/fr names and confirm it appears in the list
2. Attempt to add a duplicate town name and confirm validation error
3. Submit with only English name and confirm validation error
4. Verify no page reload occurred during save
5. Check the database to confirm tenant_id is set correctly

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Town name with accents (é, ô) | Accepted and stored correctly |
| Town name with leading/trailing spaces | Trimmed before storage and uniqueness check |
| Very long town name (>255 chars) | Rejected with max length validation error |
| Two cooks add the same town name | Allowed; uniqueness is per-tenant, not global |

---

## UI/UX Notes

- "Add Town" button at the top of the locations page
- Form can be inline (expandable section) or a modal/dialog
- Two text fields side by side: English name, French name
- "Save" and "Cancel" buttons
- Success: town fades into the list; toast notification
- Error: inline validation messages below fields
- Breadcrumb: Dashboard > Locations > Add Town

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-076 | Cook Dashboard Layout | Parent dashboard |
| F-083 | Town List View | Displays the added town |
| F-084 | Edit Town | Edit the town after creation |
| F-086 | Add Quarter | Add quarters within the town |
