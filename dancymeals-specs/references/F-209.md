# F-209 â€” Cook Creates Manager Role

> Module: Manager
> Priority: Must-have
> Precedence: F-076, F-006
> Type: functional

---

## What It Does
Allows a cook to invite existing DancyMeals users to become managers of their tenant. The cook navigates to the "Team" section of their dashboard, enters the email of an existing DancyMeals user, and sends an invitation. The invited user receives the "manager" role scoped to this tenant. The cook can invite multiple managers. Only users who already have a DancyMeals account can be invited. The Team section displays a list of all current managers for the tenant with their name, email, and date added. The cook can remove a manager at any time, which revokes the manager role for this tenant only. All invitation and removal actions are logged via Spatie Activitylog.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Invites existing users as managers; views and removes managers |
| Manager | Appears in the manager list; receives/loses the manager role |
| Admin | Can view manager assignments in admin panel |
| Client | No interaction |

---

## User Scenarios
### Scenario 1: Cook invites a manager
The cook opens the Team section, enters an email address of an existing DancyMeals user. The system validates the email belongs to an existing account, assigns the manager role for this tenant, and the new manager appears in the list. The invited user receives a notification (F-185).

### Scenario 2: Cook invites multiple managers
The cook adds three managers over time. The Team section lists all three with name, email, date added, and a remove button for each.

### Scenario 3: Cook removes a manager
The cook clicks "Remove" next to a manager's name. A confirmation dialog appears. Upon confirmation, the manager role for this tenant is revoked. The user retains their DancyMeals account and any other roles.

### Scenario 4: Cook invites a non-existent email
The cook enters an email that does not belong to any DancyMeals account. An error message appears: "No DancyMeals account found with this email. The user must register first."

### Scenario 5: Cook invites someone who is already a manager
The cook enters the email of a user who already has the manager role for this tenant. An error message appears: "This user is already a manager for your team."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-462 | Only users with the cook role for the current tenant can invite managers |
| BR-463 | Only existing DancyMeals users (by email) can be invited as managers |
| BR-464 | The invited user receives the "manager" role scoped to the current tenant |
| BR-465 | A cook can invite an unlimited number of managers |
| BR-466 | Removing a manager revokes the manager role for this tenant only; other roles and data are unaffected |
| BR-467 | A user cannot be invited as a manager if they already hold the manager role for this tenant |
| BR-468 | A user cannot be invited as a manager if they are the cook of this tenant |
| BR-469 | The manager list displays: name, email, date added, and a remove action |
| BR-470 | All invitation and removal actions are logged via Spatie Activitylog |
| BR-471 | All user-facing text must use `__()` localization |
| BR-472 | Gale handles all interactions without page reloads |

---

## Data Involved
**Creates:**
- Manager role assignment (Spatie `model_has_roles` pivot with tenant scope)
- Activity log entries for invitation and removal

**Reads:**
- Users table (lookup by email)
- Current tenant's existing managers
- Role definitions from Spatie

**Updates:**
- `model_has_roles` pivot table (add/remove manager role)

**Relationships:**
- User belongsToMany Roles (Spatie, scoped to tenant)
- Tenant hasMany Managers (through role pivot)

---

## Acceptance Criteria
- **Given** a cook on their dashboard, **when** they enter a valid existing user email and click invite, **then** that user receives the manager role for this tenant
- **Given** a cook, **when** they view the Team section, **then** all current managers are listed with name, email, and date added
- **Given** a cook, **when** they remove a manager, **then** the manager role for this tenant is revoked and the user disappears from the list
- **Given** a non-existent email, **when** the cook attempts to invite, **then** an error message is shown
- **Given** a user who is already a manager, **when** the cook attempts to invite them again, **then** a duplicate error is shown
- **Given** the cook themselves, **when** attempting to invite their own email, **then** an error is shown

---

## Verification Steps
1. Log in as cook, navigate to Team section, invite a valid user by email -- confirm they appear in the list
2. Verify the invited user now has the manager role for this tenant
3. Remove the manager -- confirm they disappear from the list and the role is revoked
4. Attempt to invite a non-existent email -- confirm error message
5. Attempt to invite an already-added manager -- confirm duplicate error
6. Check activity log for invitation and removal entries
7. Verify the page updates via Gale without reloads
8. Switch language to French -- confirm all labels are translated

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Invited user is a cook on another tenant | Allowed; a user can be a cook on one tenant and manager on another |
| Invited user is an admin | Allowed; admin can also hold manager role on a tenant |
| Cook removes their only manager | Allowed; cook can operate without managers |
| Manager removal while manager is logged in | Manager's next request re-evaluates permissions; dashboard access is revoked |
| Email entered with different casing | Case-insensitive lookup |
| Tenant is deactivated | Team section is still accessible to the cook but new invitations are blocked |

---

## UI/UX Notes
- Team section accessible from the cook dashboard sidebar under "Managers" or "Team"
- Invite form: single email input field with an "Invite" button
- Manager list: table/card layout with avatar, name, email, date added, and remove button
- Remove action triggers a confirmation dialog: "Remove [Name] as manager? They will lose access to your dashboard."
- Success toast after invitation: "[Name] has been added as a manager"
- Success toast after removal: "[Name] has been removed"
- Empty state when no managers: "You haven't added any team members yet. Invite someone to help manage your business."
- All interactions via Gale (no page reloads)
- Mobile-first responsive layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-006 | Role & Permission Seed Setup | Provides the manager role definition |
| F-076 | Cook Dashboard Layout & Navigation | Dashboard where Team section lives |
| F-210 | Manager Permission Configuration | Next step: configure what each manager can do |
| F-211 | Manager Dashboard Access | Manager uses their role to access the dashboard |
| F-185 | Notification System | Sends notification to the invited user |
