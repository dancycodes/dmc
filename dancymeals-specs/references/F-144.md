# F-144 â€” Minimum Order Amount Validation

> Module: Ordering
> Priority: Must-have
> Precedence: F-139, F-213
> Type: edge-case

---

## What It Does
Validates that the cart subtotal meets the cook's minimum order amount before allowing the client to proceed to checkout. If the cook has configured a minimum order amount and the cart subtotal (food items only, before delivery fee) falls below it, the client sees a clear message indicating how much more they need to add. The checkout button is disabled until the minimum is met. This validation runs whenever the cart is viewed or modified.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client (authenticated) | Sees validation message if their cart is below the minimum order amount |
| Cook | Configures the minimum order amount from their dashboard (via F-213) |

---

## User Scenarios
### Scenario 1: Cart meets minimum
The cook's minimum order is 1,000 XAF. The client's cart subtotal is 3,500 XAF. The checkout button is enabled. No minimum order message is shown.

### Scenario 2: Cart below minimum
The cook's minimum order is 2,000 XAF. The client's cart subtotal is 1,200 XAF. A message displays: "Minimum order is 2,000 XAF. Add 800 XAF more to proceed." The "Proceed to Checkout" button is disabled.

### Scenario 3: Cart reaches minimum after adding items
The client adds more items. The cart subtotal rises to 2,500 XAF. The validation message disappears and the checkout button becomes enabled.

### Scenario 4: No minimum configured
The cook has not set a minimum order amount (or set it to 0). No validation is applied. The client can proceed with any cart amount.

### Scenario 5: Delivery fee not counted
The cook's minimum is 2,000 XAF. The cart subtotal is 1,800 XAF, but delivery fee is 500 XAF. Total would be 2,300 XAF but the minimum check uses only the food subtotal (1,800 XAF), so the message still shows: "Add 200 XAF more to proceed."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-299 | Minimum order amount is configured per cook (via F-213 in cook settings) |
| BR-300 | Minimum is calculated against food item subtotal only (before delivery fee, before discounts) |
| BR-301 | If cart subtotal < minimum, display: "Minimum order is {minimum} XAF. Add {remaining} XAF more to proceed." |
| BR-302 | "Proceed to Checkout" button is disabled when minimum is not met |
| BR-303 | Validation runs on cart view, on quantity change, and on item removal |
| BR-304 | If no minimum is configured (null or 0), validation is skipped |
| BR-305 | The minimum order message must be localized via `__()` |
| BR-306 | Remaining amount is calculated as: minimum - cart subtotal |

---

## Data Involved
**Reads:**
- Cook's minimum order amount (from tenant settings or cook configuration)
- Cart subtotal (food items only)

**Creates:**
- Nothing

**Updates:**
- Checkout button enabled/disabled state

**Relationships:**
- Validates F-139 (Order Cart Management) subtotal
- Minimum configured in F-213 (Cook Settings)
- Gate for proceeding to F-140 (Delivery/Pickup Choice Selection)

---

## Acceptance Criteria
- **Given** cart subtotal of 1,200 XAF and minimum of 2,000 XAF, **when** viewing the cart, **then** the message "Add 800 XAF more to proceed" is shown and checkout is disabled
- **Given** cart subtotal of 2,500 XAF and minimum of 2,000 XAF, **when** viewing the cart, **then** no minimum message is shown and checkout is enabled
- **Given** no minimum configured, **when** viewing the cart, **then** no validation message appears
- **Given** a cart below minimum, **when** adding items to meet the minimum, **then** the message disappears and checkout enables reactively
- **Given** delivery fee brings total above minimum but subtotal is below, **when** viewing, **then** the minimum message still shows (delivery fee not counted)

---

## Verification Steps
1. Configure a cook with a 2,000 XAF minimum order
2. Add items totaling 1,500 XAF; verify the minimum message and disabled checkout
3. Add more items to reach 2,000 XAF; verify the message disappears and checkout enables
4. Test with no minimum configured; verify no message appears
5. Verify the remaining amount calculation is correct
6. Verify delivery fee is not included in the minimum calculation

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Minimum order amount is exactly equal to cart subtotal | Minimum is met; checkout enabled |
| Cook changes minimum while client has cart open | Next validation check uses the new minimum |
| Cart subtotal is 0 (all items removed) | Empty cart state; minimum message not shown (empty state message instead) |
| Minimum amount is 1 XAF (practically zero) | Technically validated; any item meets it |
| Very high minimum (e.g., 100,000 XAF) | Message shows correctly with large numbers |

---

## UI/UX Notes
- Minimum order message displayed prominently above or below the cart subtotal
- Message in amber/warning color with an info icon
- Shows both the minimum amount and the remaining amount needed
- Checkout button visually dimmed/disabled with a tooltip explaining why
- Message updates reactively as cart changes (via Gale)
- On mobile, message is displayed as a banner above the sticky checkout bar

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-139 | Order Cart Management | Cart subtotal validated by this feature |
| F-213 | Cook Settings | Source of minimum order amount configuration |
| F-140 | Delivery/Pickup Choice Selection | Blocked until minimum is met |
