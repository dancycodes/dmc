# F-103 — Edit Schedule Template

> Module: Schedule
> Priority: Must-have
> Precedence: F-102
> Type: functional

---

## What It Does
Allows a cook to edit an existing schedule template's name and time intervals (order, delivery, pickup). Changes to a template do NOT automatically propagate to day schedules that were previously created using this template. Those schedules retain the values they had when the template was applied. To update existing day schedules with the new template values, the cook must re-apply the template via F-105. Edits are saved via Gale with a success toast.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Edits schedule template name and time intervals |
| Manager | Edits templates if granted `manage-schedules` permission |

---

## User Scenarios
### Scenario 1: Edit template name
The cook renames "Lunch Service" to "Weekday Lunch." The name updates and the template list reflects the change.

### Scenario 2: Adjust order interval
The cook changes the order interval start from 6:00 PM day before to 7:00 PM day before. The change saves. Day schedules previously using this template still show 6:00 PM.

### Scenario 3: Enable pickup on a delivery-only template
The cook adds a pickup window (10:30 AM to 2:30 PM) to a template that previously only had delivery. The template now shows both intervals.

### Scenario 4: Disable delivery
The cook disables delivery on a template that has both delivery and pickup. Only pickup remains enabled.

### Scenario 5: Attempted invalid edit
The cook changes the order end time to be after the delivery start time. Validation fails with a clear error message.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-140 | All validation rules from F-099 and F-100 apply to template edits |
| BR-141 | Template name must remain unique within the tenant |
| BR-142 | Editing a template does NOT propagate changes to day schedules already using it |
| BR-143 | To update day schedules with new template values, the cook must re-apply via F-105 |
| BR-144 | Template edits are logged via Spatie Activitylog |
| BR-145 | Only users with `manage-schedules` permission can edit templates |

---

## Data Involved
**Creates:**
- Nothing

**Reads:**
- ScheduleTemplate record to populate the edit form
- Other templates for name uniqueness validation

**Updates:**
- ScheduleTemplate record with new values

**Relationships:**
- ScheduleTemplate belongsTo Tenant
- Day schedules with `template_id` reference are NOT updated

---

## Acceptance Criteria
- **Given** a template, **when** the cook edits the name and saves, **then** the new name appears in the template list
- **Given** a template applied to 3 days, **when** the cook edits the template's order interval, **then** those 3 day schedules retain their original values
- **Given** a name that conflicts with another template, **when** submitted, **then** validation fails
- **Given** an invalid interval configuration, **when** submitted, **then** validation fails with specific error messages
- **Given** a successful edit, **when** checking the activity log, **then** the change is recorded

---

## Verification Steps
1. Edit a template name and verify it updates in the list
2. Edit order interval and verify day schedules are unchanged
3. Add pickup to a delivery-only template and verify both intervals show
4. Remove delivery from a template and verify only pickup remains
5. Try to set a duplicate name — confirm validation error
6. Try to set invalid intervals — confirm validation errors
7. Check activity log for the edit entry

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Edit to exact same values | No error; save succeeds (no-op update) |
| Template being edited while another user applies it | Apply uses the template values at the moment of application |
| All fields cleared | Validation prevents saving — required fields enforced |

---

## UI/UX Notes
- Same form layout as template creation (F-101) but pre-populated with existing values
- Banner or note at the top: "Changes will not affect schedules already using this template. Re-apply to update them."
- Save and Cancel buttons
- Gale-powered form submission
- Toast on success
- Mobile-friendly stacked layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-101 | Create Schedule Template | Same form structure |
| F-102 | Schedule Template List View | Returns to list after save |
| F-105 | Schedule Template Application to Days | Re-apply to propagate changes |
