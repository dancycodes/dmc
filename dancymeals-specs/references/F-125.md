# F-125 — Meal Component List View

> Module: Meal Component
> Priority: Must-have
> Precedence: F-118
> Type: functional

---

## What It Does
Displays all components within a meal in the cook dashboard. Each component shows its name (in the user's preferred language), price (formatted in XAF), selling unit, availability status, quantity settings (min/max/available), and a requirement rules indicator. Components can be reordered via drag-and-drop to control display order on the client-facing pages. Quick availability toggles are available on each component. The list provides links to edit and delete each component. Rendered via Gale within the meal edit page.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Cook | Views, reorders, and manages components within a meal |
| Manager | Manages components if granted `manage-meals` permission |

---

## User Scenarios
### Scenario 1: View component list
The cook opens the "Ndole Meal" edit page and navigates to the Components section. Three components are listed: "Ndole + Plantain" (1,000 XAF/plate, available, no rules), "Ndole + Rice" (1,200 XAF/plate, available, no rules), and "Extra Plantain" (300 XAF/piece, available, has rules).

### Scenario 2: Reorder components
The cook drags "Ndole + Rice" above "Ndole + Plantain." The order updates via Gale. On the tenant landing page, "Ndole + Rice" now appears first.

### Scenario 3: Quick toggle availability
The cook clicks the availability toggle on "Extra Plantain" to mark it as sold out. The toggle updates inline.

### Scenario 4: Identify components with rules
The "Extra Plantain" component shows a small icon (chain link or dependency indicator) signaling it has requirement rules. The cook can click to view/edit the rules.

### Scenario 5: Navigate to edit
The cook clicks the edit button on "Ndole + Plantain" to open its edit form.

### Scenario 6: Navigate to delete
The cook clicks the delete button on "Extra Plantain." A confirmation dialog appears (F-120).

### Scenario 7: Empty component list
A newly created meal has no components. The list shows an empty state: "No components yet. Add your first component." with an "Add Component" button.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-348 | Component list is scoped to the current meal |
| BR-349 | Components are displayed in position order (determined by drag-and-drop) |
| BR-350 | Drag-and-drop reordering updates the `position` field on all affected components |
| BR-351 | The component list displays: name, price (XAF), unit, availability, quantities, rules indicator |
| BR-352 | Quick availability toggle follows the same rules as F-123 |
| BR-353 | Only users with `manage-meals` permission can view and manage the component list |
| BR-354 | Position changes are persisted immediately via Gale |

---

## Data Involved
**Creates:**
- Nothing (read-only view with inline toggles and reordering)

**Reads:**
- MealComponents for the current meal, ordered by position
- SellingUnit names for display
- ComponentRequirementRules (for indicator)
- Quantity settings (min/max/available)

**Updates:**
- MealComponent `position` fields on reorder
- MealComponent `is_available` via quick toggle

**Relationships:**
- MealComponent belongsTo Meal
- MealComponent belongsTo SellingUnit
- MealComponent hasMany ComponentRequirementRules

---

## Acceptance Criteria
- **Given** a meal with 3 components, **when** viewing the component list, **then** all 3 are displayed in position order
- **Given** the cook drags a component to a new position, **when** released, **then** the order updates and persists
- **Given** a component with requirement rules, **when** viewing the list, **then** a rules indicator icon is shown
- **Given** the availability toggle clicked, **when** processing, **then** the component's availability updates inline
- **Given** a meal with no components, **when** viewing the list, **then** an empty state is shown
- **Given** each component, **when** displayed, **then** it shows name, price, unit, availability, and quantity info

---

## Verification Steps
1. View a meal's component list — confirm all components display with correct data
2. Reorder components via drag-and-drop — confirm new order persists and shows on client pages
3. Identify a component with rules — confirm indicator is present
4. Quick toggle availability — confirm inline update
5. Click edit on a component — confirm navigation to edit form
6. Click delete on a component — confirm confirmation dialog appears
7. View empty component list — confirm empty state with CTA

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Single component in list | Drag handle present but no other target; reordering is a no-op |
| Many components (10+) | Scrollable list within the section |
| Very long component name | Truncated with ellipsis |
| Component with available quantity 0 | Shows "Sold Out" badge and 0 stock indicator |
| Component with unlimited quantities | Shows "Unlimited" instead of a number |
| Price formatting | Displayed with thousand separators (e.g., "1,000 XAF") |

---

## UI/UX Notes
- Component list within the meal edit page as a dedicated section/tab
- Card-based layout with drag handles on the left
- Each card shows:
  - Component name (in user's preferred language)
  - Price with "XAF" suffix (e.g., "1,000 XAF / plate")
  - Selling unit
  - Availability toggle (green/red switch)
  - Quantity badges: "Min: 0 | Max: Unlimited | Stock: 15"
  - Rules indicator icon (if rules exist)
  - Edit and Delete action buttons
- "Add Component" button at the top or bottom of the list
- Drag-and-drop with visual feedback (item lifts, placeholder shown)
- Mobile: drag via long-press or dedicated drag handle
- All interactions via Gale
- Responsive layout

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-118 | Meal Component Creation | "Add Component" button triggers creation |
| F-119 | Meal Component Edit | Edit button opens edit form |
| F-120 | Meal Component Delete | Delete button triggers deletion |
| F-122 | Meal Component Requirement Rules | Rules indicator shown per component |
| F-123 | Meal Component Availability Toggle | Quick toggle on each component |
| F-124 | Meal Component Quantity Settings | Quantity info displayed per component |
| F-129 | Meal Detail View | Client sees components in this display order |
