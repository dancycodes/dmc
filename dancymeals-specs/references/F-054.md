# F-054 — Edit Role

> Module: Admin
> Priority: Must-have
> Precedence: F-053
> Type: functional

---

## What It Does
Allows admins to edit a role's name and description. System role names cannot be changed (only their descriptions can be updated). Custom role names can be fully edited. Permission modification is handled separately via F-056 (Permission Assignment to Roles). All changes are logged in the activity log.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Edits any role's name and description |
| Admin | Edits custom roles' names and descriptions |

---

## User Scenarios
### Scenario 1: Editing a custom role's name
An admin navigates to the "Kitchen Assistant" role. They update name_en to "Prep Cook" and name_fr to "Cuisinier Preparateur". They save and the role list reflects the updated name.

### Scenario 2: Updating a system role's description
A super-admin opens the "cook" system role. The name fields are disabled/read-only. They update the description to "Manages meals, orders, and tenant settings". They save successfully.

### Scenario 3: Name conflict on edit
An admin renames a custom role to "cook", which matches a system role name. Validation rejects: "A role with this name already exists."

### Scenario 4: Viewing current permissions
On the edit page, the admin sees a read-only summary of currently assigned permissions (grouped by module). A "Manage Permissions" link navigates to the permission assignment page (F-056).

---

## Business Rules
| Code | Rule |
|------|------|
| BR-116 | System role names (en and fr) cannot be changed |
| BR-117 | System role descriptions can be updated |
| BR-118 | Custom role names can be changed but must remain unique |
| BR-119 | Role name uniqueness check excludes the current role's own name |
| BR-120 | All edits are logged in the activity log with the admin as causer |
| BR-121 | Permission modifications are not done on this page — redirected to F-056 |

---

## Data Involved
**Reads:**
- Role record: name_en, name_fr, description, is_system, guard_name
- Current permissions for display (read-only summary)
- Other role names for uniqueness validation

**Creates:**
- Activity log entry on change

**Updates:**
- Role metadata: name_en, name_fr, description

**Relationships:**
- F-053: Navigated from role list; returns to it after save
- F-056: Permission management linked from this page

---

## Acceptance Criteria
- **Given** a custom role, **when** editing its name and saving, **then** the updated name is reflected in the role list
- **Given** a system role, **when** viewing the edit page, **then** name fields are read-only
- **Given** a system role, **when** updating only the description and saving, **then** the description is updated
- **Given** a name conflict, **when** saving, **then** a validation error is displayed
- **Given** a successful edit, **when** checking the activity log, **then** the change is recorded

---

## Verification Steps
1. Edit a custom role's name — confirm it updates in the role list
2. Attempt to edit a system role's name — confirm fields are disabled
3. Update a system role's description — confirm it saves successfully
4. Rename a custom role to an existing name — confirm validation error
5. Check activity log — confirm edit is recorded

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Admin edits a role but makes no changes | No activity log entry; success toast still shown |
| Role name changed while users are assigned to it | Users retain the role; name change is cosmetic |
| Admin without permission to edit system roles attempts to | Edit page shows read-only view for system roles |
| Two admins editing the same role simultaneously | Last save wins |

---

## UI/UX Notes
- Form pre-filled with current role data
- System role name fields visually disabled (grayed out) with a note: "System role names cannot be changed"
- Description field uses a textarea
- Read-only permissions summary below the form, grouped by module (e.g., "Meals: view, create, edit" / "Orders: view, manage")
- "Manage Permissions" button links to F-056
- Save and Cancel buttons at the bottom
- Breadcrumb: Admin > Roles > Kitchen Assistant > Edit

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-053 | Role List View | Parent navigation |
| F-056 | Permission Assignment | Linked for permission management |
| F-055 | Delete Role | Delete option accessible from this page (custom roles only) |
