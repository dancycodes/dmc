# F-177 — Order Review Text Submission

> Module: Rating
> Priority: Must-have
> Precedence: F-176
> Type: functional

---

## What It Does
Provides an optional text review field alongside the star rating (F-176). After selecting their star rating, the client can write a text review (maximum 500 characters) describing their experience. The review is submitted together with the rating. Both are published together and cannot be edited after submission. Reviews are displayed alongside the rating on the meal detail view (F-178).

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Client | Writes an optional text review for a completed order |

---

## User Scenarios
### Scenario 1: Submit rating with review
The client selects 5 stars and types: "Amazing ndole! Perfectly seasoned and generous portions. Will order again!" They click "Submit Rating." Both the 5-star rating and the review text are saved together.

### Scenario 2: Submit rating without review
The client selects 4 stars but leaves the review text field empty. They click "Submit Rating." The rating is saved without a review text. This is valid.

### Scenario 3: Review exceeds character limit
The client types a review that exceeds 500 characters. A counter shows "512/500" in red. The submit button is disabled until the text is within the limit.

### Scenario 4: View submitted review
The client revisits the completed order. They see their submitted rating (4 stars) and review text displayed as read-only. No edit or delete option.

### Scenario 5: Review displayed on meal page
A visitor views the meal's detail page (F-178). The client's review appears: "Amara N. — 5 stars — Amazing ndole! Perfectly seasoned and generous portions. Will order again! — Feb 10, 2026."

---

## Business Rules
| Code | Rule |
|------|------|
| BR-399 | The review text field is optional; a rating can be submitted without text |
| BR-400 | Maximum review length is 500 characters |
| BR-401 | The review is submitted simultaneously with the star rating |
| BR-402 | Once submitted, the review text cannot be edited or deleted by the client |
| BR-403 | The review is associated with the rating, order, client, and meal(s) |
| BR-404 | Reviews are displayed publicly on the meal detail view (F-178) |
| BR-405 | Client name is shown with the review (first name + last initial, e.g., "Amara N.") |
| BR-406 | Review text is sanitized to prevent XSS (Blade escaping) |
| BR-407 | All user-facing text must use `__()` localization |

---

## Data Involved
**Reads:**
- Rating record to check if review can be added (submitted together)

**Creates:**
- `ratings.review_text` field (or separate reviews table linked to rating)

**Updates:**
- Nothing (created simultaneously with rating)

**Relationships:**
- Review text is a field on the Rating model (or a separate Review model linked 1:1)
- Rating belongsTo Order
- Rating belongsTo User (client)

---

## Acceptance Criteria
- **Given** the client has selected a star rating, **when** they type a review and submit, **then** both the rating and review are saved
- **Given** the client submits without review text, **when** saving, **then** the rating is saved with null/empty review text
- **Given** the review exceeds 500 characters, **when** typing, **then** the character counter shows the excess and submit is disabled
- **Given** a submitted review, **when** revisiting the order, **then** the review text is displayed as read-only
- **Given** a submitted review, **when** viewing the meal detail page, **then** the review appears with the client's name and date

---

## Verification Steps
1. Submit a rating with review text and verify both are saved
2. Submit a rating without review text and verify it succeeds
3. Type more than 500 characters and verify the counter and submit button behavior
4. Revisit the order and verify the review is read-only
5. View the meal detail page and verify the review appears

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Review contains only whitespace | Treated as empty (no review text saved) |
| Review contains special characters or emojis | Accepted and displayed correctly (Blade escaping handles XSS) |
| Review contains offensive language | Currently no content moderation; future enhancement could add filtering |
| Multiple meals in one order | Review covers the overall order experience; displayed on each meal's page |

---

## UI/UX Notes
- Text area below the star selector with placeholder: "Share your experience (optional)"
- Character counter in the bottom-right corner: "0/500"
- Counter turns red when approaching or exceeding the limit
- "Submit Rating" button submits both stars and review
- After submission: review text displayed as a read-only paragraph below the stars
- On meal detail page: review shown in a card with client name, stars, text, and date
- Mobile: full-width text area, easy to type on

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-176 | Order Rating Prompt | Review is submitted alongside the star rating |
| F-178 | Rating & Review Display on Meal | Reviews are displayed on the meal page |
| F-179 | Cook Overall Rating Calculation | Ratings (not reviews) contribute to the score |
