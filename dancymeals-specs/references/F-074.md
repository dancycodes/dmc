# F-074 — Delivery Areas Step

> Module: Cook Onboarding
> Priority: Must-have
> Precedence: F-071
> Type: functional

---

## What It Does

Wizard Step 3. Allows the cook to set up their delivery areas during onboarding. The cook adds towns they deliver to, then adds quarters within each town with delivery fees. This is a simplified version of the full location management system. At least one town with one quarter is required for minimum setup. The cook can also optionally add pickup locations. Data saved here is the same data managed later through the full dashboard location features.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Cook | Adds towns, quarters, and delivery fees for their service area |
| Manager | May set up delivery areas if permitted |

---

## User Scenarios

### Scenario 1: Add a town and quarter
A cook types "Douala" as a town name (en/fr), saves it. Then adds "Bonaberi" as a quarter within Douala with a delivery fee of 500 XAF. The minimum delivery area requirement is now met.

### Scenario 2: Add multiple quarters
A cook adds the town "Yaounde" and then adds 3 quarters: "Bastos" (300 XAF), "Mvan" (500 XAF), and "Essos" (400 XAF). Each quarter appears in a list below the town.

### Scenario 3: Add a pickup location
A cook adds a pickup location: name "My Kitchen", town "Douala", quarter "Akwa", address "Behind Akwa Palace Hotel." The pickup location appears in a separate section.

### Scenario 4: Free delivery
A cook sets the delivery fee for quarter "Akwa" to 0 XAF, indicating free delivery to that area.

### Scenario 5: Skip step without minimum
A cook clicks "Skip" without adding any delivery area. The step is not marked complete. The "Go Live" button remains disabled. The wizard shows a warning that delivery areas are required.

### Scenario 6: Save and continue
After adding at least one town with one quarter, the cook clicks "Save & Continue" to proceed to Step 4. The step is marked complete.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-136 | At least 1 town with 1 quarter and a delivery fee is required for minimum setup |
| BR-137 | Town name is required in both English and French |
| BR-138 | Town name must be unique within this cook's towns |
| BR-139 | Quarter name is required in both English and French |
| BR-140 | Quarter name must be unique within its parent town |
| BR-141 | Delivery fee must be >= 0 XAF (0 = free delivery) |
| BR-142 | Delivery fee is stored as an integer in XAF |
| BR-143 | Pickup locations are optional and have no delivery fee |
| BR-144 | Data saved here uses the same models/tables as the full location management features |
| BR-145 | The cook can add as many towns, quarters, and pickup locations as needed |

---

## Data Involved

**Creates:**
- Town records (tenant-scoped): name_en, name_fr, tenant_id
- Quarter records: name_en, name_fr, town_id, delivery_fee
- Pickup location records (optional): name_en, name_fr, town_id, quarter_id, address

**Reads:**
- Existing towns, quarters, and pickup locations (for pre-population on revisit)

**Updates:**
- Nothing (only creates during onboarding; editing is done in dashboard)

---

## Acceptance Criteria

- **Given** Step 3 of the wizard, **when** the cook adds a town and a quarter with fee, **then** the data is saved and the step is marked complete
- **Given** no delivery areas added, **when** the cook clicks "Save & Continue", **then** a validation message states minimum one town + quarter is required
- **Given** a town added, **when** the cook adds a quarter with 0 XAF fee, **then** it is saved as free delivery
- **Given** a duplicate town name for this cook, **when** submitting, **then** a uniqueness validation error appears
- **Given** a pickup location with all required fields, **when** saved, **then** it appears in the pickup locations section
- **Given** completed delivery area setup, **when** revisiting this step, **then** all previously added data is displayed

---

## Verification Steps

1. Add a town with English and French names — confirm it appears in the list
2. Add a quarter within that town with a 500 XAF fee — confirm it saves
3. Add a second quarter with 0 XAF — confirm it shows "Free delivery"
4. Add a pickup location — confirm it appears in the pickup section
5. Attempt to add a duplicate town name — confirm validation error
6. Click "Save & Continue" with at least 1 town + 1 quarter — confirm advancement
7. Return to Step 3 from a later step — confirm all data is pre-populated

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| Cook adds town but no quarters within it | Step not considered complete; warning shown |
| Very large delivery fee (e.g., 99999 XAF) | Accepted but validated as reasonable (soft warning if >10000) |
| Cook deletes the only town during wizard | Step reverts to incomplete; "Go Live" disabled |
| Town name contains accents or special characters | Accepted and stored correctly (UTF-8) |
| Cook adds 50+ quarters | Performance handled; list becomes scrollable |

---

## UI/UX Notes

- Town addition: inline form with en/fr name fields and "Add Town" button
- Town list: accordion-style, each town expandable to show its quarters
- Quarter addition: inline form within expanded town with en/fr name and fee fields
- Fee field shows "XAF" suffix and accepts numeric input only
- Pickup location section below delivery areas with its own "Add" form
- Visual distinction between delivery areas (truck icon) and pickup locations (pin icon)
- Compact layout suitable for the wizard context (not full-page management)
- "Save & Continue" disabled until minimum requirement met; shows tooltip explaining why

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-071 | Cook Setup Wizard Shell | Parent wizard containing this step |
| F-073 | Cover Images Step | Previous step in the wizard |
| F-075 | Schedule & First Meal Step | Next step in the wizard |
| F-082 | Add Town | Full town management in dashboard |
| F-086 | Add Quarter | Full quarter management in dashboard |
| F-092 | Add Pickup Location | Full pickup location management in dashboard |
