# F-070 â€” Discovery Sort Options

> Module: Discovery
> Priority: Should-have
> Precedence: F-066
> Type: functional

---

## What It Does

Provides a sort dropdown on the discovery page that allows visitors to change the order of cook cards in the grid. Sort options include: popularity (order count), rating (highest first), newest cooks, and alphabetical (A-Z). The default sort is popularity. Sort changes update the grid via Gale without page reload and work in combination with active search and filters.

---

## Who Uses It

| Role | Interaction |
|------|-------------|
| Client (guest or authenticated) | Selects a sort option to reorder the discovery grid |

---

## User Scenarios

### Scenario 1: Default sort (popularity)
A visitor lands on the discovery page. Cook cards are sorted by popularity (total order count, highest first). The sort dropdown shows "Most Popular" as the selected option.

### Scenario 2: Sort by rating
A visitor selects "Highest Rated" from the dropdown. The grid re-orders to show cooks with the highest average rating first. Cooks with no ratings appear last.

### Scenario 3: Sort by newest
A visitor selects "Newest" from the dropdown. The grid re-orders to show the most recently created cook tenants first.

### Scenario 4: Sort alphabetically
A visitor selects "A-Z" from the dropdown. The grid re-orders cooks alphabetically by name in the current locale.

### Scenario 5: Sort combined with filters and search
A visitor has filtered by "Douala" town, searched for "chicken", and then sorts by "Highest Rated." The filtered and searched results are sorted by rating without resetting the other criteria.

---

## Business Rules

| Code | Rule |
|------|------|
| BR-100 | Available sort options: Popularity (default), Highest Rated, Newest, Alphabetical (A-Z) |
| BR-101 | Default sort on initial page load is Popularity (by total completed order count, descending) |
| BR-102 | Sorting by rating uses the cook's average rating (descending); cooks with no ratings are placed last |
| BR-103 | Sorting by newest uses the tenant's `created_at` timestamp (descending) |
| BR-104 | Sorting alphabetically uses the cook name in the user's current locale (en or fr) |
| BR-105 | Sort changes update the grid via Gale without page reload |
| BR-106 | Sort works in combination with active search (F-068) and filters (F-069) |
| BR-107 | The currently selected sort option is visually indicated in the dropdown |

---

## Data Involved

**Reads:**
- Cook order counts (for popularity sort)
- Cook average ratings (for rating sort)
- Tenant created_at timestamps (for newest sort)
- Cook names in current locale (for alphabetical sort)

**Creates:**
- Nothing

**Updates:**
- Cook card grid order (via Gale fragment update)

---

## Acceptance Criteria

- **Given** the discovery page, **when** it first loads, **then** cooks are sorted by popularity (most orders first)
- **Given** the sort dropdown, **when** the visitor selects "Highest Rated", **then** the grid re-orders by average rating descending
- **Given** the sort dropdown, **when** the visitor selects "Newest", **then** the grid re-orders by tenant creation date descending
- **Given** the sort dropdown, **when** the visitor selects "A-Z", **then** the grid re-orders alphabetically by cook name
- **Given** active filters and search, **when** a sort option is changed, **then** the filtered/searched results are re-sorted without resetting filters or search
- **Given** any sort option, **when** selected, **then** the dropdown displays the currently selected option

---

## Verification Steps

1. Load the discovery page and confirm default sort is by popularity
2. Select "Highest Rated" and verify cooks are ordered by rating
3. Select "Newest" and verify the most recently created cook appears first
4. Select "A-Z" and verify alphabetical order
5. Apply a filter, then change sort, and confirm filter remains active
6. Enter a search query, then change sort, and confirm search remains active
7. Confirm the dropdown shows the currently selected sort label

---

## Edge Cases & Exceptions

| Condition | Expected Behavior |
|-----------|-------------------|
| All cooks have 0 orders | Popularity sort shows them in secondary sort order (newest first) |
| Multiple cooks with same rating | Secondary sort by popularity among tied cooks |
| Cook name starts with lowercase or accented character | Sorting handles case and accents correctly |
| Only 1 cook in results | Sort has no visible effect but still functions |
| Sort option selected while grid is loading | Queued and applied after current load completes |

---

## UI/UX Notes

- Sort dropdown positioned above the grid, right-aligned on desktop, full-width on mobile
- Dropdown uses a clean select/combobox style with a chevron icon
- Selected option text visible in the closed state (e.g., "Sort: Most Popular")
- Smooth grid reorder animation when sort changes
- Sort dropdown remains visible and functional alongside search bar and filter controls

---

## Related Features

| Code | Feature | Relationship |
|------|---------|-------------|
| F-066 | Discovery Page Layout | Parent page containing the sort dropdown |
| F-067 | Cook Card Component | Cards reordered by sort selection |
| F-068 | Discovery Search | Search results respect active sort |
| F-069 | Discovery Filters | Filtered results respect active sort |
