# F-049 — Cook Account Assignment to Tenant

> Module: Admin
> Priority: Must-have
> Precedence: F-045
> Type: functional

---

## What It Does
Allows admins to assign a user account as the cook for a tenant. The admin searches existing users by name or email, selects one, and the system grants them the `cook` role for that tenant. Each tenant has exactly one cook. Reassignment removes the cook role from the previous user and assigns it to the new one. The user must already exist in the system before they can be assigned.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Assigns or reassigns cooks to tenants |
| Admin | Assigns or reassigns cooks to tenants |

---

## User Scenarios
### Scenario 1: Initial cook assignment
An admin views a newly created tenant that has no cook. They click "Assign Cook" which opens a user search dialog. They type "Amara" and see matching users. They select "Amara Njoh (amara@example.com)". The system assigns the cook role, and the tenant detail page now shows Amara as the cook.

### Scenario 2: Reassigning a cook
A tenant currently has "Amara Njoh" as cook. The admin clicks "Reassign Cook" and searches for "Brice". They select "Brice Tamo". A confirmation dialog appears: "This will remove Amara Njoh as cook for this tenant and assign Brice Tamo. Continue?" The admin confirms. Amara loses the cook role for this tenant; Brice gains it.

### Scenario 3: Searching for non-existent user
The admin searches for "xyz123" and no users match. The interface shows "No users found. The user must have an account before being assigned as a cook."

### Scenario 4: Assigning a user who is already a cook elsewhere
The admin tries to assign "Amara Njoh" who is already a cook for another tenant. The system allows this — a user can be a cook for multiple tenants. A notice is displayed: "This user is already a cook for: Chef Amara's Kitchen."

### Scenario 5: Assigning a deactivated user
The admin searches and selects a deactivated user. A warning appears: "This user is currently deactivated. They will not be able to manage the tenant until their account is reactivated." The assignment proceeds.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-082 | Each tenant has exactly one cook at a time |
| BR-083 | A user can be a cook for multiple tenants simultaneously |
| BR-084 | Reassignment revokes the cook role from the previous user for this tenant only |
| BR-085 | The user must already exist in the system; this feature does not create users |
| BR-086 | Reassignment requires explicit confirmation via dialog |
| BR-087 | Assignment is logged in the activity log (who assigned whom to which tenant) |
| BR-088 | The assigned user gains all cook-level permissions for the tenant |

---

## Data Involved
**Reads:**
- Users table: searchable by name, email
- Current tenant's cook assignment
- User's existing cook roles for other tenants

**Creates:**
- Role assignment: `cook` role for the selected user, scoped to the tenant
- Activity log entry

**Updates:**
- Previous cook's role: removed for this tenant (on reassignment)
- Tenant record: cook_id (or tenant-user relationship)

**Relationships:**
- F-045: Tenant must exist first
- F-005: User must exist in the system
- F-006: Uses Spatie Permission for role assignment

---

## Acceptance Criteria
- **Given** a tenant with no cook, **when** assigning a user, **then** the user receives the cook role and appears on the tenant detail page
- **Given** a tenant with an existing cook, **when** reassigning, **then** the old cook loses the role and the new cook gains it
- **Given** a search term, **when** typed in the search dialog, **then** matching users are displayed in real-time
- **Given** no matching users, **when** searching, **then** a helpful empty state message appears
- **Given** a successful assignment, **when** checking the activity log, **then** the assignment is recorded

---

## Verification Steps
1. Assign a cook to a tenant with no cook — confirm cook appears on tenant detail page
2. Reassign to a different user — confirm old cook loses role, new cook gains it
3. Search for users by email — confirm results match
4. Attempt to assign a user who is cook elsewhere — confirm warning and successful assignment
5. Check activity log — confirm assignment event recorded

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Cook being reassigned has active orders on this tenant | Orders remain assigned to the old cook; they can still view/complete them |
| Admin assigns themselves as cook | Allowed — no restriction on admin self-assignment |
| User has only client role before assignment | Cook role is added; client capabilities are inherited |
| Reassignment while old cook is logged into the tenant dashboard | Old cook's next action triggers permission check; they are redirected out of cook dashboard |
| Tenant is inactive when cook is assigned | Assignment proceeds; cook cannot manage until tenant is activated |

---

## UI/UX Notes
- Search dialog is a modal with a text input and live results dropdown
- Each search result shows: user avatar, name, email, current roles
- Selected user highlighted with a checkmark
- Confirmation dialog for reassignment shows both old and new cook names
- "Assign Cook" button on tenant detail page (or "Reassign Cook" if one exists)
- Loading indicator during search
- Accessible via Gale (no full page reload)

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-045 | Tenant Creation Form | Tenant must exist before cook can be assigned |
| F-047 | Tenant Detail View | Displays the assigned cook; link to assign/reassign |
| F-006 | Spatie Permission Setup | Provides the cook role used for assignment |
| F-050 | User Management List | Users searchable here must exist in the user list |
