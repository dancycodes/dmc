# F-063 — Platform Settings Management

> Module: Admin
> Priority: Must-have
> Precedence: F-043
> Type: functional

---

## What It Does
Provides a global platform settings page within the admin panel for configuring system-wide behaviors. Settings include: client wallet feature toggle (enable/disable wallet payments for orders), default cancellation window (in minutes), platform name, support contact information, and maintenance mode toggle. Changes save without full page reload. Certain critical changes (maintenance mode, wallet toggle) require explicit confirmation before applying.

---

## Who Uses It
| Role | Interaction |
|------|-------------|
| Super-Admin | Manages all platform settings |
| Admin | Manages platform settings (maintenance mode restricted to super-admin) |

---

## User Scenarios
### Scenario 1: Toggling the wallet feature
A super-admin navigates to Settings. They see the "Client Wallet for Payments" toggle is currently ON. They switch it OFF. A confirmation dialog appears: "Disabling wallet payments means clients cannot use wallet balance to pay for orders. Refunds will still be credited to wallets. Continue?" They confirm. Wallet payments are disabled platform-wide.

### Scenario 2: Changing the cancellation window
An admin changes the default cancellation window from 30 minutes to 15 minutes. The change saves immediately. New orders will have a 15-minute cancellation window (unless the cook has a custom override).

### Scenario 3: Updating support contact
An admin updates the support email to "support@dancymeals.com" and the support phone to "+237 6XX XXX XXX". These are displayed in the app's help section and in notification emails.

### Scenario 4: Enabling maintenance mode
A super-admin toggles maintenance mode ON with a reason: "Scheduled maintenance for payment system upgrade." A confirmation dialog warns: "This will show a maintenance page to all users except admins. Continue?" After confirming, all non-admin users see a branded maintenance page.

### Scenario 5: Disabling maintenance mode
The super-admin toggles maintenance mode OFF. The platform returns to normal operation. The maintenance event is logged.

---

## Business Rules
| Code | Rule |
|------|------|
| BR-183 | Wallet toggle affects only wallet-to-order payments; refund credits to wallet always work |
| BR-184 | Default cancellation window applies to all cooks unless they have a custom override |
| BR-185 | Cancellation window range: 0 to 120 minutes (0 = no cancellation allowed) |
| BR-186 | Platform name is used in emails, notifications, and the PWA manifest |
| BR-187 | Maintenance mode is accessible only to super-admin |
| BR-188 | During maintenance mode, admins and super-admins can still access the platform normally |
| BR-189 | All settings changes are logged in the activity log |
| BR-190 | Critical settings (maintenance mode, wallet toggle) require confirmation dialog |
| BR-191 | Settings save without full page reload (via Gale) |

---

## Data Involved
**Reads:**
- Platform settings: all current values
- Current admin's role (to check super-admin for maintenance mode)

**Creates:**
- Activity log entries for each setting change

**Updates:**
- Settings table/config: individual setting values

**Relationships:**
- F-043: Displayed within admin panel
- F-062: Default commission rate may be stored here
- Wallet feature: affects wallet payment flow across the platform
- Cancellation: affects order cancellation logic

---

## Acceptance Criteria
- **Given** the settings page, **when** loaded, **then** all current setting values are displayed correctly
- **Given** the wallet toggle switched OFF with confirmation, **then** clients can no longer use wallet balance for orders
- **Given** the cancellation window changed to 15 minutes, **then** new orders use the 15-minute window
- **Given** maintenance mode enabled, **when** a non-admin user accesses the platform, **then** they see the maintenance page
- **Given** maintenance mode enabled, **when** an admin accesses the platform, **then** they can use it normally
- **Given** any setting change, **when** saved, **then** the activity log records the change

---

## Verification Steps
1. Load settings page — confirm all current values displayed
2. Toggle wallet off — confirm wallet payments are disabled for clients
3. Change cancellation window — confirm new orders use the updated window
4. Enable maintenance mode as super-admin — confirm non-admin users see maintenance page
5. Access platform as admin during maintenance — confirm normal access
6. Disable maintenance mode — confirm platform returns to normal
7. Check activity log — confirm all changes are recorded

---

## Edge Cases & Exceptions
| Condition | Expected Behavior |
|-----------|-------------------|
| Admin (non-super-admin) tries to toggle maintenance mode | Toggle is disabled with tooltip: "Only super-admins can enable maintenance mode" |
| Platform name set to empty string | Validation error: "Platform name is required" |
| Cancellation window set to negative number | Validation error: "Must be between 0 and 120 minutes" |
| Settings save fails (database error) | Error toast; settings revert to previous values on screen |
| Two admins editing settings simultaneously | Last save wins per-setting (each setting saves independently) |
| Maintenance mode enabled while users are mid-order | Active order flows continue; only new page loads show maintenance page |

---

## UI/UX Notes
- Settings organized in logical groups with section headers: General, Feature Toggles, Order Settings, Support, System
- Each setting has a label, description, and appropriate input type (toggle, number, text)
- Toggles for boolean settings (wallet, maintenance mode)
- Number input with increment/decrement buttons for cancellation window
- Text inputs for platform name, support email, support phone
- Confirmation modals for critical settings use warning-styled dialogs
- Save feedback: green checkmark flash next to the changed setting
- Settings save individually on change (no global "Save All" button needed)
- Breadcrumb: Admin > Settings

---

## Related Features
| Code | Feature | Relationship |
|------|---------|-------------|
| F-043 | Admin Panel Layout | Parent layout |
| F-062 | Commission Configuration | Default commission rate may be stored here |
